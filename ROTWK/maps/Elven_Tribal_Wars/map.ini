PlayerTemplate FactionMen
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionElves
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionDwarves
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionIsengard
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionMordor
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionWild
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

PlayerTemplate FactionAngmar
StartingUnit1 = NONE
StartingUnit0 = NONE
StartingBuilding = NONE
End

CommandButton Command_ConstructGondorRangerHorde
	Command				= UNIT_BUILD
	Object				= GondorRangerHorde
	Options				= CANCELABLE
	NeededUpgradeAny		= Yes
	TextLabel			= CONTROLBAR:ConstructGondorRangerHorde
	ButtonImage			= BGArcheryRange_Rangers
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildGondorRangerHorde
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes
    UnitSpecificSound   = GondorArcherVoiceBuy
End

CommandButton Command_ConstructNoldorWarriorHorde					; Added for BFME2 Expansion
	Command				= UNIT_BUILD
	Object				= GondorRangerHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructNoldorWarriorHorde
	ButtonImage			= BEElvenBarracks_NoldorWarriorsIcon
	ButtonBorderType    		= BUILD 
	DescriptLabel       		= CONTROLBAR:ToolTipBuildNoldorWarriorHorde
	Radial				= Yes
	InPalantir			= Yes
	ShowProductionCount		= Yes    
End

CommandButton Command_ConstructElvenRivendellArchers					; Added for BFME2 Expansion
	Command				= UNIT_BUILD
	Object				= ElvenRivendellArcherHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:BuildElvenRivendellArchers
	ButtonImage			= BEGreenPasture_RivendellArcherIcon
	ButtonBorderType		= BUILD													
	DescriptLabel			= CONTROLBAR:ToolTipBuildElvenRivendellArchers
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructElvenMirkwoodArcherHorde
	Command				= UNIT_BUILD
	Object				= ElvenMirkwoodArcherHorde
	TextLabel			= CONTROLBAR:ConstructElvenMirkwoodArcherHorde
	ButtonImage			= BEElvenBarracks_MirkwoodArcher
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildElvenMirkwoodArcherHorde
	Radial				= Yes
	InPalantir	   		= Yes
	IsClickable			= Yes
	Options				= CANCELABLE
	ShowProductionCount		= Yes    
End

CommandButton Command_ConstructGondorKnightsofDolHorde					; ADDED for BFME2 Expansion 
	Command			= UNIT_BUILD
	Object			= GondorKnightsofDolHorde
	Options			= CANCELABLE
	TextLabel		= CONTROLBAR:ConstructGondorKnightsofDolHorde
	ButtonImage		= BGStables_KnightDolAmrothIcon
	ButtonBorderType    	= BUILD 
	DescriptLabel       	= CONTROLBAR:ToolTipBuildGondorKnightsofDolHorde
	Radial			= Yes
	InPalantir		= Yes
	ShowProductionCount	= Yes    
End

CommandButton Command_ConstructElvenImladrisWarriorHorde
	Command				= UNIT_BUILD
	Object				= AngmarDarkRangerHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructElvenImladrisWarriorHorde
	ButtonImage			= BEElvenBarracks_LorienArcher
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildElvenImladrisWarriorHordeWithNoPrerequisites
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes
End

CommandButton Command_ToggleFormationIsengardFighter
	Command			= HORDE_TOGGLE_FORMATION	;;Uruk-Hai
	Options			= TOGGLE_IMAGE_ON_FORMATION OK_FOR_MULTI_SELECT
	ButtonImage             = UCUruk_ShieldWall  UCUruk_ShieldWallOff
	ButtonBorderType        = ACTION 
	TextLabel               = CONTROLBAR:ToggleSkirmishFormation	CONTROLBAR:ToggleLineFormation
	DescriptLabel           = CONTROLBAR:ToolTipToggleRangerLineToSkirmishFormation	CONTROLBAR:ToolTipToggleRangerSkirmishToLineFormation
	InPalantir		= Yes
	DoubleClick		= Yes
	UnitSpecificSound       = UrukWarriorVoiceFormationBlock UrukWarriorVoiceFormationLine
End

CommandSet NewElvenBarracksCommandSet
  	1 	= Command_ConstructElvenLorienWarriorHorde
  	2 	= Command_ConstructElvenLorienArcherHorde
  	3 	= Command_ConstructElvenMithlondSentryHorde
  	7	= Command_ConstructElvenMirkwoodArcherHorde
        4 	= Command_ConstructElvenRivendellLancers
  	5 	= Command_ConstructElvenRivendellArchers
        9       = Command_ConstructNoldorWarriorHorde
        8       = Command_ConstructElvenImladrisWarriorHorde
  	6 	= Command_Sell
End

CommandSet NewNoldorWarriorCS	
        1 	= Command_ToggleStance
	2 	= Command_ToggleElvenWarriorWeapon
	3	= Command_ToggleFormationGondorFighter
	4	= Command_ArcherBombard
	5 	= Command_SpecialAbilityNoldorWeaponSong
;	5 	= Command_PurchaseUpgradeElvenSilverthornArrows
	12	= Command_CaptureBuilding	
	13 	= Command_AttackMove
	14 	= Command_Stop
	16  	= Command_SetStanceBattle
	17  	= Command_SetStanceAggressive
	18  	= Command_SetStanceHoldGround
End

CommandSet NewSetInnElvenFaction
	1	= Command_ConstructGondorKnightsofDolHorde
	2	= Command_StartSelfRepair
End

CommandSet NewElvenLindonWarriorHordeCommandSet
	1 	= Command_ToggleStance
	2 	= Command_ToggleElvenWarriorWeapon
	3	= Command_ToggleFormationIsengardFighter
;       4       = Command_PlantShield
;       5       = Command_RaiseShield
	4 	= Command_PurchaseUpgradeElvenForgedBlades	
	5	= Command_PurchaseUpgradeElvenSilverthornArrows
	12	= Command_CaptureBuilding	
	13 	= Command_AttackMove
	14 	= Command_Stop
	16  	= Command_SetStanceBattle
	17  	= Command_SetStanceAggressive
	18  	= Command_SetStanceHoldGround
End

CommandSet NewGondorWedge
	1	= Command_ToggleStance
        2       = Command_ToggleFormationGondorFighter
	3  	= Command_KnightsofDolInspiration
	4  	= Command_ChargeofGlory
	12 	= Command_CaptureBuilding
	13 	= Command_AttackMove
	14 	= Command_Stop
	16  	= Command_SetStanceBattle
	17  	= Command_SetStanceAggressive
	18  	= Command_SetStanceHoldGround
End

ModifierList NewNoldorHordeBlock
	Category 	= FORMATION
	Modifier	= ARMOR 50%				// 75% more armor
	Modifier 	= DAMAGE_MULT 125%
	Modifier	= SPEED 75%
	Duration	= 0						// Duration is forever when zero
	ModelCondition	= ALTERNATE_FORMATION
End

ModifierList NewKnightWedge
	Category 	= FORMATION
	Modifier	= ARMOR -50%				// 75% more armor
	Modifier 	= DAMAGE_MULT 175%
	Modifier	= SPEED 125%
	Modifier = MINIMUM_CRUSH_VELOCITY 50%
        Duration	= 0						// Duration is forever when zero
	ModelCondition	= ALTERNATE_FORMATION
End

ModifierList NewImladrisModifier
    Category 	= FORMATION
    Modifier = ARMOR -25%
    Modifier = DAMAGE_MULT 175%
    Duration	= 0
    ModelCondition	= ALTERNATE_FORMATION
End

Object ElvenBarracks
CommandSet = NewElvenBarracksCommandSet
BuildTime = .5
BuildCost = 1
End

Object ElvenLorienWarriorHorde
CommandPoints 	= 24
BuildCost = 10
BuildTime = 10

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenForgedBlades  ;
	End 
	End


ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_01
		FrontAngle 			= 270
		FlankedDelay 			= 2000
		ObjectStatusOfContained 	= 
		InitialPayload 			= ElvenLorienWarrior 24
		Slots 				= 24
		PassengerFilter			= NONE +INFANTRY
		ShowPips 			= No
		ThisFormationIsTheMainFormation = Yes				; Used to determine which armorset to use (and anything else we want!)
		RandomOffset			= X:0 Y:0
		MeleeBehavior 			= Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed		= ElvenBanner						; types of units that are allowed as banner carriers
		BannerCarrierPosition		= UnitType:ElvenLorienWarrior	Pos:X:70.0 Y:0.0	; (DEFAULT) position of banner carrier
		
		; Positions for 5
		;RankInfo = RankNumber:1 UnitType:ElvenLorienWarrior Position:X:50 Y:0			Position:X:50 Y:20		Position:X:50 Y:-20		Position:X:50 Y:40		;Position:X:50 Y:-40 
		;RankInfo = RankNumber:2 UnitType:ElvenLorienWarrior Position:X:30 Y:0 Leader 1 0	Position:X:30 Y:20 Leader 1 1	Position:X:30 Y:-20 Leader 1 2	Position:X:30 Y:40 Leader 1 3	;Position:X:30 Y:-40 Leader 1 4
		;RankInfo = RankNumber:3 UnitType:ElvenLorienWarrior Position:X:10 Y:0 Leader 2 0	Position:X:10 Y:20 Leader 2 1	Position:X:10 Y:-20 Leader 2 2	Position:X:10 Y:40 Leader 2 3	;Position:X:10 Y:-40 Leader 2 4
		
		; Positions for 6
		RankInfo = RankNumber:1 UnitType:ElvenLorienWarrior Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5
		RankInfo = RankNumber:2 UnitType:ElvenLorienWarrior Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5
                RankInfo = RankNumber:3 UnitType:ElvenLorienWarrior Position:X:10 Y:7.5 Leader 2 0	Position:X:10 Y:-7.5 Leader 2 1	Position:X:10 Y:25 Leader 2 2	Position:X:10 Y:-25 Leader 2 3	Position:X:10 Y:42.5 Leader 2 4	Position:X:10 Y:-42.5 Leader 2 5
                RankInfo = RankNumber:3 UnitType:ElvenLorienWarrior Position:X:-10 Y:7.5 Leader 3 0	Position:X:-10 Y:-7.5 Leader 3 1	Position:X:-10 Y:25 Leader 3 2	Position:X:-10 Y:-25 Leader 3 3	Position:X:-10 Y:42.5 Leader 3 4	Position:X:-10 Y:-42.5 Leader 3 5

		RanksToReleaseWhenAttacking = 1  2  3  4

		MeleeAttackLeashDistance 	= 1		; How far the hordes can move from the center of the horde when melee attacking.				
		BackUpMinDelayTime		= 1		; The minimum amount of time to delay before backing up
		BackUpMaxDelayTime		= 3000		; The maximum amount of time to delay before backing up
		BackUpMinDistance		= 1		; The minimum number of cells to backup
		BackUpMaxDistance		= 3		; The maximum number of cells to backup
		BackupPercentage		= 80%		; The amount of chance that a unit will back up.
	End
End
End

Object ElvenLorienArcherHorde
CommandPoints 	= 24
BuildCost = 10
BuildTime = 10

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenSilverthornArrows  ;
	End 
	End
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_01
		FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenLorienArcher 24
		Slots 			= 24			; originally 15
		PassengerFilter		= NONE +INFANTRY
		ShowPips 		= No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset		= X:0 Y:0
		MeleeBehavior 		= Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner						; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenLorienArcher	Pos:X:70.0 Y:0.0	; (DEFAULT) position of banner carrier
		
		; Positions for 5
		
		;RankInfo = RankNumber:1 UnitType:ElvenLorienArcher Position:X:50 Y:0			Position:X:50 Y:20		Position:X:50 Y:-20		Position:X:50 Y:40		;Position:X:50 Y:-40 
		;RankInfo = RankNumber:2 UnitType:ElvenLorienArcher Position:X:30 Y:0 Leader 1 0	Position:X:30 Y:20 Leader 1 1	Position:X:30 Y:-20 Leader 1 2	Position:X:30 Y:40 Leader 1 3	;Position:X:30 Y:-40 Leader 1 4
		;RankInfo = RankNumber:3 UnitType:ElvenLorienArcher Position:X:10 Y:0 Leader 2 0	Position:X:10 Y:20 Leader 2 1	Position:X:10 Y:-20 Leader 2 2	Position:X:10 Y:40 Leader 2 3	;Position:X:10 Y:-40 Leader 2 4
		
		; Positions for 6
		RankInfo = RankNumber:1 UnitType:ElvenLorienArcher Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5
		RankInfo = RankNumber:2 UnitType:ElvenLorienArcher Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5
                RankInfo = RankNumber:3 UnitType:ElvenLorienArcher Position:X:10 Y:7.5 Leader 2 0	Position:X:10 Y:-7.5 Leader 2 1	Position:X:10 Y:25 Leader 2 2	Position:X:10 Y:-25 Leader 2 3	Position:X:10 Y:42.5 Leader 2 4	Position:X:10 Y:-42.5 Leader 2 5
                RankInfo = RankNumber:3 UnitType:ElvenLorienArcher Position:X:-10 Y:7.5 Leader 3 0	Position:X:-10 Y:-7.5 Leader 3 1	Position:X:-10 Y:25 Leader 3 2	Position:X:-10 Y:-25 Leader 3 3	Position:X:-10 Y:42.5 Leader 3 4	Position:X:-10 Y:-42.5 Leader 3 5


		RanksToReleaseWhenAttacking = 1 2 3 4

		MeleeAttackLeashDistance = 1; How far the hordes can move from the center of the horde when melee attacking.				
		BackUpMinDelayTime		= 1		; The minimum amount of time to delay before backing up
		BackUpMaxDelayTime		= 3000		; The maximum amount of time to delay before backing up
		BackUpMinDistance		= 1		; The minimum number of cells to backup
		BackUpMaxDistance		= 3		; The maximum number of cells to backup
		BackupPercentage		= 80%		; The amount of chance that a unit will back up.
	End
End
End

Object ElvenMithlondSentryHorde
CommandPoints 	= 32
BuildTime = 10
BuildCost = 10

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenForgedBlades  ;
	End 
	End
ReplaceModule ModuleTag_HordeContain
Behavior = HordeContain ModuleTag_HordeContain_01
		FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenMithlondSentry 32
		Slots 			= 32
		PassengerFilter 	= NONE +INFANTRY
		ShowPips 		= No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset 		= X:0 Y:0
		MeleeBehavior 		= Amoeba
		End

		; Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner										; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenMithlondSentry	Pos:X:70.0 Y:0.0	; (DEFAULT) position of banner carrier for elven warrior horde

		RankInfo = RankNumber:1 UnitType:ElvenMithlondSentry Position:x:45 Y:10			Position:X:45 Y:-10		Position:X:45 Y:20		Position:X:45 Y:-20		Position:X:45 Y:30		Position:X:45 Y:-30             Position:X:45 Y:40              Position:X:45 Y:-40
		RankInfo = RankNumber:2 UnitType:ElvenMithlondSentry Position:X:30 Y:10 Leader 1 0	Position:X:30 Y:-10 Leader 1 1	Position:X:30 Y:20 Leader 1 2	Position:X:30 Y:-20 Leader 1 3	Position:X:30 Y:30 Leader 1 4	Position:X:30 Y:-30 Leader 1 5          Position:X:30 Y:40 Leader 1 6   Position:X:30 Y:-40 Leader 1 7
                RankInfo = RankNumber:3 UnitType:ElvenMithlondSentry Position:X:15 Y:10 Leader 2 0	Position:X:15 Y:-10 Leader 2 1	Position:X:15 Y:20 Leader 2 2	Position:X:15 Y:-20 Leader 2 3	Position:X:15 Y:30 Leader 2 4	Position:X:15 Y:-30 Leader 2 5          Position:X:15 Y:40 Leader 2 6   Position:X:15 Y:-40 Leader 2 7
                RankInfo = RankNumber:3 UnitType:ElvenMithlondSentry Position:X:0 Y:10 Leader 3 0	Position:X:0 Y:-10 Leader 3 1	Position:X:0 Y:20 Leader 3 2	Position:X:0 Y:-20 Leader 3 3	Position:X:0 Y:30 Leader 3 4	Position:X:0 Y:-30 Leader 3 5           Position:X:0 Y:40 Leader 3 6       Position:X:0 Y:-40 Leader 3 7

		RanksToReleaseWhenAttacking 	= 1 2 3 4

		MeleeAttackLeashDistance 	= 1   	// How far the hordes can move from the center of the horde when melee attacking.				  
		BackUpMinDelayTime		= 1	// The minimum amount of time to delay before backing up
		BackUpMaxDelayTime		= 3000	// The maximum amount of time to delay before backing up
		BackUpMinDistance		= 1	// The minimum number of cells to backup
		BackUpMaxDistance		= 3	// The maximum number of cells to backup
		BackupPercentage		= 80%	// The amount of chance that a unit will back up.

		AlternateFormation = ElvenMithlondSentryHordePorcupine
	End
End
End

Object ElvenRivendellLancerHorde
BuildTime = 15
BuildCost = 15
CommandPoints 	= 18

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenForgedBlades  ;
	End 
	End
ReplaceModule ModuleTag_HordeContain
Behavior = HorseHordeContain ModuleTag_HordeContain_01
	FrontAngle = 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenRivendellLancer  18
		Slots 			= 18
		PassengerFilter 	= NONE +CAVALRY +ElvenRivendellLancerBanner
		ShowPips 		= No
		RandomOffset 		= X:2 y:3
		MeleeBehavior 		= Amoeba
		End
		
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)

		; Banner Carrier info		
		BannerCarriersAllowed	= ElvenRivendellLancerBanner					; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenRivendellLancer	Pos:X:70.0 Y:0.0		; (DEFAULT) position of banner carrier for archer horde
		
		RankInfo = RankNumber:1 UnitType:ElvenRivendellLancer Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5
		RankInfo = RankNumber:2 UnitType:ElvenRivendellLancer Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5
                RankInfo = RankNumber:3 UnitType:ElvenRivendellLancer Position:X:10 Y:7.5 Leader 2 0	Position:X:10 Y:-7.5 Leader 2 1	Position:X:10 Y:25 Leader 2 2	Position:X:10 Y:-25 Leader 2 3	Position:X:10 Y:42.5 Leader 2 4	Position:X:10 Y:-42.5 Leader 2 5               
		
                RanksToReleaseWhenAttacking = 1 2 3
		
		MeleeAttackLeashDistance 	= 1   	//How far the hordes can move from the center of the horde when melee attacking.				  
		BackUpMinDelayTime		= 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		= 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		= 1	//The minimum number of	cells to backup
		BackUpMaxDistance		= 3	//The maximum number of	cells to backup
		BackupPercentage		= 80%	//The amount of	chance that a unit will	back up.
	End
End
End

ChildObject ElvenMithlondSentryHordePorcupine ElvenMithlondSentryHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_011
		FrontAngle 				= 360				//	Can't be flanked
		FlankedDelay 				= 2000
		ObjectStatusOfContained 		= 
		InitialPayload				= ElvenMithlondSentry 32
		Slots					= 32				; Originally 15
		PassengerFilter				= NONE +INFANTRY
		ShowPips				= No
		ThisFormationIsTheMainFormation 	= No				//Used to determine which armorset to use (and anything else we want!)
		RandomOffset				= X:2 Y:1
		RanksToReleaseWhenAttacking		= 0
		RanksToJustFreeWhenAttacking   		= 0
		AttributeModifiers			= ElvenMithlondSentryHordePorcupine
		IsPorcupineFormation			= Yes
		MinimumHordeSize			= 5

		AlternateFormation			= ElvenMithlondSentryHorde
		VisionRearOverride			= 100%
		VisionSideOverride			= 100%
		NotComboFormation			= Yes 			// this formation is not suitable for combo, so it will switch out of this when combo-ing

		// Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner												// types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenMithlondSentry	Pos:X:0.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		RankInfo		= RankNumber:1 UnitType:ElvenMithlondSentry Position:X:15 Y:5	Position:X:15 Y:10  Position:X:15 Y:15   Position:X:15 Y:20   Position:X:15 Y:25   Position:X:15 Y:2.5   Position:X:-5 Y:2.5   Position:X:-5 Y:5   Position:X:-5 Y:10   Position:X:-5 Y:15   Position:X:-5 Y:20   Position:X:-5 Y:25   Position:X:0 Y:25   Position:X:5 Y:25   Position:X:10 Y:25   Position:X:15 Y:-5   Position:X:15 Y:-2.5   Position:X:-5 Y:-2.5   Position:X:-5 Y:-5   Position:X:15 Y:-10   Position:X:15 Y:-15   Position:X:15 Y:-20   Position:X:15 Y:-25   Position:X:10 Y:-25   Position:X:5 Y:-25   Position:X:0 Y:-25   Position:X:-5 Y:-25   Position:X:-5 Y:-20   Position:X:-5 Y:-15   Position:X:-5 Y:-10   Position:X:15 Y:0   Position:X:-5 Y:0
	End
End
End

Object ElvenMirkwoodArcherHorde
CommandPoints 	= 18
BuildCost = 25
BuildTime = 25

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenSilverthornArrows  ;
	End 
	End
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_011
	
		FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenMirkwoodArcher 18
		Slots 			= 18
		PassengerFilter 	= NONE +INFANTRY
		ShowPips 		= No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset		= X:0 Y:0
		
		MeleeBehavior 		= Amoeba
		End
		
		// Banner Carrier info		
		BannerCarriersAllowed	= ElvenMirkwoodArcherBanner										// types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenMirkwoodArcher		Pos:X:40.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		// Positions for 5
		RankInfo = RankNumber:1 UnitType:ElvenMirkwoodArcher Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5
		RankInfo = RankNumber:2 UnitType:ElvenMirkwoodArcher Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5
                RankInfo = RankNumber:3 UnitType:ElvenMirkwoodArcher Position:X:10 Y:7.5 Leader 2 0	Position:X:10 Y:-7.5 Leader 2 1	Position:X:10 Y:25 Leader 2 2	Position:X:10 Y:-25 Leader 2 3	Position:X:10 Y:42.5 Leader 2 4	Position:X:10 Y:-42.5 Leader 2 5
                
		RanksToReleaseWhenAttacking = 1 2 3
				
		MeleeAttackLeashDistance = 1   //How far the hordes	can	move from the center of	the	horde when melee attacking.				  
		BackUpMinDelayTime		 = 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		 = 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		 = 1	//The minimum number of	cells to backup
		BackUpMaxDistance		 = 3	//The maximum number of	cells to backup
		BackupPercentage		 = 80%	//The amount of	chance that	a unit will	back up.
		
	End
End
End

Object ElvenRivendellArcherHorde
CommandPoints 	= 5
BuildCost = 25
BuildTime = 25

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenHeavyArmor  ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenSilverthornArrows  ;
	End 
	End
ReplaceModule ModuleTag_HordeContain
Behavior = HorseHordeContain ModuleTag_HordeContain_011
		FrontAngle = 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenRivendellArcher  18
		Slots 			= 18
		PassengerFilter 	= NONE +CAVALRY +ElvenRivendellLancerBanner
		ShowPips 		= No
		RandomOffset 		= X:2 y:3
		MeleeBehavior 		= Amoeba
		End
		
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)

		; Banner Carrier info		
		BannerCarriersAllowed	= ElvenRivendellArcherBanner										; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenRivendellLancer	Pos:X:75.0 Y:0.0		; (DEFAULT) position of banner carrier for archer horde
		
		RankInfo = RankNumber:1 UnitType:ElvenRivendellArcher Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5
		RankInfo = RankNumber:2 UnitType:ElvenRivendellArcher Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5
                RankInfo = RankNumber:3 UnitType:ElvenRivendellArcher Position:X:10 Y:7.5 Leader 2 0	Position:X:10 Y:-7.5 Leader 2 1	Position:X:10 Y:25 Leader 2 2	Position:X:10 Y:-25 Leader 2 3	Position:X:10 Y:42.5 Leader 2 4	Position:X:10 Y:-42.5 Leader 2 5
                
		RanksToReleaseWhenAttacking = 1 2
		
		MeleeAttackLeashDistance 	= 1   	//How far the hordes can move from the center of the horde when melee attacking.				  
		BackUpMinDelayTime		= 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		= 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		= 1	//The minimum number of	cells to backup
		BackUpMaxDistance		= 3	//The maximum number of	cells to backup
		BackupPercentage		= 80%	//The amount of	chance that a unit will	back up.
	End
End
End

Object ElvenMithlondSentry
CommandPoints = 1
End

Object ElvenLorienWarrior
CommandPoints 	= 1
End

Object ElvenLorienArcher
CommandPoints = 1
End

Object ElvenRivendellLancer
CommandPoints = 2
End

Object ElvenRivendellArcher 
CommandPoints = 2
End

Object ElvenMirkwoodArcher
CommandPoints = 2
End

Object NoldorWarrior
CommandPoints = 3
End

Object GondorKnightsofDol
CommandPoints = 6
End


Object GondorRangerHorde
BuildCost = 45
BuildTime = 30
	ButtonImage 	= WOR_NoldorWarrior
	SelectPortrait  = UPNoldorWarriorPortrait

	Side 		= Elves
	EditorSorting 	= UNIT
	EmotionRange 	= 240
	DisplayName 	= OBJECT:HordeNoldorWarrior
	DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenNoldorWarriorHorde
	DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenNoldorWarriorHorde
	MaxSimultaneousOfType	= 2
AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_MiniHordeLvl7  ;
	End 
	End

	WeaponSet
		Conditions = None 
		Weapon 		= PRIMARY    	MirkwoodArcherMissileHordeRangefinder
		Weapon 		= TERTIARY	MirkwoodArcherMissileHordeRangefinderBombard
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
	End
	WeaponSet
		Conditions = WEAPONSET_TOGGLE_1
		Weapon 		= PRIMARY	NormalMeleeHordeRangefinder
		Weapon 		= TERTIARY	MirkwoodArcherMissileHordeRangefinderBombard
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT
	End
	CommandSet = NewNoldorWarriorCS
	VisionRange = ELVEN_NOLDORWARRIOR_HORDE_VISION_RANGE
	KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE  ;UNATTACKABLE 


ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_01
                FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained 	= 
		InitialPayload 			= NoldorWarrior 16
		Slots 				= 16
		PassengerFilter 		= NONE +INFANTRY
		ShowPips 			= No
		ThisFormationIsTheMainFormation = Yes			; Used to determine which armorset to use (and anything else we want!)
		RandomOffset 			= X:0 Y:0
                AlternateFormation			= GondorRangerHordeBlock
      		MeleeBehavior = Amoeba
		End

		; Positions for 6
		RankInfo = RankNumber:1 UnitType:NoldorWarrior Position:x:50 Y:7.5			Position:X:50 Y:-7.5		Position:X:50 Y:25		Position:X:50 Y:-25		Position:X:50 Y:42.5		Position:X:50 Y:-42.5             Position:X:50 Y:60          Position:X:50 Y:-60
		RankInfo = RankNumber:2 UnitType:NoldorWarrior Position:X:30 Y:7.5 Leader 1 0	Position:X:30 Y:-7.5 Leader 1 1	Position:X:30 Y:25 Leader 1 2	Position:X:30 Y:-25 Leader 1 3	Position:X:30 Y:42.5 Leader 1 4	Position:X:30 Y:-42.5 Leader 1 5    Position:X:30 Y:60 Leader 1 6          Position:X:30 Y:-60 Leader 1 7
               
		RanksToReleaseWhenAttacking = 1 2
	End
End
ReplaceModule ModuleTag_ElvenCamouflage
	Behavior 	= InvisibilityUpdate ModuleTag_ElvenCamouflage_01
		InvisibilityNugget
			InvisibilityType	= CAMOUFLAGE
			DetectionRange		= CAMOUFLAGE_RADIUS
			ForbiddenConditions	= MOVING FIRING_ANY
			Options				= ALLOW_NEAR_TREES
		End
		UpdatePeriod			= 2000
		StartsActive			= Yes
		UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
		UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
	End
End


AddModule
Behavior = UnpauseSpecialPowerUpgrade ModuleTag_GlorfindelBladeOfPurityEnabler
		SpecialPowerTemplate		= SpecialAbilityGlorfindelBladeOfPurity
		TriggeredBy			= Upgrade_MiniHordeLvl7
	End
        End
AddModule
  	Behavior = SpecialPowerModule ModuleTag_GlorfindelBladeOfPurityStarter
		SpecialPowerTemplate		= SpecialAbilityGlorfindelBladeOfPurity
		StartsPaused			= Yes
		SetModelCondition		= ModelConditionState:USER_1
		SetModelConditionTime		= 2.0
	End
        End
AddModule
	Behavior = SpecialAbilityUpdate ModuleTag_GlorfindelBladeOfPurityUpdate
		SpecialPowerTemplate		= SpecialAbilityGlorfindelBladeOfPurity
		TriggerAttributeModifier	= NoldorWeaponSong
		AttributeModifierDuration	= 30000
	End
        End
End

ChildObject GondorRangerHordeBlock GondorRangerHorde

ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_001
		FrontAngle						= 270
		FlankedDelay					= 2000
		ObjectStatusOfContained			= 
		InitialPayload					= NoldorWarrior 16
		Slots							= 16
		PassengerFilter					= NONE +INFANTRY
		ShowPips						= No
		ThisFormationIsTheMainFormation = No	//Used to determine which armorset to use (and anything else we want!)
		AttributeModifiers				= GondorFighterBlock
		RandomOffset					= X:0 Y:0
		MeleeBehavior = Amoeba
		End
		
		// Banner Carrier info		
		;BannerCarriersAllowed	= GondorInfantryBanner										// types of units that are allowed as banner carriers
		;BannerCarrierPosition	= UnitType:GondorFighter	Pos:X:46.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		RankInfo = RankNumber:1 UnitType:NoldorWarrior		Position:X:34 Y:10				Position:X:34 Y:-10				Position:X:34 Y:20				Position:X:34 Y:0 Position:X:22 Y:-20  Position:X:22 Y:30
		RankInfo = RankNumber:2 UnitType:NoldorWarrior Position:X:22 Y:0 Leader 1 0	Position:X:22 Y:10 Leader 1 1	Position:X:22 Y:-10 Leader 1 2	Position:X:22 Y:20 Leader 1 3	Position:X:10 Y:-20 Leader 1 4  Position:X:10 Y:30 Leader 1 5
		RankInfo = RankNumber:3 UnitType:NoldorWarrior Position:X:10 Y:0 Leader 2 0	Position:X:10 Y:10 Leader 2 1	Position:X:10 Y:-10 Leader 2 2	Position:X:10 Y:20 Leader 2 3
		
		RanksToReleaseWhenAttacking = 1 2 3
				
		AlternateFormation = GondorRangerHorde
		MeleeAttackLeashDistance = 1   //How far the hordes	can	move from the center of	the	horde when melee attacking.				  
		BackUpMinDelayTime		 = 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		 = 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		 = 1	//The minimum number of	cells to backup
		BackUpMaxDistance		 = 3	//The maximum number of	cells to backup
		BackupPercentage		 = 80%	//The amount of	chance that	a unit will	back up.		
	End
End
End


Object GondorKnightsofDolHorde
BuildCost = 60
BuildTime = 30
MaxSimultaneousOfType	= 1
CommandSet = NewGondorWedge

ReplaceModule ModuleTag_HordeContain
         Behavior = HorseHordeContain ModuleTag_HordeContain_01
	 FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained 	= 
		InitialPayload 			= GondorKnightsofDol 14
		Slots 				= 14
		PassengerFilter 		= NONE +CAVALRY 
		ShowPips 			= No
		ThisFormationIsTheMainFormation = Yes			; Used to determine which armorset to use (and anything else we want!)
		RandomOffset 			= X:0 Y:0
                AlternateFormation			= GondorKnightsofDolWedge 
      		MeleeBehavior = Amoeba
		End
	
		; Banner Carrier info		
;		BannerCarriersAllowed	= ElvenRivendellLancerBanner					; types of units that are allowed as banner carriers
;		BannerCarrierPosition	= UnitType:ElvenRivendellLancer	Pos:X:70.0 Y:0.0		; (DEFAULT) position of banner carrier for archer horde
		
		RankInfo = RankNumber:1 UnitType:GondorKnightsofDol 	Position:X:40 Y:0		Position:X:40 Y:15		Position:X:40 Y:-15		Position:X:40 Y:30		Position:X:40 Y:-30                Position:X:40 Y:45               Position:X:40 Y:-45
		RankInfo = RankNumber:2 UnitType:GondorKnightsofDol 	Position:X:10 Y:0 Leader 1 0	Position:X:10 Y:15 Leader 1 1	Position:X:10 Y:-15 Leader 1 2	Position:X:10 Y:30 Leader 1 3	Position:X:10 Y:-30 Leader 1 4     Position:X:10 Y:45 Leader 1 5    Position:X:10 Y:-45 Leader 1 6
		 
		RanksToReleaseWhenAttacking = 1 2
		
		MeleeAttackLeashDistance 	= 1   	//How far the hordes can move from the center of the horde when melee attacking.				  
		BackUpMinDelayTime		= 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		= 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		= 1	//The minimum number of	cells to backup
		BackUpMaxDistance		= 3	//The maximum number of	cells to backup
		BackupPercentage		= 80%	//The amount of	chance that a unit will	back up.
	End
        End
AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_MiniHordeLvl7  ;
	End 
	End
AddModule
	Behavior = GrantUpgradeCreate ModuleTag_012
		UpgradeToGrant = Upgrade_MiniHordeLvl2;
	End 
	End
End

ChildObject GondorKnightsofDolWedge GondorKnightsofDolHorde
  ReplaceModule ModuleTag_HordeContain
	Behavior = HorseHordeContain ModuleTag_HordeContain_001
		FrontAngle						= 270
		FlankedDelay					= 2000
		ObjectStatusOfContained			= 
		InitialPayload					= GondorKnightsofDol 14
		Slots							= 14
		PassengerFilter					= NONE +CAVALRY 
		ShowPips						= No
		ThisFormationIsTheMainFormation = No	//Used to determine which armorset to use (and anything else we want!)
		AttributeModifiers				= GondorKnightWedge
		RandomOffset					= X:0 Y:0
		MeleeBehavior = Amoeba
		End
		
		// Banner Carrier info		
		;BannerCarriersAllowed	= GondorInfantryBanner										// types of units that are allowed as banner carriers
		;BannerCarrierPosition	= UnitType:GondorFighter	Pos:X:46.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		RankInfo = RankNumber:1 UnitType:GondorKnightsofDol Position:X:40 Y:0		     Position:X:30 Y:-15		Position:X:30 Y:15	        Position:X:20 Y:30              Position:X:20 Y:-30              Position:X:10 Y:45                Position:X:10 Y:-45
		RankInfo = RankNumber:2 UnitType:GondorKnightsofDol Position:X:10 Y:0 Leader 1 0     Position:X:0 Y:-15 Leader 1 1	Position:X:0 Y:15 Leader 1 2	Position:X:-10 Y:30 Leader 1 3	Position:X:-10 Y:-30 Leader 1 4  Position:X:-20 Y:45 Leader 1 5    Position:X:-20 Y:-45 Leader 1 6
		
		RanksToReleaseWhenAttacking = 1 2 
				
		AlternateFormation = GondorKnightsofDolHorde
		MeleeAttackLeashDistance = 1   //How far the hordes	can	move from the center of	the	horde when melee attacking.				  
		BackUpMinDelayTime		 = 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		 = 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		 = 1	//The minimum number of	cells to backup
		BackUpMaxDistance		 = 3	//The maximum number of	cells to backup
		BackupPercentage		 = 80%	//The amount of	chance that	a unit will	back up.		
	End
End
End

Object Inn

ReplaceModule ModuleTag_CommandSetDwarven
Behavior = CommandSetUpgrade ModuleTag_CommandSetDwarven_01
		TriggeredBy	= Upgrade_DwarfFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetMen
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMen_01
		TriggeredBy	= Upgrade_MenFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetElven
	Behavior = CommandSetUpgrade ModuleTag_CommandSetElven_01
		TriggeredBy	= Upgrade_ElfFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetIsengard
	Behavior = CommandSetUpgrade ModuleTag_CommandSetIsengard_01
		TriggeredBy	= Upgrade_IsengardFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetMordor
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMordor_01
		TriggeredBy	= Upgrade_MordorFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetWild
	Behavior = CommandSetUpgrade ModuleTag_CommandSetWild_01
		TriggeredBy	= Upgrade_WildFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
ReplaceModule ModuleTag_CommandSetAngmar
	Behavior = CommandSetUpgrade ModuleTag_CommandSetAngmar_01
		TriggeredBy	= Upgrade_AngmarFaction
		CommandSet	= NewSetInnElvenFaction
	End
        End
End

Object ElvenImladrisWarrior
CommandPoints = 2

	KindOf = CAN_ATTACK PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT PATH_THROUGH_EACH_OTHER ARCHER ATTACK_NEEDS_LINE_OF_SIGHT GRAB_AND_DROP	


	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    MirkwoodArcherBow
		Weapon = TERTIARY   MirkwoodArcherBowBombard
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT					; Not AI.
	End
	;bow upgrade
	WeaponSet
		Conditions = PLAYER_UPGRADE
		Weapon = PRIMARY	MirkwoodArcherSilverthornBow
		Weapon = TERTIARY   MirkwoodArcherSilverthornBowBombard
		AutoChooseSources = PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT				; Not AI.
	End

	WeaponSet
		Conditions = CLOSE_RANGE CONTESTING_BUILDING
		Weapon = PRIMARY   RohanArcherBowMelee
		Weapon = TERTIARY  MirkwoodArcherBowBombard
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT				; Not AI.
	End

	WeaponSet
		Conditions 		= WEAPONSET_TOGGLE_1					; CONTESTING_BUILDING
		Weapon 			= PRIMARY ElvenWarriorSword					;GondorRangerSword
		AutoChooseSources 	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	; sword upgrade	
	WeaponSet
		Conditions 		= PLAYER_UPGRADE WEAPONSET_TOGGLE_1 CONTESTING_BUILDING
		Weapon 			= PRIMARY ElvenWarriorSword
   	AutoChooseSources 		= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End


		
	ArmorSet
		Conditions		= PLAYER_UPGRADE
		Armor			= MirkwoodArcherHeavyArmor
		DamageFX		= NormalDamageFX
	End


	VisionRange = ELVEN_LORIENARCHER_VISION_RANGE

AddModule
	Behavior = SubObjectsUpgrade Armor_Upgrade
		TriggeredBy = Upgrade_ElvenHeavyArmor
		UpgradeTexture	= RUElvnWorrior.tga 0 RUElvnWorriorHA.tga
		UpgradeTexture	= RUElvnWorrior_L.tga 0 RUElvnWorriorHA.tga
		RecolorHouse	= Yes
	End
        End

AddModule	
	Behavior = ArmorUpgrade ArmorUpgradeModuleTag
		TriggeredBy = Upgrade_ElvenHeavyArmor
	End
        End
End

Object AngmarDarkRangerHorde
BuildTime = 25
BuildCost = 25
	SelectPortrait         = UPElven_LorienWarrior
	Side = Elves
	EditorSorting = UNIT
	EmotionRange = 240
	DisplayName = OBJECT:ElvenLindonWarrior
	DisplayNameStrategic = CONTROLBAR:LW_Unit_ElvenImladrisWarriorHorde
	DescriptionStrategic = CONTROLBAR:LW_ToolTip_ElvenImladrisWarriorHorde
        VisionRange = 350
	ShroudClearingRange = SHROUD_CLEAR_RANGED_HERO
	
	MaxVisionBonusPercent = 300%
	VisionBonusTestRadius = 200
	VisionBonusPercentPerFoot = 1.0%
	CommandPoints = 32
        KindOf = SELECTABLE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT INFANTRY HORDE ARCHER MELEE_HORDE;UNATTACKABLE 
	
	WeaponSet
		Conditions = None 
		Weapon = PRIMARY    MirkwoodArcherMissileHordeRangefinder
		Weapon = TERTIARY	MirkwoodArcherMissileHordeRangefinderBombard
		AutoChooseSources = TERTIARY FROM_PLAYER FROM_SCRIPT				; Not AI.
	End
	WeaponSet
		Conditions 	= WEAPONSET_TOGGLE_1
		Weapon 		= PRIMARY	NormalMeleeHordeRangefinder
	End

        CommandSet = NewElvenLindonWarriorHordeCommandSet


ReplaceModule ModuleTag_ProductionLegality
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality_01
		TriggeredBy = Upgrade_ElvenHeavyArmor
	End
        End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_012
		UpgradeToGrant = Upgrade_ElvenHeavyArmor ;
	End 
	End

AddModule
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality2
		TriggeredBy = Upgrade_ElvenForgedBlades
	End
        End

AddModule	
	Behavior = StatusBitsUpgrade ModuleTag_ProductionLegality3
		TriggeredBy = Upgrade_ElvenSilverthornArrows
	End
        End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_01
		UpgradeToGrant = Upgrade_ElvenForgedBlades ;
	End 
	End

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_011
		UpgradeToGrant = Upgrade_ElvenSilverthornArrows  ;
	End 
	End


ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_2
		FrontAngle						= 270
		FlankedDelay					= 2000
		ObjectStatusOfContained = 
		InitialPayload = ElvenImladrisWarrior 16
		Slots = 16
		PassengerFilter = NONE +INFANTRY
		ShowPips = No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset = X:1 Y:1
		
		; Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner										; types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenImladrisWarrior	Pos:X:70.0 Y:50.0	; (DEFAULT) position of banner carrier for elven warrior horde
		
		; Positions for 5
                RankInfo = RankNumber:1 UnitType:ElvenImladrisWarrior Position:X:70 Y:10                Position:X:70 Y:-10             Position:X:50 Y:0		Position:X:50 Y:20              Position:X:50 Y:-20		Position:X:50 Y:40        
		RankInfo = RankNumber:2 UnitType:ElvenImladrisWarrior Position:X:50 Y:-40  Leader 1 0	Position:X:30 Y:-40 Leader 1 1	Position:X:30 Y:0 Leader 1 2	Position:X:30 Y:20 Leader 1 3	Position:X:30 Y:-20 Leader 1 4	Position:X:30 Y:40 Leader 1 5
		RankInfo = RankNumber:3 UnitType:ElvenImladrisWarrior Position:X:50 Y:60 Leader 2 0    Position:X:50 Y:-60 Leader 2 1   Position:X:30 Y:60 Leader 2 2    Position:X:30 Y:-60 Leader 2 3
		 
		RanksToReleaseWhenAttacking = 1 2 3

		AlternateFormation = AngmarRangerHordeBlock
	End
End

ReplaceModule ModuleTag_ElvenCamouflage
	Behavior 	= InvisibilityUpdate ModuleTag_ElvenCamouflage_01
		InvisibilityNugget
			InvisibilityType	= CAMOUFLAGE
			DetectionRange		= CAMOUFLAGE_RADIUS
			ForbiddenConditions	= MOVING FIRING_ANY
			Options				= ALLOW_NEAR_TREES
		End
		UpdatePeriod			= 2000
		StartsActive			= Yes
		UnitSpecificSoundNameToUseAsVoiceMoveToStealthyArea = VoiceMoveToTrees
		UnitSpecificSoundNameToUseAsVoiceEnterStateMoveToStealthyArea = VoiceEnterStateMoveToTrees
	End
End
End

ChildObject AngmarRangerHordeBlock AngmarDarkRangerHorde
ReplaceModule ModuleTag_HordeContain 
	Behavior = HordeContain ModuleTag_HordeContain_001
		FrontAngle						= 270
		FlankedDelay					= 2000
		ObjectStatusOfContained			= 
		InitialPayload					= ElvenImladrisWarrior 16
		Slots							= 16
		PassengerFilter					= NONE +INFANTRY
		ShowPips						= No
		ThisFormationIsTheMainFormation = No	//Used to determine which armorset to use (and anything else we want!)
		RandomOffset					= X:0 Y:0
		MeleeBehavior = Amoeba
                End
		AttributeModifiers			= NewImladrisModifier

		
		// Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner										// types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenImladrisWarrior	Pos:X:80.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		RankInfo = RankNumber:1 UnitType:ElvenImladrisWarrior		Position:X:60 Y:0				Position:X:60 Y:22.5				Position:X:60 Y:-22.5		Position:X:60 Y:45    Position:X:60 Y:-45  Position:X:30 Y:11.25
		RankInfo = RankNumber:2 UnitType:ElvenImladrisWarrior Position:X:30 Y:-11.25 Leader 1 0	Position:X:30 Y:33.75 Leader 1 1	Position:X:30 Y:-33.75 Leader 1 2	Position:X:30 Y:56.25 Leader 1 3  Position:X:30 Y:-56.25 Leader 1 4	Position:X:0 Y:0 Leader 1 5 
		RankInfo = RankNumber:3 UnitType:ElvenImladrisWarrior Position:X:0 Y:22.5 Leader 2 0	Position:X:0 Y:-22.5 Leader 2 1	Position:X:0 Y:45   Leader 2 2	Position:X:0 Y:-45 Leader 2 3
		
		RanksToReleaseWhenAttacking = 1 2 3
				
		AlternateFormation = AngmarDarkRangerHorde
		MeleeAttackLeashDistance = 1   //How far the hordes	can	move from the center of	the	horde when melee attacking.				  
		BackUpMinDelayTime		 = 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		 = 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		 = 1	//The minimum number of	cells to backup
		BackUpMaxDistance		 = 3	//The maximum number of	cells to backup
		BackupPercentage		 = 80%	//The amount of	chance that	a unit will	back up.		
	End
End
End

Weapon GondorRangerMissileHordeRangefinder
        AttackRange         = ELVEN_MIRKWOOD_ARCHER_RANGE	; increased range
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= #MULTIPLY( ELVEN_MIRKWOOD_ARCHER_RANGE .01 )
	
	WeaponSpeed			= 321         ; dist/sec 
	MinWeaponSpeed      = 241
	MaxWeaponSpeed      = 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX              = FX_RohanArcherBowWeapon
	ScaleWeaponSpeed    = Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage       = 100     ;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius       = 16.0     ;When this weapon misses it can randomly miss by as much as this distance.

	AcceptableAimDelta	= 20	; prevent twitchy reaiming in horde on horde
	DelayBetweenShots   = 0
	PreAttackDelay      = ROHAN_YEOMAN_PREATTACKDELAY  
	PreAttackRandomAmount     = 200  
	PreAttackType       = PER_POSITION
	FiringDuration      = 0   

	ClipSize			= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= Min:ROHAN_YEOMAN_BOW_RELOADTIME_MIN Max:ROHAN_YEOMAN_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= ROHAN_YEOMAN_BOW_RELOADTIME_MAX 

	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged				= Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent

	ProjectileNugget	; Default arrow
		ProjectileTemplateName  = MirkwoodArcherSilverthornProjectile
		WarheadTemplateName     = MirkwoodArcherSilverthornBowWarhead
	End
End