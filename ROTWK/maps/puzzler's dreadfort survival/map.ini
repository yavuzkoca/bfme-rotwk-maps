; Buff for Gondor Rangers

Weapon GondorRangerBowWarhead
  ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS
  RadiusDamageAffects = ENEMIES NEUTRALS ALLIES NOT_SIMILAR
  HitStoredTarget = Yes	; Always hits initial target.
  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 85
    Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
    DelayTime     = 0
    DamageType    = PIERCE
    DamageFXType  = GOOD_ARROW_PIERCE
    DeathType     = NORMAL
  End
End

Weapon GondorRangerBowBombardWarhead
  ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS
  RadiusDamageAffects = ENEMIES NEUTRALS ALLIES NOT_SIMILAR
  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 85
    Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
    DelayTime     = 0
    DamageType    = PIERCE
    DamageFXType  = GOOD_ARROW_PIERCE
    DeathType     = NORMAL
  End
End


Weapon GondorRangerBowFireWarhead
	ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS 
	RadiusDamageAffects = ENEMIES NEUTRALS NOT_SIMILAR ;ALLIES
	HitStoredTarget = Yes	; Always hits initial target.

	DamageNugget                        
		Damage        = 65
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DelayTime     = 0
		DamageType    = FLAME
		DamageFXType  = GOOD_ARROW_PIERCE
		DeathType     = BURNED
		AcceptDamageAdd = No
		DamageScalar  = 25% ALL -STRUCTURE
	End

	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 1
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DamageType    = FLAME
		DamageFXType  = FLAME
		DeathType     = BURNED
		AcceptDamageAdd = No
		DamageScalar  = 50000% NONE +MINE ; Make sure we one shot kill mines, without risking wasting some poor hero with a torch
	End
	
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 115
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DelayTime     = 0
		DamageType    = PIERCE
		DamageFXType  = GOOD_ARROW_PIERCE
		DeathType     = NORMAL
	End
End

Weapon GondorRangerBowBombardFireWarhead
	ProjectileCollidesWith = ENEMIES NEUTRAL STRUCTURES WALLS 
	RadiusDamageAffects = ENEMIES NEUTRALS NOT_SIMILAR ;ALLIES

	DamageNugget                        
		Damage        = 65
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DelayTime     = 0
		DamageType    = FLAME
		DamageFXType  = GOOD_ARROW_PIERCE
		DeathType     = BURNED
		AcceptDamageAdd = No
		DamageScalar  = 25% ALL -STRUCTURE
	End

	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 1
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DamageType    = FLAME
		DamageFXType  = FLAME
		DeathType     = BURNED
		AcceptDamageAdd = No
		DamageScalar  = 50000% NONE +MINE ; Make sure we one shot kill mines, without risking wasting some poor hero with a torch
	End
	
	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 115
		Radius        = 0.0	; HitStoredTarget means we hurt the person we launched at.  And nobody else.  So a miss hurts nobody.
		DelayTime     = 0
		DamageType    = PIERCE
		DamageFXType  = GOOD_ARROW_PIERCE
		DeathType     = NORMAL
	End

	FireLogicNugget
		LogicType	= INCREASE_BURN_RATE
		Radius		= 1.0
		Damage		= ARCHER_BOMBARD_FIREARROW_BURNRATEINCREASE
	End
End

;================================================Other changes to weapons (range)

Weapon WildSpiderRiderBow     ; BALANCE Wild Spider Rider bow Weapon
	AttackRange         	= 450 ; 400
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( WILD_SPIDERRIDER_RANGE .01 )  
	
	WeaponSpeed         	= 321         ; dist/sec 
	MinWeaponSpeed      	= 241
	MaxWeaponSpeed      	= 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX              	= FX_RohanArcherBowWeapon
	ScaleWeaponSpeed    	= Yes		;Used for lob weapons, scales speed proportional to range
	HitPercentage       	= 100		;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius       	= 16.0		;When this weapon misses it can randomly miss by as much as this distance.
	  
	AcceptableAimDelta		= 20		; prevent twitchy reaiming in horde on horde
	
	DelayBetweenShots   	= 0
	
	PreAttackDelay      	= WILD_SPIDERRIDER_BOW_PREATTACKDELAY 
	PreAttackType			= PER_SHOT
	;PreAttackRandomAmount	= 200   
	FiringDuration			= 0
	RequireFollowThru		= Yes

	  
	;AutoReloadWhenIdle		= 1	
	
	ClipSize				= 1
	AutoReloadsClip			= Yes
	ClipReloadTime			= Min:600 Max:800
	
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged				= Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent

End

Weapon GoblinArcherMissileHordeRangefinder
	AttackRange			= 330   ; ;100 ;Slightly shorter than the archer's actual weapon
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( GOBLIN_ARCHER_RANGE .01 )
	
	DelayBetweenShots		= 1000 ;1500
	LeechRangeWeapon		= Yes
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	CanFireWhileMoving		= Yes		; When aboard a mumakil.
	FinishAttackOnceStarted = No
	HordeAttackNugget
	End
End

Weapon GoblinArcherMissileHordeRangefinderBombard
	AttackRange				= 330   ; ;100 
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( GOBLIN_ARCHER_BOMBARD_MAXRANGE .01 )
	
	MinimumAttackRange		= GOBLIN_ARCHER_BOMBARD_MINRANGE
	DelayBetweenShots		= 1000 ;1500
	LeechRangeWeapon		= Yes
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	CanFireWhileMoving		= Yes		; When aboard a mumakil.
	FinishAttackOnceStarted = No
	NoVictimNeeded			= Yes
	BombardType				= Yes	
	ScatterRadius			= ARCHER_BOMBARD_SCATTER_RADIUS		; Only used for cursor radius
	HordeAttackNugget
	End
End

Weapon HaradrimArcherMissileHordeRangefinder
	AttackRange			= 350   ; ;100  ; Slightly shorter than the archer's actual weapon
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( MORDOR_HARADRIM_BOW_RANGE .01 )
	
	DelayBetweenShots		= 1000 ;1500
	LeechRangeWeapon		= Yes
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	CanFireWhileMoving		= Yes		; When aboard a mumakil.
	FinishAttackOnceStarted = No
	HordeAttackNugget
	End
End

Weapon HaradrimArcherMissileHordeRangefinderBombard
	AttackRange			= 350  ; ;100 
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( MORDOR_HARADRIM_BOW_BOMBARD_MAXRANGE .01 )
	
	MinimumAttackRange		= MORDOR_HARADRIM_BOW_BOMBARD_MINRANGE
	DelayBetweenShots		= 1000 ;1500
	LeechRangeWeapon		= Yes
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	CanFireWhileMoving		= Yes		; When aboard a mumakil.
	FinishAttackOnceStarted = No
	NoVictimNeeded			= Yes
	BombardType				= Yes	
	ScatterRadius			= ARCHER_BOMBARD_SCATTER_RADIUS		; Only used for cursor radius
	HordeAttackNugget
	End
End

Weapon GoblinArcherBow       ; BALANCE Archer Weapon ;orc archer
	AttackRange			= 450    ;Horde member so it needs to be bigger than the horde weapon attack range.
   
   	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( GOBLIN_ARCHER_RANGE .01 )
   
   
    LeechRangeWeapon    = Yes
	WeaponSpeed			= 300         ; dist/sec 
	MinWeaponSpeed		= 121
	MaxWeaponSpeed		= 400      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX				= FX_RohanArcherBowWeapon  
	ScaleWeaponSpeed	= Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage		= 100     ;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius		= 20.0     ;When this weapon misses it can randomly miss by as much as this distance.
	
	AcceptableAimDelta	= 20	; prevent twitchy reaiming in horde on horde
	DelayBetweenShots	= 0
	PreAttackDelay      = GOBLIN_ARCHER_PREATTACKDELAY
	PreAttackType       = PER_POSITION
	PreAttackRandomAmount     = 200 
	FiringDuration      = 0
	
	ClipSize			= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= Min:1050 Max:1400
	ContinuousFireOne	= 0
	ContinuousFireCoast	= 1600 
	
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged				= Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent


End

Weapon GoblinArcherBowBombard       ; BALANCE Archer Weapon ;orc archer
	AttackRange			= 450
	MinimumAttackRange	= #SUBTRACT( GOBLIN_ARCHER_BOMBARD_MINRANGE 75 )
    LeechRangeWeapon    = Yes
	WeaponSpeed			= 300         ; dist/sec 
	MinWeaponSpeed		= 121
	MaxWeaponSpeed		= 400      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX				= FX_RohanArcherBowWeapon  
	ScaleWeaponSpeed	= Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage       = 0     ;Always scatter
	ScatterRadius       = ARCHER_BOMBARD_SCATTER_RADIUS      ;When this weapon misses it can randomly miss by as much as this distance.
	
	AcceptableAimDelta	= 20	; prevent twitchy reaiming in horde on horde
	DelayBetweenShots	= 0
	PreAttackDelay      = GOBLIN_ARCHER_PREATTACKDELAY
	PreAttackType       = PER_POSITION
	PreAttackRandomAmount     = 200 
	FiringDuration      = 0
	
	ClipSize			= 1
	AutoReloadsClip		= Yes
	AutoReloadWhenIdle	= 1	
	ClipReloadTime		= Min:GOBLIN_ARCHER_BOW_RELOADTIME_MIN Max:GOBLIN_ARCHER_BOW_RELOADTIME_MAX
	ContinuousFireOne	= 0
	ContinuousFireCoast	= GOBLIN_ARCHER_BOW_RELOADTIME_MAX 
	
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	HitPassengerPercentage	= 20%
	CanBeDodged				= Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent
	NoVictimNeeded			= Yes
	BombardType				= Yes
End

Weapon HaradrimBow ; BALANCE Archer Weapon ;orc archer
  AttackRange 			= 450
  
  	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( MORDOR_HARADRIM_BOW_RANGE .01 )   
  
  LeechRangeWeapon      = Yes
  WeaponSpeed 			= 270 ; ;401         ; dist/sec 
  MinWeaponSpeed 		= 121
  MaxWeaponSpeed 		= 440 ; ;601      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
  FireFX 				= FX_RohanArcherBowWeapon  
  ScaleWeaponSpeed	 	= Yes ; Used for lob weapons, scales speed proportional to range
  HitPercentage     	= 100     ;When this weapon is used it will hit exactly 50% of the time.
  ScatterRadius     	= 40.0     ;When this weapon misses it can randomly miss by as much as this distance.
  DelayBetweenShots 	= 650
  PreAttackDelay        = MORDOR_HARADRIM_BOW_PREATTACKDELAY
  PreAttackRandomAmount     = 200 
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  FiringDuration      	= MORDOR_HARADRIM_BOW_FIRINGDURATION     ; Duration of the archer firing shot is 500ms.
  AntiAirborneVehicle	= Yes
  AntiAirborneMonster	= Yes
  CanBeDodged				= Yes
End

Weapon HaradrimBowBombard ; BALANCE Archer Weapon ;orc archer
	AttackRange 			= 450
	MinimumAttackRange	= #SUBTRACT( MORDOR_HARADRIM_BOW_BOMBARD_MINRANGE 75 )

	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( MORDOR_HARADRIM_BOW_BOMBARD_MAXRANGE .01 )  
  
	LeechRangeWeapon      = Yes
	WeaponSpeed 			= 270 ; ;401         ; dist/sec 
	MinWeaponSpeed 		= 121
	MaxWeaponSpeed 		= 440 ; ;601      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX 				= FX_RohanArcherBowWeapon  
	ScaleWeaponSpeed	 	= Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage     	= 0     ;Always scatter
	ScatterRadius     	= ARCHER_BOMBARD_SCATTER_RADIUS     ;When this weapon misses it can randomly miss by as much as this distance.
	DelayBetweenShots 	= MORDOR_HARADRIM_BOW_DELAYBETWEENSHOTS
	PreAttackDelay        = MORDOR_HARADRIM_BOW_PREATTACKDELAY
	PreAttackRandomAmount     = 200 
	PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration      	= MORDOR_HARADRIM_BOW_FIRINGDURATION    ; Duration of the archer firing shot is 500ms.
	AntiAirborneVehicle	= Yes
	AntiAirborneMonster	= Yes
	CanBeDodged			= Yes
	NoVictimNeeded		= Yes
	BombardType			= Yes
End

Weapon IsengardArcherHordeRangeFinder
	AttackRange				= 340
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_RANGE .01 )
	
	LeechRangeWeapon		= Yes
	DelayBetweenShots		= 1500
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	FinishAttackOnceStarted = No
	CanFireWhileMoving		= No
	HordeAttackNugget
	End
End

Weapon IsengardArcherHordeRangeFinderBombard
	AttackRange				= 340   ; ;100
	MinimumAttackRange		= ISENGARD_URUKCROSSBOW_BOMBARD_MINRANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_BOMBARD_MAXRANGE .01 )
	
	LeechRangeWeapon		= Yes
	DelayBetweenShots		= 1500
	AcceptableAimDelta		= 45
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	FinishAttackOnceStarted = No
	CanFireWhileMoving		= No
	NoVictimNeeded			= Yes
	BombardType				= Yes
	ScatterRadius			= ARCHER_BOMBARD_SCATTER_RADIUS		; Only used for cursor radius
	HordeAttackNugget
	End
End

Weapon IsengardArcherBow         ; BALANCE Archer Weapon
  AttackRange				= 500 
  
  	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_RANGE .01 )
	
	
  LeechRangeWeapon		    = Yes
  WeaponSpeed				= 321         ; dist/sec 
  MinWeaponSpeed			= 61
  MaxWeaponSpeed			= 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range    
  FireFX = FX_RohanArcherBowWeapon 
  ScaleWeaponSpeed			= Yes ; Used for lob weapons, scales speed proportional to range
  HitPercentage				= 100     ;When this weapon is used it will hit exactly 50% of the time.
  ScatterRadius				= 16.0     ;When this weapon misses it can randomly miss by as much as this distance.
  PreAttackRandomAmount 	= 200     ; amount of additional preattack variance for archer type attacks only 
  DelayBetweenShots			= 2200	; time between shots, msec
  PreAttackDelay			= ISENGARD_URUKCROSSBOW_PREATTACKDELAY  	; 733 is the prep time for archer.
  PreAttackType				= PER_POSITION ; ;PER_SHOT ; Do the delay each time we attack a new target
  FiringDuration			= ISENGARD_URUKCROSSBOW_FIRINGDURATION 		; Duration of the archer firing shot is 500ms.
  CanFireWhileMoving		= No
  IsAimingWeapon            = Yes
  
  AcceptableAimDelta		= 20	; prevent twitchy reaiming in horde on horde
  AntiAirborneVehicle		= Yes
  AntiAirborneMonster		= Yes

  CanBeDodged = Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent
End

Weapon IsengardArcherBowBombard         ; BALANCE Archer Weapon
  AttackRange				= 500
  MinimumAttackRange		= #SUBTRACT( ISENGARD_URUKCROSSBOW_BOMBARD_MINRANGE 75 )
  
  	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_BOMBARD_MAXRANGE .01 )
	
	
  LeechRangeWeapon		    = Yes
  WeaponSpeed				= 321         ; dist/sec 
  MinWeaponSpeed			= 61
  MaxWeaponSpeed			= 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range    
  FireFX = FX_RohanArcherBowWeapon 
  ScaleWeaponSpeed			= Yes ; Used for lob weapons, scales speed proportional to range
  HitPercentage				= 0     ;Always scatter
  ScatterRadius				= ARCHER_BOMBARD_SCATTER_RADIUS     ;When this weapon misses it can randomly miss by as much as this distance.
  PreAttackRandomAmount 	= 200     ; amount of additional preattack variance for archer type attacks only 
  DelayBetweenShots			= ISENGARD_URUKCROSSBOW_DELAYBETWEENSHOTS 	; time between shots, msec
  PreAttackDelay			= ISENGARD_URUKCROSSBOW_PREATTACKDELAY 	; 733 is the prep time for archer.
  PreAttackType				= PER_POSITION ; ;PER_SHOT ; Do the delay each time we attack a new target
  FiringDuration			= ISENGARD_URUKCROSSBOW_FIRINGDURATION 		; Duration of the archer firing shot is 500ms.
  CanFireWhileMoving		= No
  IsAimingWeapon            = Yes
  
  AcceptableAimDelta		= 20	; prevent twitchy reaiming in horde on horde
  AntiAirborneVehicle		= Yes
  AntiAirborneMonster		= Yes

  CanBeDodged = Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent
  
  NoVictimNeeded			= Yes
	BombardType				= Yes
End

Weapon IsengardArcherBowFireArrow       ; BALANCE Archer Weapon
	AttackRange               = 500
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_RANGE .01 )
	
	
	WeaponSpeed               = 321         ; dist/sec 
	MinWeaponSpeed            = 241
	MaxWeaponSpeed            = 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX                    = FX_RohanArcherBowWeapon
	ScaleWeaponSpeed          = Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage             = 100     ;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius             = 16.0     ;When this weapon misses it can randomly miss by as much as this distance.
	DelayBetweenShots         = 2100
	PreAttackDelay            = ISENGARD_URUKCROSSBOW_PREATTACKDELAY    ; 1467 is the prep time for archer.
	PreAttackRandomAmount     = 200    ; amount of additional preattack variance for archer type attacks only  
	PreAttackType             = PER_POSITION ; ;PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration            = ISENGARD_URUKCROSSBOW_FIRINGDURATION    ; Duration of the archer firing shot is 500ms.
	CanFireWhileMoving		  = No	
	IsAimingWeapon            = Yes
	
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	AcceptableAimDelta		= 20	; prevent twitchy reaiming in horde on horde

  	CanBeDodged = Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent
	
	DamageType				  = FLAME

End

Weapon IsengardArcherBowBombardFireArrow       ; BALANCE Archer Weapon
	AttackRange               = 500
	MinimumAttackRange        = #SUBTRACT( ISENGARD_URUKCROSSBOW_BOMBARD_MINRANGE 75 )
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= 1 ; ;#MULTIPLY( ISENGARD_URUKCROSSBOW_BOMBARD_MAXRANGE .01 )
	
	
	WeaponSpeed               = 321         ; dist/sec 
	MinWeaponSpeed            = 241
	MaxWeaponSpeed            = 481      ; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	FireFX                    = FX_RohanArcherBowWeapon
	ScaleWeaponSpeed          = Yes ; Used for lob weapons, scales speed proportional to range
	HitPercentage             = 100     ;When this weapon is used it will hit exactly 50% of the time.
	ScatterRadius             = 16.0     ;When this weapon misses it can randomly miss by as much as this distance.
	DelayBetweenShots         = ISENGARD_URUKCROSSBOW_DELAYBETWEENSHOTS
	PreAttackDelay            = ISENGARD_URUKCROSSBOW_PREATTACKDELAY    ; 1467 is the prep time for archer.
	PreAttackRandomAmount     = 200    ; amount of additional preattack variance for archer type attacks only  
	PreAttackType             = PER_POSITION ; ;PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration            = ISENGARD_URUKCROSSBOW_FIRINGDURATION    ; Duration of the archer firing shot is 500ms.
	CanFireWhileMoving		  = No	
	IsAimingWeapon            = Yes
	
	AntiAirborneVehicle		= Yes
	AntiAirborneMonster		= Yes
	AcceptableAimDelta		= 20	; prevent twitchy reaiming in horde on horde

  	CanBeDodged = Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent
  	
  	NoVictimNeeded			= Yes
	BombardType				= Yes	
	DamageType				  = FLAME

End

;======================================================================================
Object InGameMarker
	LocomotorSet
		Locomotor = EyeLocomotor
		Condition = SET_NORMAL 
		Speed     = 3000
 	End
End

Object EyeOfSauron
RemoveModule ModuleTag_LifetimeUpdate
	LocomotorSet
		Locomotor = EyeLocomotor
		Condition = SET_NORMAL 
		Speed     = 600
	End
End

Object AngmarThrallMaster
ReplaceModule ModuleTag_02
  Body = ActiveBody ModuleTag_02_NEW
    MaxHealth         = 5000
    MaxHealthDamaged  = 200
	BurningDeathBehavior = Yes
	BurningDeathFX       = FX_InfantryBurningFlame
  End
End
End

Weapon AngmarMorgramirRuinWeapon
	LeechRangeWeapon		= Yes
	CanFireWhileMoving		= No
	AttackRange			= 30.0
	AntiStructure         = Yes                                      ; ShakeFoundation ONLY affects structures -- buildings, walls, gates
	AntiGround            = No                                       ; ditto
	MeleeWeapon			= Yes
	WeaponSpeed           = 799999.2        ; dist/sec (huge value == effectively instant)
	FireFX				= FX_GloinShake
	DelayBetweenShots     = ANGMAR_MORGRAMIR_RUIN_DELAYBETWEENSHOTS 	; time between shots, msec
	PreAttackDelay        = ANGMAR_MORGRAMIR_RUIN_PREATTACKDELAY 	; 433 is natural time of the stabbing animation.
	PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration        = ANGMAR_MORGRAMIR_RUIN_FIRINGDURATION 		; min 600 for anim

	; Structural damage.
	DamageNugget								; A basic Nugget that just does damage
		Damage			= 10000
		DamageScalar  		= 500% NONE +BLOCKING_GATE
		Radius			= 0.0
		DelayTime		= 0
		DamageType		= SIEGE
		DamageFXType		= MAGIC
		DeathType		= NORMAL
	End

	; Temporarily disable the target building
	ParalyzeNugget
		Radius			= 0.0
		Duration		= 30000
		ParalyzeFX		= FX_ParalyzeStructure
	End

	; Force open any gate hit by this (which will also be paralyzed, so it will be stuck open for the duration)
	OpenGateNugget
		Radius			= 5.0
	End
End

Weapon IsengardExplosiveMineExplosionWeapon
	AttackRange           = 4.0
	DelayBetweenShots     = 2000
	FireFX                = FX_ExplosiveMine
	RadiusDamageAffects = ALLIES ENEMIES NEUTRALS SELF

	DamageNugget
		Damage        = 10000
		Radius        = 125.0
		DelayTime     = 0
		DamageType    = SIEGE
		DamageFXType  = FLAME
		DeathType     = BURNED
		DamageScalar  = 250% NONE +STRUCTURE
	End

	MetaImpactNugget
		ShockWaveAmount   = 90.0		
		ShockWaveRadius   = 125.0
		ShockWaveTaperOff = 0.66
	End
End

Locomotor HorseFleeLocomotor
  Surfaces		= GROUND RUBBLE
  TurnTime		= 1000
  TurnTimeDamaged	= 1200
  Acceleration		= 1000
  SlowTurnRadius	= 0.0 ;  From a standing starts, horse turns in place.
  FastTurnRadius	= 48.0 ; Once the catapult gets moving, still uses a 30 foot radius to turn.
  FormationPriority	= MELEE1
  TurnPivotOffset	= 1   ; where to pivot when turning (-1.0 = rear, 0.0 = center, 1.0 = front)
  Braking  		= 1
  MinTurnSpeed		= 10%
  ZAxisBehavior		= NO_Z_MOTIVE_FORCE
  AccDecTrigger		= 0.5       ; ratio of max speed where we trigger acc and dec model states
  Appearance		= FOUR_WHEELS
  StickToGround		= No
  CanMoveBackwards	= No
  HasSuspension 	= Yes           ; Calculate 4 wheel independent suspension info.
  FrontWheelTurnAngle	= 20      ; How many degrees the front wheels can turn.
  ForwardAccelerationPitchFactor = 0.00  ; How much acceleration will cause the front to lift, or dip for stops.
  LateralAccelerationRollFactor  = 0.10  ; How much cornering will cause the chassis to roll.
  CloseEnoughDist = 2.0         ; How close we must get to the end of a goal path before declaring success
End

Locomotor HorseWalkLocomotor
  Surfaces       	= GROUND RUBBLE
  TurnTime         	= 2000
  TurnTimeDamaged    	= 2000
  FormationPriority	= MELEE1
  Acceleration 		= 2000  ; 1 second to accelerate to full speed.
  Braking		= 1000  ; 1 second to brake from full speed.
  MinTurnSpeed     	= 0%
  ZAxisBehavior      	= NO_Z_MOTIVE_FORCE
  AccDecTrigger      	= 0.5       ; ratio of max speed where we trigger acc and dec model states
  WalkDistance     	= 65         ; in unit distance
  Appearance        	= FOUR_WHEELS
  StickToGround     	= No
  CanMoveBackwards   	= No
End

FXParticleSystem TorchGlow
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar2.tga
    Lifetime = 5 6
    SortLevel = 1
    Size = 30 60
    BurstDelay = 1 1
    BurstCount = 1 2
  End
  Color = DefaultColor
    Color1 = R:53 G:26 B:0 0
  End
  Update = DefaultUpdate
    SizeRateDamping = 0.99 0.99
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = PointEmissionVolume
  End
  Draw = DefaultDraw
  End
End

Object GondorTownsmanTorch
ReplaceModule ModuleTag_02
	Draw = W3DLightDraw ModuleTag_02_NEW
		Ambient = R:0 G:0 B:0
		Diffuse = R:255 G:192 B:64
		Radius = 70
		Intensity = 7
		AttachToBoneInAnotherModule = Torch
	End
End
RadarPriority = NOT_ON_RADAR
KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED
	VisionRange = 400
	LocomotorSet
		Locomotor = HumanLocomotorNoBackwards
		Condition = SET_NORMAL
		Speed     = 15
	End

        LocomotorSet
		Locomotor = GondorCivilianLocomotor
		Condition = SET_PANIC
		Speed     = 49
	End
End

Object GondorTownsman
RadarPriority = NOT_ON_RADAR
KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED
	VisionRange = 400
	LocomotorSet
		Locomotor = HumanLocomotorNoBackwards
		Condition = SET_NORMAL
		Speed     = 15
	End

        LocomotorSet
		Locomotor = GondorCivilianLocomotor
		Condition = SET_PANIC
		Speed     = 49
	End
End

Object GondorTownsWoman
RadarPriority = NOT_ON_RADAR
KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT DOZER CAN_BE_REPULSED
	VisionRange = 400
	LocomotorSet
		Locomotor = HumanLocomotorNoBackwards
		Condition = SET_NORMAL
		Speed     = 12
	End

        LocomotorSet
		Locomotor = GondorCivilianLocomotor
		Condition = SET_PANIC
		Speed     = 45
	End
End

Object GondorTownsPair
RadarPriority = NOT_ON_RADAR
KindOf = PRELOAD SELECTABLE CAN_CAST_REFLECTIONS INFANTRY SCORE THROWN_OBJECT DOZER
	VisionRange = 400
	LocomotorSet
		Locomotor = HumanLocomotorNoBackwards
		Condition = SET_NORMAL
		Speed     = 12
	End

        LocomotorSet
		Locomotor = GondorCivilianLocomotor
		Condition = SET_PANIC
		Speed     = 40
	End
End

Object ElvenBanner
	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_COMBO ; This is from the Elf combine in BannerCarrierUpdate
		Speed     = 75
	End
End

ChildObject ElvenImladrisWarrior ElvenMirkwoodArcher
	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_NORMAL
		Speed     = 75	
	End
End

ChildObject ImladrisWarriorHorde ElvenMirkwoodArcherHorde
ReplaceModule ModuleTag_HordeContain
	Behavior = HordeContain ModuleTag_HordeContain_NEW
	
		FrontAngle 		= 270
		FlankedDelay 		= 2000
		ObjectStatusOfContained = 
		InitialPayload 		= ElvenImladrisWarrior 14
		Slots 			= 14
		PassengerFilter 	= NONE +INFANTRY
		ShowPips 		= No
		ThisFormationIsTheMainFormation = Yes	;Used to determine which armorset to use (and anything else we want!)
		RandomOffset		= X:0 Y:0
		
		MeleeBehavior 		= Amoeba
		End

		// Banner Carrier info		
		BannerCarriersAllowed	= ElvenBanner										// types of units that are allowed as banner carriers
		BannerCarrierPosition	= UnitType:ElvenMirkwoodArcher		Pos:X:60.0 Y:0.0		// (DEFAULT) position of banner carrier
		
		// Positions for 5
		RankInfo = RankNumber:1 UnitType:ElvenImladrisWarrior Position:X:0 Y:-12.5	Position:X:0 Y:12.5	Position:X:0 Y:-37.5	Position:X:0 Y:37.5
		RankInfo = RankNumber:2 UnitType:ElvenImladrisWarrior Position:X:20 Y:0	Position:X:20 Y:25	Position:X:20 Y:-25	Position:X:20 Y:50	Position:X:20 Y:-50
		RankInfo = RankNumber:3 UnitType:ElvenImladrisWarrior Position:X:40 Y:0	Position:X:40 Y:25	Position:X:40 Y:-25	Position:X:40 Y:50	Position:X:40 Y:-50

		RanksToReleaseWhenAttacking = 1 2 3
				
		MeleeAttackLeashDistance = 1   //How far the hordes	can	move from the center of	the	horde when melee attacking.				  
		BackUpMinDelayTime		 = 1	//The minimum amount of	time to	delay before backing up
		BackUpMaxDelayTime		 = 3000	//The maximum amount of	time to	delay before backing up
		BackUpMinDistance		 = 1	//The minimum number of	cells to backup
		BackUpMaxDistance		 = 3	//The maximum number of	cells to backup
		BackupPercentage		 = 80%	//The amount of	chance that	a unit will	back up.
		
	End
End
	LocomotorSet
		Locomotor     = NormalRangedHordeLocomotor
		Condition     = SET_NORMAL
		Speed         = 70
	End
End

Weapon HobbitPunch
	IdleAfterFiringDelay		= 0
	AttackRange			= 120
	MinimumAttackRange		= 0.8
	WeaponSpeed			= 401					; dist/sec 
	MinWeaponSpeed			= 241
	MaxWeaponSpeed			= 601					; dist/sec Upper limit on scaling, when attacking past nominal "max" range
	ScaleWeaponSpeed		= Yes					; Used for lob weapons, scales speed proportional to range
	RadiusDamageAffects		= ALLIES ENEMIES NOT_SIMILAR
	DelayBetweenShots		= 2000					; time between shots, msec
	PreAttackDelay			= 10
	PreAttackType			= PER_ATTACK				; Do the delay each time we attack a new target
	PreAttackFX			= FX_RingHeroPreAttackBlast
	FireFX				= FX_RingHeroBlast
	FiringDuration			= 1000
	
	DamageNugget						
		Damage			= 500000			; Kill all allies
		Radius			= 5000.0			; The whole map
		DamageType		= MAGIC
		DamageFXType		= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 750.0				; must match the ShockWaveSpeed below
	    DamageScalar		= 0% ALL ENEMIES		; prevents players 1-4 from being obliterated
	    DamageScalar		= 0% NONE +STRUCTURE		; prevents Orthanc towers from being destroyed
	End

	DamageNugget						
		Damage			= 70			; Damage some nearby enemies
		Radius			= 500.0			
		DamageType		= MAGIC
		DamageFXType		= MAGIC
		DeathType		= EXPLODED
		DamageSpeed		= 750.0			; must match the ShockWaveSpeed below
	End

	MetaImpactNugget					; A Nugget that throws things back with force
		ShockWaveAmount		= 70.0
		ShockWaveRadius		= 3000.0
		ShockWaveTaperOff	= 1.0
		ShockWaveZMult		= 1.000
		ShockWaveSpeed		= 750.0 
	End
End

Weapon GoblinKingBlade
  LeechRangeWeapon      = Yes
  AttackRange           = 20.0
  MeleeWeapon           = Yes
  DelayBetweenShots     = WILD_GOBLIN_KING_DELAYBETWEENSHOTS            ; time between shots, msec
  PreAttackDelay        = WILD_GOBLIN_KING_PREATTACKDELAY             ; 300 is mace swing delay time before contact with target.
  PreAttackType         = PER_SHOT ; Do the delay each time we attack
  FireFX                = FX_GondorSwordHit
  FiringDuration        = WILD_GOBLIN_KING_FIRINGDURATION

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 50
    Radius        = 0.0
    DelayTime     = 0
    DamageType    = HERO
    DamageFXType  = SWORD_SLASH
    DeathType     = NORMAL
  End

	DOTNugget                        ; A basic Nugget that just does damage
		Damage        = 10
		AcceptDamageAdd = No
		Radius        = 15.0
		DelayTime     = 0
		DamageType    = POISON
		DamageFXType  = POISON
		DeathType     = NORMAL
		DamageInterval = 25
		DamageDuration = 20000
		SpecialObjectFilter = AFFECTED_BY_POISON_OBJECTFILTER
	End
End

ChildObject MordorRingWraith WildGoblinKing
Scale = 1.4
RemoveModule ModuleTag_RespawnBody
RemoveModule ModuleTag_05
AddModule
	Body = RespawnBody ModuleTag_RespawnBody_BOSS
		MaxHealth         = 33333
		PermanentlyKilledByFilter	= NONE		;Who kills me permanently?
   		DodgePercent      = HERO_DODGE_PERCENT
		BurningDeathBehavior = Yes
		BurningDeathFX       = FX_InfantryBurningFlame
	End
End
AddModule
	Behavior = SlowDeathBehavior ModuleTag_05_SHOCKWAVE
		DeathTypes			= ALL 
		SinkDelay			= 500
		SinkRate			= 1.00
		DestructionDelay		= 4000
        Sound					= INITIAL GoblinKingVoiceDie
        Weapon					= FINAL HobbitPunch
	End
End
End

ExperienceLevel	RingWraithLevel1
	TargetNames					= MordorRingWraith
	RequiredExperience			= 1	
	ExperienceAward				= WILD_GOBLIN_KING_LVL1_EXP_AWARD
	Rank						= 1
	SelectionDecal
		Texture					= decal_hero_evil	
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits			= 40
	End	
End	

ExperienceLevel	RingWraithLevel2
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL2_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL2_EXP_AWARD
	AttributeModifiers			= HeroLevelUpDamage1
	Rank						= 2
	LevelUpFx					= FX:GandalfLevelUp1FX

	Upgrades					= Upgrade_ObjectLevel2 Upgrade_ObjectLevel3 Upgrade_ObjectLevel4 Upgrade_ObjectLevel6 Upgrade_ObjectLevel10
	SelectionDecal
		Texture					= decal_hero_evil	
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel3
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL3_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL3_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage2
	Rank						= 3
	LevelUpFx					= FX:GandalfLevelUp1FX

	Upgrades					= Upgrade_ObjectLevel3	
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel4
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL4_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL4_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage3
	Rank						= 4
	LevelUpFx					= FX:GandalfLevelUp1FX
	
	Upgrades					= Upgrade_ObjectLevel4

	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel5
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL5_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL5_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage4
	Rank						= 5
	LevelUpFx					= FX:GandalfLevelUp1FX
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel6
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL6_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL6_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage5
	Rank						= 6
	LevelUpFx					= FX:GandalfLevelUp1FX
	
	Upgrades					= Upgrade_ObjectLevel6
	
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits			= 40
	End	
END	

ExperienceLevel	RingWraithLevel7
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL7_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL7_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage6
	Rank						= 7
	LevelUpFx					= FX:GandalfLevelUp1FX
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel8
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL8_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL8_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage7
	Rank						= 8
	LevelUpFx					= FX:GandalfLevelUp1FX
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	

END	

ExperienceLevel	RingWraithLevel9
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL9_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL9_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage8
	Rank						= 9
	LevelUpFx					= FX:GandalfLevelUp1FX
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END	

ExperienceLevel	RingWraithLevel10
	TargetNames					= MordorRingWraith
	RequiredExperience			= WILD_GOBLIN_KING_LVL10_EXP_NEEDED 
	ExperienceAward				= WILD_GOBLIN_KING_LVL10_EXP_AWARD	
	AttributeModifiers			= HeroLevelUpDamage9
	Rank						= 10
	LevelUpFx					= FX:GandalfLevelUp1FX
	
	Upgrades					= Upgrade_ObjectLevel10
	
	SelectionDecal
		Texture					= decal_hero_evil
		Style					= SHADOW_ALPHA_DECAL
		OpacityMin				= 50%	
		OpacityMax				= 100%
		MinRadius				= 40
		MaxRadius				= 200
		MaxSelectedUnits		= 40
	End	
END

FXParticleSystem UltraExp01
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXLnzFlar1.tga
    Lifetime = 240 240
    SystemLifetime = 5
    SortLevel = 1
    Size = 40 40
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:238 G:113 B:127 0
    Color2 = R:40 G:100 B:40 120
    Color3 = R:0 G:0 B:0 240
  End
  Update = DefaultUpdate
    SizeRate = 50 50
    SizeRateDamping = 0.9 0.9
    AngleZ = 90 90
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.08
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:5
    EndPoint = X:0 Y:0 Z:5
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem UltraExp02
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXHPcoresun.tga
    Lifetime = 240 240
    SystemLifetime = 1
    SortLevel = 1
    Size = 20 20
    BurstCount = 3 3
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:238 G:43 B:47 0
    Color2 = R:50 G:0 B:0 120
    Color3 = R:0 G:0 B:0 240
  End
  Update = DefaultUpdate
    SizeRate = 30 30
    SizeRateDamping = 0.9 0.9
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.08
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:5
    EndPoint = X:0 Y:0 Z:5
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem UltraExp03
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXBarbStreaks.tga
    Lifetime = 240 240
    SystemLifetime = 1
    SortLevel = 1
    Size = 20 20
    BurstCount = 10 10
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:248 G:43 B:47 0
    Color2 = R:100 G:10 B:10 120
    Color3 = R:0 G:0 B:0 240
  End
  Update = DefaultUpdate
    SizeRate = 10 30
    SizeRateDamping = 0.9 0.9
    AngleZ = 0 7
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    Gravity = 0.08
    VelocityDamping = 0.8 0.85
  End
  EmissionVelocity = OutwardEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:0 Y:0 Z:5
    EndPoint = X:0 Y:0 Z:5
  End
  Draw = DefaultDraw
  End
End

SpecialPower SpellBookPalantirVision
	Enum				= SPECIAL_SPELL_BOOK_PALANTIR_VISION
	Flags			= WATER_OK RESPECT_RECHARGE_TIME_DISCOUNT
	ReloadTime			= SPELL_RECHARGE_TIME_TIER_1 ; in milliseconds
	RadiusCursorRadius	= 300.0
	RequiredSciences		= SCIENCE_PalantirVision
	InitiateAtLocationSound       = WitchKingScreechMS
End

Weather
  HardwareFogColor = R:246 G:240 B:212
  HardwareFogEnable = Yes
  HardwareFogStart = 1200
  HardwareFogEnd = 3000
End

FXParticleSystem PalantirVisionReveal
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXShockWav.tga
    Lifetime = 36 36
    SystemLifetime = 3
    Size = 1 1
    StartSizeRate = 1 4
    BurstCount = 1 1
    InitialDelay = 6 6
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color1 = R:211 G:65 B:74 0
    Color2 = R:0 G:0 B:0 36
    ColorScale = -100 100
  End
  Alpha = DefaultAlpha
  End
  Update = DefaultUpdate
    SizeRate = 24 24
    SizeRateDamping = 1 1
    AngleZ = -1 1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0 8.07921e+33
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = CylinderEmissionVolume
    Offset = X:0 Y:0 Z:80
  End
  Draw = DefaultDraw
  End
End

;-----------------------------------------------------------------

AIData
  LowLodTreeName = TreeLowLODGreyHavens
End

;-----------------------------------------------------------------

Object GondorRanger_Summoned ; these are the guys from the top of the walls which always guard

RemoveModule ModuleTag_LifetimeUpdate
KindOf = PRELOAD SELECTABLE UNATTACKABLE CAN_CAST_REFLECTIONS INFANTRY PATH_THROUGH_EACH_OTHER SCORE THROWN_OBJECT GRAB_AND_DROP ATTACK_NEEDS_LINE_OF_SIGHT ARCHER

CommandPoints = 0 


	LocomotorSet
		Locomotor = HumanLocomotor
		Condition = SET_NORMAL
		Speed     = 0
	End

End



PlayerTemplate FactionCivilian  ; makes ai able to fire spells
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End


PlayerTemplate FactionMen
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionElves
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionDwarves
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionIsengard
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End



PlayerTemplate FactionWild
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionMordor
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

PlayerTemplate FactionAngmar
IntrinsicSciencesMP = SCIENCE_EVIL SCIENCE_GOOD
PurchaseScienceCommandSetMP = FortressDefenseSpellStoreCommandSet
SpellBookMp = FortressDefenseSpellBook
StartingBuilding = NONE
StartingUnit0 = NONE
StartingUnit1 = NONE
End

;===============for the spellbook

Science SCIENCE_Fury
PrerequisiteSciences = SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Lottery
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_RallyingCall
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_EagleAllies
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Rebuild
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Snowbind
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_ArmyOfTheDead
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Flood
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Earthquake
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_SummonBalrog
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_Undermine
PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
SciencePurchasePointCost = 1
SciencePurchasePointCostMP = 1
IsGrantable = Yes
End

Science SCIENCE_PalantirVision
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_FreezingRain
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

Science SCIENCE_CloudBreak
  PrerequisiteSciences = SCIENCE_GOOD OR SCIENCE_EVIL
  SciencePurchasePointCost = 1
  SciencePurchasePointCostMP = 1
  IsGrantable = Yes
End

SpecialPower SpellBookFury
	Enum				= SPECIAL_SPELL_BOOK_FUEL_THE_FIRES
	RequiredSciences		= SCIENCE_Fury
	ReloadTime      		= 520000 ; in milliseconds

End

SpecialPower SpellBookEagleAllies
	Enum			= SPECIAL_SPELL_BOOK_EAGLE_ALLIES
	Flags					= WATER_OK RESPECT_RECHARGE_TIME_DISCOUNT
	RequiredSciences		= SCIENCE_EagleAllies
	ReloadTime      	= SPELL_RECHARGE_TIME_TIER_3 ; in milliseconds
	InitiateAtLocationSound = SpellEagleAlliesSummon	;EagleVoiceSelect
	RadiusCursorRadius	= 100.0
End

SpecialPower SpellBookSnowbind
	Enum				= SPECIAL_SPELL_BOOK_SNOWBIND
	RadiusCursorRadius		= 50			; Match the radius in FXList TaintFX
	RequiredSciences		= SCIENCE_Snowbind
	ReloadTime			= SPELL_RECHARGE_TIME_TIER_1		; in milliseconds
	InitiateAtLocationSound = SnowbindMS
	ViewObjectDuration		= 5000
	ViewObjectRange			= 175
	Flags			= NEEDS_OBJECT_FILTER RESPECT_RECHARGE_TIME_DISCOUNT
	ObjectFilter		= ANY ENEMIES NEUTRAL ALLIES +STRUCTURE
End

SpecialPower SpellBookLottery
	Enum				= SPECIAL_SPELL_BOOK_EYE_OF_SAURON
	RequiredSciences		= SCIENCE_Lottery
	ReloadTime      		= 440000 ; in milliseconds

End

SpecialPower SpellBookFreezingRain
  Enum              = SPECIAL_SPELL_BOOK_FREEZING_RAIN
  RequiredSciences   = SCIENCE_FreezingRain
  ReloadTime        = SPELL_RECHARGE_TIME_TIER_3
  InitiateSound     = ThunderStrikesStereo
  Flags				= RESPECT_RECHARGE_TIME_DISCOUNT
End

SpecialPower SpellBookCloudBreak
	Enum             = SPECIAL_SPELL_BOOK_CLOUD_BREAK
	RequiredSciences  = SCIENCE_CloudBreak
	ReloadTime       = 500000; SPELL_RECHARGE_TIME_TIER_3   	
	InitiateSound    = SpellCloudBreakStereo
	Flags			 = RESPECT_RECHARGE_TIME_DISCOUNT
End

ModifierList FuryBonus
	Category = LEVEL
	Modifier = DAMAGE_MULT    200% ; +100% damage
	Duration = 45000	        ; 45s			
End

CommandButton Command_SpellBookCalltheHorde          ;fury
	Command				= SPELL_BOOK
	SpecialPower		= SpellBookFury
	TextLabel			= CONTROLBAR:SoSBonus
	DescriptLabel		= CONTROLBAR:TooltipSoSBonus   
	ButtonImage			= SBEvil_CalltheHorde
	Options			= CANCELABLE
	ButtonBorderType   	= ACTION  ;UPGRADE
	InPalantir		= Yes
	Radial			= No
  UnitSpecificSound			= CaH_BerserkerRage
End


CommandButton Command_LurtzPillage                 ;lottery
  Command                 = SPELL_BOOK
  SpecialPower            = SpellBookLottery
	TextLabel			= CONTROLBAR:Lottery
	DescriptLabel		= CONTROLBAR:TooltipLottery
	ButtonImage			= HSBalrogIgnite
	Options			= CANCELABLE
	ButtonBorderType   	= ACTION  ;UPGRADE
	InPalantir		= Yes
	Radial			= No
  UnitSpecificSound			= GUI_GollumHappy
End


CommandSet FortressDefenseSpellBookCommandSet
	1 = Command_SpellBookScavenger
        2 = Command_SpellBookHeal
        3 = Command_SpellBookRallyingCall
        4 = Command_SpellBookCalltheHorde
        5 = Command_SpellBookWarChant
        6 = Command_LurtzPillage
        7 = Command_SpellBookRebuild
        8 = Command_SpellBookSnowbind
	9 = Command_SpellBookEagleAllies
       10 = Command_SpellBookFlood
       11 = Command_SpellBookBalrogAlly
       12 = Command_SpellBookArmyoftheDead
End

CommandSet FortressDefenseSpellStoreCommandSet ; this is generic, don't try to activate the spellstore (remove the script), or you will get GAMEDAT.error
	1 = Command_PurchaseSpellHeal
        4 = Command_PurchaseSpellScavenger
End


Object FortressDefenseSpellBook
CommandSet          = FortressDefenseSpellBookCommandSet
RadarPriority       = NOT_ON_RADAR
KindOf              = SPELL_BOOK IMMOBILE IGNORES_SELECT_ALL INERT



   AddModule 
	Behavior = SpecialPowerModule		SpellBookLottery_ModuleTag
		SpecialPowerTemplate		= SpellBookLottery
		UpdateModuleStartsAttack	= No
		AffectAllies			= No ; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   END

AddModule
	Behavior = OCLSpecialPower ModuleTag_Undermine
		SpecialPowerTemplate = SpellBookUndermine
		OCL                  = OCL_SpellBookUndermine
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = OCLSpecialPower ModuleTag_Earthquake
		SpecialPowerTemplate = SpellBookEarthquake
		OCL                  = OCL_SpellBookEarthquake
        ;TriggerFX			 = FX_ElvenAlliesSummon
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior				 = OCLSpecialPower ModuleTag_PalantirVision
		SpecialPowerTemplate = SpellBookPalantirVision
		OCL                  = SpecialPowerPalantirVision
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = OCLSpecialPower ModuleTag_SummonEagles
		SpecialPowerTemplate = SpellBookEagleAllies
		OCL                  = OCL_SpawnEagles
		CreateLocation       = CREATE_ABOVE_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = FreezingRainSpecialPower ModuleTag_FreezingRain
		SpecialPowerTemplate			= SpellBookFreezingRain
		AttributeModifierAffects		= ALL ENEMIES
		AntiCategory					= LEADERSHIP
		AntiFX							= FX_AntiLeadership ; FX for anti category
		AttributeModifierWeatherBased	= Yes
		WeatherDuration					= SPELL_FREEZINGRAIN_DURATION
		ChangeWeather					= RAINY
		AvailableAtStart				= No
		BurnRateModifier				= -100
		BurnDecayModifier				= 20
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = SpecialPowerModule		SpellBookWarChant_ModuleTag
		SpecialPowerTemplate		= SpellBookWarChant
		AttributeModifier			= SpellBookWarChant
		AttributeModifierRange		= 110
		AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MACHINE -IMMOBILE -DOZER +HERO -STRUCTURE -BASE_FOUNDATION -HORDE +DwarvenBattleWagon -RohanOathbreaker -MordorRamCrew +MordorWorker -IsengardRamCrew +IsengardBeserker
		TriggerFX					= FX_SpellWarChant
		UpdateModuleStartsAttack	= No
		AvailableAtStart			= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = SpecialPowerModule ModuleTag_RallyingCall
		SpecialPowerTemplate		= SpellBookRallyingCall
		AttributeModifier			= SpellBookRallyingCallModifier
		AttributeModifierRange		= 100
		AttributeModifierAffects	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER ;;,;; ANY +HORDE +INFANTRY -HERO -MordorBlackRiderHorde -MordorBlackRider -GondorKnightsofDol -GondorKnightsofDolHorde -IsengardFanatic -IsengardBerserkerHorde  -DwarvenZerker -DwarvenZerkerHorde -NoldorWarrior -NoldorWarriorHorde -WildBabyDrakeHorde -WildBabyDrake ;;.;; Added rest of MHH
		TriggerFX					= FX_SpellRallyingCall
		UpdateModuleStartsAttack	= No
		AvailableAtStart			= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End



AddModule                       ; for special AI                 ; he fires this constantly to areas where creeps exit to prevent lag ( he kills creeps that left map)
  	Behavior = OCLSpecialPower ModuleTag_RainOfFire
		SpecialPowerTemplate = SpellBookRainOfFire
		OCL                  = OCL_SpellBookRainOfFire
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = PlayerHealSpecialPower ModuleTag_Rebuild
		SpecialPowerTemplate = SpellBookRebuild
		HealAffects			 = STRUCTURE
		HealAsPercent		 	 = No
		HealAmount			 = 20000
		HealRadius			 = SPELL_REBUILD_RADIUS_STRUCTURE_SCAN
		HealFX				 = FX_SpellRebuild
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = SpecialPowerModule	SpellBookRebuild_ModuleTag2
		SpecialPowerTemplate		= SpellBookRebuild
		AttributeModifier			= SpellBookBuildingHeal
		AttributeModifierRange		= 200 ;75
		AttributeModifierAffects	= ANY +STRUCTURE
		TriggerFX					= FX_Industry
		UpdateModuleStartsAttack	= No
		AvailableAtStart			= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
 	Behavior   = SpecialPowerModule ModuleTag_Snowbind
		SpecialPowerTemplate		= SpellBookSnowbind
		AttributeModifier		= SpellBookSnowbind
		AttributeModifierRange		= SNOWBIND_EFFECT_RADIUS
		AttributeModifierAffects	= ANY ENEMIES ALLIES +STRUCTURE
		TriggerFX			= FX_SnowbindSpellFX
		UpdateModuleStartsAttack	= No
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
		;TargetEnemy 		= Yes	//This is VERY important because it defaults to false and overrides the AttributeModifier filter above!!!
		TargetAllSides = Yes
	End
End 

AddModule
	Behavior = OCLSpecialPower ModuleTag_SummonDead
		SpecialPowerTemplate = SpellBookArmyoftheDead
		OCL                  = OCL_GondorArmyofTheDeadEgg
		TriggerFX			 = FX_SummonAOD
		CreateLocation		 = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = OCLSpecialPower ModuleTag_Flood
		SpecialPowerTemplate = SpellBookFlood
		OCL                  = OCL_SpellBookFlood
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = OCLSpecialPower ModuleTag_SummonBalrog
		SpecialPowerTemplate = SpellBookBalrogAlly
		OCL                  = OCL_BalrogSummoning
		CreateLocation       = CREATE_AT_LOCATION
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule ModuleTag_Heal ;; added just in case it fully heals now
  	Behavior = PlayerHealSpecialPower ModuleTag_Heal
		SpecialPowerTemplate  = SpellBookHeal
		HealAffects			  = INFANTRY CAVALRY SHIP DOZER 
		HealAmount			  = 1.0 
		HealRadius			  = SPELL_HEAL_RADIUS_UNIT_SCAN	
		HealOCL               = OCL_HealSpellHordeReplenishPing
		AvailableAtStart	  = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
END

AddModule
	Behavior = ScavengerSpecialPower ModuleTag_Scavenger
		SpecialPowerTemplate	= SpellBookScavenger
		BountyPercent			= 1.0
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End


   AddModule 
	Behavior = SpecialPowerModule		ModuleTag_Fury
		SpecialPowerTemplate		= SpellBookFury
		UpdateModuleStartsAttack	= No
		AttributeModifier			= FuryBonus
		AttributeModifierRange		= 99999999.0 ; basically on the whole map
		AttributeModifierAffects	= ANY +INFANTRY +CAVALRY +MACHINE -IMMOBILE -DOZER +HERO -STRUCTURE -BASE_FOUNDATION -HORDE +DwarvenBattleWagon -RohanOathbreaker -MordorRamCrew +MordorWorker -IsengardRamCrew +IsengardBeserker
		AffectAllies			= No; Should not try to affect ally units
		AvailableAtStart		= No
		RequirementsFilterMPSkirmish	= SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic	= SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
   End



AddModule
	Behavior = OCLSpecialPower ModuleTag_Bombard
		SpecialPowerTemplate = SpellBookEvilBombard
		OCL                  = OCL_SpellBookBombardSeed
		CreateLocation       = USE_SECONDARY_OBJECT_LOCATION
		NearestSecondaryObjectFilter = NONE SAME_PLAYER +CASTLE_KEEP 
		AvailableAtStart	 = No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
	Behavior = CloudBreakSpecialPower	ModuleTag_CloudBreak
		SpecialPowerTemplate			= SpellBookCloudBreak
    	SunbeamObject					= CloudBreakSunbeam
		ObjectSpacing					= 300
		AttributeModifierAffects		= ANY +INFANTRY +CAVALRY +MONSTER -HERO ENEMIES
		ReEnableAntiCategory			= Yes ; cancel negative effects on good guys
		AttributeModifierWeatherBased	= Yes			
		WeatherDuration					= SPELL_CLOUDBREAK_DURATION
		ChangeWeather					= SUNNY
		AvailableAtStart				= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End

AddModule
 	Behavior   = DarknessSpecialPower ModuleTag_Darkness
		SpecialPowerTemplate			= SpellBookDarkness
		AttributeModifier				= SpellBookDarkness
		AttributeModifierAffects		= ANY +INFANTRY +CAVALRY +MONSTER -HERO -HORDE ALLIES
		AttributeModifierWeatherBased	= Yes			
		WeatherDuration					= 450000
		ChangeWeather					= CLOUDY
		AvailableAtStart				= No
		RequirementsFilterMPSkirmish = SPELL_BOOK_REQUIREMENTS_FILTER
		RequirementsFilterStrategic = SPELL_BOOK_REQUIREMENTS_FILTER_STRATEGIC
	End
End


END


;================================Fortress gate


Armor KeepGatesArmor

  Armor = DEFAULT         0%     ;this sets the level for all nonspecified damage types


  Armor = CRUSH          35%     ;fire damage
  Armor = HERO            60%     ;fire damage
  Armor = SPECIALIST      40%     ;fire damage
  Armor = URUK            35%     ;fire damage
  Armor = SLASH           30%     ;fire damage
  Armor = FLAME           10%     ;fire damage
  Armor = SIEGE          90%     ;siege damage
  Armor = STRUCTURAL     25%     ;structural damage - Grond inflicts this kind of damage
  Armor = MAGIC          15%     ;in case Gandalf or Saruman attack
  Armor = FORCE          45%     ;in case Gandalf or Saruman attack
  Armor = LOGICAL_FIRE	  0%	 ;Fire
End

CommandButton Command_StartSelfRepair
  Command		= START_SELF_REPAIR 
  TextLabel		= CONTROLBAR:StartSelfRepair
  ButtonImage		= UCCommon_Repair
  ButtonBorderType	= ACTION
  DescriptLabel 	= CONTROLBAR:ToolTipStartSelfRepair
  Radial		= No
  InPalantir	   	= No
End

CommandSet NewGateCommandSet
	1 = Command_ToggleGate
	2 = Command_StartSelfRepair
End


Object MordorCirithUngolGateDoor

ReplaceModule ModuleTag_Draw

  Draw = W3DScriptedModelDraw ModuleTag_DrawNew
    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState  
      Model = MBCUGateDr
    End


      ModelConditionState  = RUBBLE
      Model         = RBHDGatDr_D3  
    End
 	AnimationState = RUBBLE 
		Animation = Open 
			AnimationName	=	RBHDGatDr_D3.RBHDGatDr_D3
			AnimationMode	=	ONCE 
		End
    End

        
	AnimationState = DOOR_1_OPENING
		StateName = STATE_Open   
		Animation = Open 
			AnimationName	=	MBCUGateDr.MBCUGateDr
			AnimationMode	=	ONCE 
			AnimationBlendTime = 0
		End
		Flags = START_FRAME_LAST
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Closed" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
		EndScript
    End
    TransitionState = TRANS_Closed_To_Open
		Animation = Open 
			AnimationName	=	MBCUGateDr.MBCUGateDr
			AnimationMode	=	ONCE 
		End
    End
        
	AnimationState = DOOR_1_CLOSING 
		StateName = STATE_Closed 
		Animation = Close 
			AnimationName	=	MBCUGateDr.MBCUGateDr
			AnimationMode	=	ONCE_BACKWARDS 
			AnimationBlendTime = 0
		End
		Flags = START_FRAME_FIRST
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
		EndScript
    End
    TransitionState = TRANS_Open_To_Closed
		Animation = Open 
			AnimationName	=	MBCUGateDr.MBCUGateDr
			AnimationMode	=	ONCE_BACKWARDS 
		End
		Flags = START_FRAME_LAST
    End

  End
End

ReplaceModule ModuleTag_GATE
	Behavior = GateOpenAndCloseBehavior ModuleTag_GATEnew
		ResetTimeInMilliseconds = 11000 ; important! this must be longer than the gates animation, ir it will twitch
		OpenByDefault = Yes
		PercentOpenForPathing = 90
		SoundOpeningGateLoop = GateOpenStart
		SoundClosingGateLoop = GateCloseStart
		SoundFinishedOpeningGate = GateOpenEnd
		SoundFinishedClosingGate = GateCloseEnd
		TimeBeforePlayingOpenSound = 9500
		TimeBeforePlayingClosedSound = 9500
	End
End


	KindOf                = STRUCTURE IMMOBILE SELECTABLE BLOCKING_GATE WALL_GATE IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP
	RadarPriority = NOT_ON_RADAR
	KeepSelectableWhenDead	= Yes




  ArmorSet
    Conditions        = None
    Armor             = KeepGatesArmor
    DamageFX          = None
  End


	CommandSet = NewGateCommandSet
	VisionRange = 300


AddModule
	Behavior            = GettingBuiltBehavior GetBuiltBehaviorTag
		SelfBuildingLoop		= BuildingConstructionLoop	; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound			; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= BuildingConstructionLoop
		SpawnTimer			= -1.0				; Negative means no 'autoheal'
		RebuildTimeSeconds		= 20
	End
End

RemoveModule ModuleTag_SlowDeathWithoutRubble

AddModule
	Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
		AllowEnemies		= No
		AllowNonSkirmishAIUnits	= No
	End
End




AddModule
  Behavior = KeepObjectDie ModuleTag_IWantRubble
  End
End



AddModule
	Behavior = AIGateUpdate ModuleTage_AIGateUpdate
		TriggerWidthX = 600.0
		TriggerWidthY = 100.0
	End
End


ReplaceModule ModuleTag_02
	Body                  = ActiveBody ModuleTag_02New
		MaxHealth       = 40000.0
	End
End

END


;--------------------WELL

FXParticleSystem SpellHeal
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXHPicsubtle.tga
    Lifetime = 40 40
    SystemLifetime = 1
    SortLevel = 1
    BurstDelay = 2 2
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:16 G:86 B:49 20
    Color3 = R:0 G:0 B:0 40
  End
  Alpha = DefaultAlpha
  End
  Update = DefaultUpdate
    SizeRate = 5 5
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularRateZ = -0.1 0.1
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    EndPoint = X:0 Y:0 Z:20
  End
  Draw = DefaultDraw
  End
End

ModifierList DwarvenFortressBannersLeadership
	Category			= LEADERSHIP
	Modifier			= ARMOR 80%
	Modifier			= DAMAGE_MULT 200%
	Modifier			= RATE_OF_FIRE 110%
	Modifier			= RECHARGE_TIME 80%
	Modifier			= SPEED 200%
	Duration			= 3000
	FX				= FX_GenericLeadership
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
End

Object DaleFountain
KindOf = STRUCTURE IMMOBILE CAN_CAST_REFLECTIONS UNATTACKABLE
VisionRange = 450
AddModule
	Behavior = PassiveAreaEffectBehavior ModuleTag_SplashOfHealingWater_Ahh
		EffectRadius			= GONDOR_WELL_AOE_RADIUS
		PingDelay			= 2000;msec
		HealPercentPerSecond		= 3%
		AllowFilter			= ANY +INFANTRY +CAVALRY -MACHINE +MONSTER -IMMOBILE +DOZER
		NonStackable			= Yes
		HealFX				= FX_SpellHealUnitHealBuff
	End
End

AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership_NEW
		StartsActive	= Yes
		BonusName	= DwarvenFortressBannersLeadership
		RefreshDelay	= 2000
		Range		= GONDOR_WELL_AOE_RADIUS
		ObjectFilter	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
End

AddModule
	Behavior = BannerCarrierUpdate BannerCarrierUpdateModuleTag
		IdleSpawnRate			= 3000 ;				; spawn a new member every n seconds when idle (in miliseconds)		
		UnitSpawnFX			= FX_BannerCarrierSpawnUnit		; name of particle FX to use when the BannerCarrier spawns a new unit		

		; This well object acts like a banner carrier except it spawns unit on nearby hordes instead of itself.
		ReplenishNearbyHorde	= Yes
		ScanHordeDistance	= 200
	End
End
END


;-------------------------------------------------------------------

Armor HaradrimArmor
  Armor = DEFAULT         100%   ; 100%
  Armor = SLASH           100%   ; 100%
  Armor = PIERCE           25%   ;  50%
  Armor = SPECIALIST      100%   ;  50%
  Armor = CRUSH           200%   ; 200%
  Armor = CAVALRY	  200% ;
  Armor = SIEGE           100%   ;
  Armor = FLAME           100%   ;  30%
  Armor = MAGIC           100%   ;
  Armor = HERO            200%   ;
  Armor = HERO_RANGED     100%   ; 
  Armor = STRUCTURAL    100%    
  FlankedPenalty 	 = 50%    
  Armor = CAVALRY_RANGED   50% ; ;
End


Object MordorHaradrimArcherHorde
BuildCost = 450
End

Weapon HaradrimPalaceBow       ; BALANCE Archer Weapon
  AttackRange               = 300
  WeaponSpeed               = 321       ; dist/sec 
  MinWeaponSpeed            = 241
  MaxWeaponSpeed            = 481		; dist/sec Upper limit on scaling, when attacking past nominal "max" range
  FireFX                    = FX_RohanArcherBowWeapon
  ScaleWeaponSpeed          = Yes		; Used for lob weapons, scales speed proportional to range
  HitPercentage             = 100		;When this weapon is used it will hit exactly 50% of the time.
  ScatterRadius             = 16.0		;When this weapon misses it can randomly miss by as much as this distance.
  DelayBetweenShots         = 15
  PreAttackDelay            = 20   ; 1467 is the prep time for archer.
  PreAttackType             = PER_SHOT	; Do the delay each time we attack a new target
  FiringDuration            = 10    ; Duration of the archer firing shot is 500ms.
  IsAimingWeapon            = Yes
  AntiAirborneVehicle		= Yes
  AntiAirborneMonster		= Yes
  HitPassengerPercentage	= 20%
  AcceptableAimDelta		= 180.0	; We want to be able to shoot all round, as we canit move.

  CanBeDodged = Yes ; Will check for a DodgePercent on the target to have a second chance at failing HitPercent


  ProjectileNugget          ; Default arrow
    ProjectileTemplateName  = EvilFactionArrow
    WarheadTemplateName     = FortressArrowTowerBowWarhead
    ForbiddenUpgradeNames	= Upgrade_MordorHaradrimPalaceLevel3
  End
  ProjectileNugget          ; Default arrow
    ProjectileTemplateName  = EvilFactionFireArrow
    WarheadTemplateName     = FortressArrowTowerBowUpgradedWarhead
    RequiredUpgradeNames	= Upgrade_MordorHaradrimPalaceLevel3
  End

End

;=========================
;fixing bug not giving money

Object IsengardSharku
BountyValue = 350
End

Object IsengardLurtz
BountyValue = 300
End

;====================

Object BarrowWight
	LocomotorSet
		Locomotor = BarrowWightLocomotor
		Condition = SET_NORMAL
		Speed     = 52
	End
End

Armor GoblinFighterArmor
  Armor = DEFAULT         100%   ; 
  Armor = SLASH           150%   ; ; ; 100
  Armor = PIERCE           115%   ;  ; ; 150
  Armor = SPECIALIST      15%   ; ; ; 40
  Armor = CAVALRY	  150%   ;
  Armor = CRUSH           125%   ;  ; ; 100
  Armor = SIEGE           100%   ;
  Armor = FLAME           100%   ; 
  Armor = MAGIC           100%   ;
  Armor = HERO            200%   ;
  Armor = HERO_RANGED     200%   ; 
  Armor = STRUCTURAL	  100%	
  FlankedPenalty 	 = 33%     ; ; 50
  Armor = CAVALRY_RANGED   150% ; ;
End


Armor WildFighterScavengedArmor
  Armor = DEFAULT         50%   ; 
  Armor = SLASH           40%   ; 
  Armor = PIERCE           30%   ;  ; ; 75; ; 40
  Armor = SPECIALIST      10%   ; 
  Armor = CAVALRY	  120%   ;; ; 75
  Armor = CRUSH           65%   ;  ; ; 50
  Armor = SIEGE           50%   ;
  Armor = FLAME           30%   ; ; ; 50
  Armor = MAGIC           20%   ;; ; 50; ; 30
  Armor = HERO            100%   ;
  Armor = HERO_RANGED     100%   ; 
  Armor = STRUCTURAL	  20%	
  FlankedPenalty 	 = 50%      
  Armor = URUK   50% ; ;
End


Armor GoblinArcherArmor
  Armor = DEFAULT         100%
  Armor = SLASH           150%
  Armor = PIERCE          75% 
  Armor = SPECIALIST       100% 
  Armor = CRUSH            45% 
  Armor = SIEGE           150%
  Armor = FLAME           100%
  Armor = MAGIC           60%
  Armor = HERO            200%
  Armor = HERO_RANGED     75%
  Armor = CAVALRY	  200%  
  Armor = STRUCTURAL	  100%	
  FlankedPenalty 	 = 50%    
End


Armor WildMarauderHeavyArmor
  Armor = DEFAULT             50% ;40%
  Armor = SLASH               105% ;; ; 100; ; 90
  Armor = PIERCE             80% ; 20%; ; 65
  Armor = SPECIALIST          95% ; ; 50; ; 70
  Armor = CAVALRY	      5% ;
  Armor = CRUSH               5%  ;40%
  Armor = SIEGE               50% ;100%
  Armor = FLAME               75%  ; 0%; ; 50
  Armor = MAGIC               75% ;100%; ; 50
  Armor = HERO                80% ; 50%; ; 100
  Armor = HERO_RANGED         75% ; 50%  ; ; 100
  Armor = STRUCTURAL	  20%	
  FlankedPenalty 	 = 75%     
  Armor = CAVALRY_RANGED   30% ; ;
  Armor = URUK   115% ; ;
  Armor = POISON   25% ; ;
  DamageScalar = 130% ; ;
End


Object GoblinArcherHorde
BuildCost = 300
End

Object GoblinFighterHorde
BuildCost = 25
BuildTime = 12 ; 12s
End

Object IsengardUrukCrossbowHorde
BuildCost = 400
End

Object DwarvenMenOfDaleHorde
BuildCost = 400
End

;=============Attack troll no longer dies in 1s to pikes

Armor AttackTrollArmor
  Armor = DEFAULT         25%   
  Armor = SLASH           40%  ;50%
  Armor = PIERCE          25%   
  Armor = SPECIALIST     125%  ;  200%
  Armor = CRUSH            1%  
  Armor = CAVALRY	  25% 

  Armor = SIEGE           50%   ;
  Armor = FLAME           50% 
  Armor = MAGIC           35%   ;50%
  Armor = HERO            100%   ;
  Armor = HERO_RANGED     100%  
  Armor = STRUCTURAL    25%    
  FlankedPenalty 	 = 50%    
  Armor = CAVALRY_RANGED   50% ; ;
End

;================same about drummer

Armor TrollHeavyArmor
  Armor = DEFAULT         80%   ; 100%
  Armor = SLASH           65%   ; 100%
  Armor = PIERCE           15%   ;  50%; ; 50
  Armor = SPECIALIST      65%   ;  50%
  Armor = CRUSH           100%   ; 200%
  Armor = CAVALRY	  50% ;
  Armor = SIEGE           100%   ;
  Armor = FLAME           15%   ;  30%; ; 100
  Armor = MAGIC           15%   ;; ; 100
  Armor = HERO            150%   ;
  Armor = HERO_RANGED     75%   ; ; ; 200
  Armor = STRUCTURAL    10%    
  FlankedPenalty 	 = 50%    
  Armor = CAVALRY_RANGED   50% ; ;
End



Object MordorAttackTroll
BuildCost = 600
End

Object ElvenRivendellLancerHorde
BuildCost = 400
End

Object ElvenMithlondSentryHorde
BuildCost = 250
End

Object DwarvenAxethrowerHorde
BuildCost = 300
End

Object GondorRangerHorde
BuildCost = 500
End


Object ElvenMirkwoodArcherHorde
BuildCost = 800
End

Object WildMarauderHorde
BuildCost = 350
End

Object IsengardBerserker
BuildCost = 200
End

Object AngmarDarkRangerHorde
BuildCost = 500
End

Object GondorTowerShieldGuardHorde
BuildCost = 300
End

;========================Wildmen torches no longer hurt themselves

Object IsengardWildmanHorde
BuildCost = 200
End

Weapon IsengardWildmanCudgel  ; BALANCE
	LeechRangeWeapon	= Yes
	AttackRange			= 30.0
	MeleeWeapon			= Yes
	DelayBetweenShots	= ISENGARD_WILDMAN_DELAYBETWEENSHOTS            ; time between shots, msec
	PreAttackDelay		= ISENGARD_WILDMAN_PREATTACKDELAY             ; 433 is natural time of the stabbing animation.
	PreAttackType		= PER_SHOT ; Do the delay each time we attack a new target
	FiringDuration		= ISENGARD_WILDMAN_FIRINGDURATION            ; min 600 for anim
	FireFX				= FX_GondorSwordHit
	FireFlankFX			= FX_Flanking
        RadiusDamageAffects = ENEMIES NOT_SIMILAR
End

;==========================DRUMMER TROLL I WANT TO REMOVE HIS JUST_BUILT ANIM


Object MordorDrummerTroll

ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01New  
		  
		  OkToChangeModelColor = Yes
		  
		  StaticModelLODMode = Yes
		  
		DefaultModelConditionState
			Model               = MuDrmTroll_SKN
			Skeleton			= MuDrmTroll_SKL
		End
		
		IdleAnimationState
			StateName = STATE_Idle
			
			Animation           		= SticksDownBreathe
				AnimationName     	= MuDrmTroll_IDLB
				AnimationMode     	= ONCE
				AnimationPriority	= 10
			End
			Animation           		= SticksDownBreathe
				AnimationName     	= MuDrmTroll_IDLB
				AnimationMode     	= ONCE
				AnimationPriority	= 10
			End
			Animation           		= ButtScratch										    
				AnimationName     	= MuDrmTroll_IDLC
				AnimationMode     	= ONCE
				AnimationPriority	= 1
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Selected" then CurDrawableSetTransitionAnimState("TRANS_SelectedToIdle") end
			EndScript
		End
	
	ModelConditionState = DYING BURNINGDEATH
		Model               = MuDrmTroll_SKN		
	End

	AnimationState			= DYING BURNINGDEATH
		Animation
			AnimationName	= MuDrmTroll_DTHA
			AnimationMode	= ONCE
			AnimationBlendTime = 10
		End
	End

		
	; Splatted death goes first, independant of death flags
	ModelConditionState    = DYING DECAY SPLATTED
		Model                = MUDrmTroll_DISB
		Skeleton			 = MUDrmTroll_DISB 
		RetainSubObjects = Yes
	End;

	AnimationState         = DYING DECAY SPLATTED 
		Animation            = dead1
			AnimationName       = MUDrmTroll_DISB
			AnimationMode      = ONCE
		End
	End

	ModelConditionState    = DYING DECAY 
		Model                = MUDrmTroll_DISA
		Skeleton			 = MUDrmTroll_DISA
		RetainSubObjects = Yes
	End;

	AnimationState         = DYING DECAY  
		Animation            = dead1
			AnimationName       = MUDrmTroll_DISA
			AnimationMode      = ONCE
		End
	End

		AnimationState			= BURNINGDEATH
			Animation
				AnimationName	= MuDrmTroll_MFDA
				AnimationMode	= LOOP
				Distance		= 100
			End
		End

		AnimationState        			= STUNNED_FLAILING
			Animation           		= FLYA
				AnimationName     	= MuDrmTroll_FLYA
				AnimationMode     	= LOOP
			End
		End
		
		AnimationState = DYING SPLATTED
			Animation
				AnimationName = MuDrmTroll_LNDA
				AnimationMode = ONCE
			End
		End

		ModelConditionState = DYING
			Model               = MuDrmTroll_SKN		
		End

		AnimationState        			= DYING
			Animation           		= DIEA
				AnimationName     	= MuDrmTroll_DTHA
				AnimationMode     	= ONCE
			End
			ParticleSysBone = B_PELVIS TrollDrmSplatDust FollowBone:Yes
			ParticleSysBone = BAT_HEAD TrollDrmSplatDust FollowBone:Yes
		End

		//Turned to Stone
		ModelConditionState = STONED 
			Model			= MuDrmTroll_SKN
			Texture			= MuDrmTroll.tga MUDrmTroll_R.tga
		End 		

		AnimationState		= STONED
			Animation			= Stoned
				AnimationName		= MuDrmTroll_IDLB
				AnimationMode		= MANUAL
				AnimationBlendTime	= 10
			End
			Flags	= START_FRAME_LAST
		End
		
		AnimationState        			= STUNNED_STANDING_UP
			Animation           		= GTPA
				AnimationName     	= MuDrmTroll_GTPA
				AnimationMode     	= ONCE
			End
		End
		
		AnimationState        			= STUNNED
			Animation           		= LNDA
				AnimationName     	= MuDrmTroll_LNDA
				AnimationMode     	= ONCE
			End
			ParticleSysBone = B_PELVIS TrollDrmFallDust FollowBone:Yes
			ParticleSysBone = BAT_HEAD TrollDrmFallDust FollowBone:Yes
		End

		
		AnimationState						= PARALYZED
			Animation
				AnimationName				= MuDrmTroll_IDLB
				AnimationMode				= LOOP
			End
		End

		AnimationState = PACKING_TYPE_1										; The roar special power.
			Animation
				AnimationName = MuDrmTroll_IDLD 
				AnimationMode = LOOP
			End
			EnteringStateFX = FX_FearBlast
		End

		AnimationState = MOVING FIRING_OR_PREATTACK_A
			Animation = TrotAndFire
				AnimationName = MuDrmTroll_ATRA
				AnimationMode = LOOP
			End
			Flags = RANDOMSTART
			;ParticleSysBone = None InfantryDustTrails
		End
		
		
		AnimationState 				= TURN_LEFT
			Animation = Moving
				AnimationName 		= MuDrmTroll_TRNL
				AnimationMode 		= LOOP
				AnimationBlendTime 	= 10
			End
			ParticleSysBone = None InfantryDustTrails
		End

		AnimationState 				= TURN_RIGHT
			Animation = Moving
				AnimationName 		= MuDrmTroll_TRNR
				AnimationMode 		= LOOP
				AnimationBlendTime 	= 10
			End
			ParticleSysBone = None InfantryDustTrails
		End
		
		AnimationState				= MOVING PANICKING
			Animation			= RUNM
				AnimationName		= MuDrmTroll_MFDA
				AnimationMode		= LOOP
			End
			Flags				= RANDOMSTART
		End
		
		AnimationState				= MOVING WANDER
			Animation			= WLKA
				AnimationName		= MuDrmTroll_WLKA
				AnimationMode		= LOOP
			End
			FXEvent	= Frame:6 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:26 FireWhenSkipped Name:FX_TrollLeftFootStep
			FXEvent	= Frame:45 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:65 FireWhenSkipped Name:FX_TrollLeftFootStep
		End

		AnimationState = MOVING
			Animation = Moving
				AnimationName 		= MuDrmTroll_WLKA
				AnimationMode 		= ONCE
				AnimationPriority = 20
				Distance = 55 
			End
			Animation = Moving
				AnimationName 		= MuDrmTroll_WLKA
				AnimationMode 		= ONCE
				AnimationPriority = 20
				Distance = 55 
			End
			Animation = DrumCorp
				AnimationName 		= MuDrmTroll_WLKB
				AnimationMode 		= ONCE
				AnimationPriority = 1
				Distance = 55 
			End
			Flags = RESTART_ANIM_WHEN_COMPLETE
			FXEvent	= Frame:6 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:26 FireWhenSkipped Name:FX_TrollLeftFootStep
			FXEvent	= Frame:45 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:65 FireWhenSkipped Name:FX_TrollLeftFootStep
		End
		
		AnimationState        			= FIRING_OR_PREATTACK_A
			Animation           		= StickSwipe
				AnimationName     	= MuDrmTroll_ATKA
				AnimationMode = ONCE
				UseWeaponTiming = Yes
			End
			Animation           		= FrontKick
				AnimationName     	= MuDrmTroll_ATKB
				AnimationMode = ONCE
				UseWeaponTiming = Yes
			End
;			ParticleSysBone = B_STICKR TrollDrmAtk  FollowBone:Yes        ;removed because kick has Dust Effect
			BeginScript
				if CurDrawableIsCurrentTargetKindof("STRUCTURE") or CurDrawableIsCurrentTargetKindof("MONSTER") then
					return ("FrontKick")
				else
					return ("StickSwipe")
				end
			EndScript
		End
		
    	AnimationState 				= HIT_REACTION HIT_LEVEL_1 SELECTED
			Animation 			= Hit_Level_1_a
	      			AnimationName 		= MuDrmTroll_HITB
		    		AnimationMode = ONCE
			End
    	End

    	AnimationState 				= HIT_REACTION HIT_LEVEL_1
			Animation 			= Hit_Level_1_a
	      			AnimationName 		= MuDrmTroll_HITA
		    		AnimationMode = ONCE
			End
    	End

    	AnimationState = WAR_CHANT
			Animation = Chant
				AnimationName = MuDrmTroll_IDLD 
				AnimationMode = LOOP
			End
		End
		
		AnimationState        = SELECTED
			StateName           = STATE_Selected
			Animation           = SticksUpBreathe
				AnimationName     = MuDrmTroll_ATNB
				AnimationMode     = ONCE
				AnimationPriority = 10
			End
			Animation           = SticksUpBreathe
				AnimationName     = MuDrmTroll_ATNB
				AnimationMode     = ONCE
				AnimationPriority = 10
			End
			
			Flags = RESTART_ANIM_WHEN_COMPLETE
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_Idle" then CurDrawableSetTransitionAnimState("TRANS_IdleToSelected") end
			EndScript
		End


			
		TransitionState       = TRANS_IdleToSelected
			Animation           = ATNA
				AnimationName     = MuDrmTroll_ATNA
				AnimationMode     = ONCE
				AnimationSpeedFactorRange = 0.9 1.0
			End
		End
		TransitionState       = TRANS_SelectedToIdle
			Animation           = ATNA
				AnimationName     = MuDrmTroll_ATNA
				AnimationMode     = ONCE_BACKWARDS 
				AnimationSpeedFactorRange = 0.9 1.0
			End
			Flags = START_FRAME_LAST
		End

	End
End

END


Object MordorAttackTroll

ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01New
		WadingParticleSys = EntRipples
		OkToChangeModelColor = Yes
		ExtraPublicBone = Trunk
		ShowShadowWhileContained = Yes
		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD

		DefaultModelConditionState
			Model = MUAtkTroll_SKN
		End

		AnimationState = DYING DEATH_3
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode = LOOP
			End
		End

		; Splatted death goes first, independant of death flags
		ModelConditionState    = DYING DECAY SPLATTED USER_4
			Model                = MUAtkTr2_DISC
			RetainSubObjects = Yes
		End
		ModelConditionState    = DYING DECAY SPLATTED
			Model                = MUAtkTroll_DISC

			RetainSubObjects = Yes
		End

		AnimationState         = DYING DECAY SPLATTED 
			Animation            = dead1
				AnimationName       = MUAtkTroll_DISC.MUAtkTroll_DISC
				AnimationMode      = ONCE
			End
		End

		ModelConditionState    = DYING DECAY DEATH_1 USER_4
			Model                = MUAtkTr2_DISA
			RetainSubObjects = Yes
		End;
		ModelConditionState    = DYING DECAY DEATH_1
			Model                = MUAtkTroll_DISA
			RetainSubObjects = Yes
		End;

		AnimationState         = DYING DECAY DEATH_1 
			Animation            = dead1
				AnimationName       = MUAtkTroll_DISA.MUAtkTroll_DISA
				AnimationMode      = ONCE
			End
		End
		
		ModelConditionState    = DYING DECAY DEATH_2 USER_4
			Model                = MUAtkTr2_DISB
			RetainSubObjects = Yes
		End;
		ModelConditionState    = DYING DECAY DEATH_2
			Model                = MUAtkTroll_DISB
			RetainSubObjects = Yes
		End;

		AnimationState         = DYING DECAY DEATH_2 
			Animation            = dead1
				AnimationName       = MUAtkTroll_DISB.MUAtkTroll_DISB
				AnimationMode      = ONCE
			End
		End

		; Flailing must go before dying in case we are dead in the air
		AnimationState = STUNNED_FLAILING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_FLYA
				AnimationMode = LOOP
			End
		End

		AnimationState = DYING SPLATTED
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_LNDA
				AnimationMode = ONCE
			End
		End


		AnimationState = DYING DEATH_1
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_DIEA
				AnimationMode = ONCE
			End
			ParticleSysBone = B_PELVIS TrollSplatDust
			ParticleSysBone = BAT_HEAD TrollSplatDust
		End

		AnimationState = DYING DEATH_2
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_DIEB
				AnimationMode = ONCE
			End
			ParticleSysBone = BAT_SPINE1 TrollSplatDust1
			ParticleSysBone = BAT_HEAD TrollSplatDust1
		End
		
		ModelConditionState = DYING USER_4
			Model = MUAtkTr2_SKN
		End
		ModelConditionState = DYING
			Model = MUAtkTroll_SKN
		End

		AnimationState = DYING
			Animation
				AnimationName     =  MUMntTroll_SKL.MUMntTroll_DIEB
				AnimationMode     = ONCE
			End
		End

		//Turned to stone
		ModelConditionState = STONED USER_4
			Model			= MUAtkTr2_SKN
			Texture			= MUAttkTroll.tga MUAttkTroll_R.tga
		End 		
		ModelConditionState = STONED 
			Model			= MUAtkTroll_SKN
			Texture			= MUAttkTroll.tga MUAttkTroll_R.tga
		End 		

		AnimationState		= STONED
			Animation			= Stoned
				AnimationName		= MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode		= MANUAL
				AnimationBlendTime	= 10
			End
			Flags	= START_FRAME_LAST
		End

		; Flailing must go before dying in case we are dead in the air
		AnimationState = STUNNED_FLAILING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_FLYA
				AnimationMode = LOOP
			End
		End

		AnimationState				= STUNNED_STANDING_UP
			Animation				= MUMntTroll_GTPA
				AnimationName		= MUMntTroll_SKL.MUMntTroll_GTPA
				AnimationMode		= ONCE
			End
		End	

		AnimationState				= STUNNED
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_LNDA
				AnimationMode = ONCE
			End
			ParticleSysBone = B_PELVIS TrollSplatDust2
			ParticleSysBone = BAT_HEAD TrollSplatDust2
		End

		AnimationState						= PARALYZED
			Animation
				AnimationName				= MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode				= LOOP
			End
		End

		;--Troll is angry
		AnimationState = WEAPONSET_RAMPAGE
			Animation = GetMad
				AnimationName = MUMntTroll_SKL.MUMntTroll_RPGC
				AnimationMode = LOOP
			End
		End

		; --------- With Club ------------
		AnimationState = FIRING_OR_PREATTACK_A
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKC
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKD
				AnimationMode = ONCE
				UseWeaponTiming		= Yes
			End
		End

		;Running attack
		AnimationState = MOVING FIRING_OR_PREATTACK_B
			Animation

				AnimationName = MUMntTroll_SKL.MUMntTroll_ATRA
				AnimationMode = LOOP
				UseWeaponTiming		= Yes
			End
		End
			
		AnimationState = PREPARING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_GRBC
				AnimationMode = ONCE
			End

		End

		IdleAnimationState
			Animation = BreathWithClub
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode = ONCE
				AnimationPriority = 30
				AnimationSpeedFactorRange = 0.8 1.0
			End
			Animation = BreathWithClub
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLB
				AnimationMode = ONCE
				AnimationPriority = 30
				AnimationSpeedFactorRange = 0.8 1.0
			End
			Animation = IDLE
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLE  ;ROAR THEN HIT GROUND (holding club only)
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 5
			End
			Animation = IDLG
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLG  ;BUTT SCRATCH THEN BURP
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 10
			End
			Flags = RESTART_ANIM_WHEN_COMPLETE
			BeginScript ; Here since normal Packing state can be skipped with a fast click.
				CurDrawableShowSubObjectPermanently("Trunk01")
			EndScript
		End


		; --------- With Bare Hands ------------
		AnimationState = UNPACKING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLH
				AnimationMode = ONCE
			End
		End

		AnimationState = TURN_LEFT
			Animation = Moving
				AnimationName = MUMntTroll_SKL.MUMntTroll_TRNL
				AnimationMode = LOOP
				AnimationBlendTime = 10
			End
			ParticleSysBone = None InfantryDustTrails
		End

		AnimationState = TURN_RIGHT
			Animation = Moving
				AnimationName = MUMntTroll_SKL.MUMntTroll_TRNR
				AnimationMode = LOOP

				AnimationBlendTime = 10
			End
			ParticleSysBone = None InfantryDustTrails
		End


		;AnimationState = MOVING ATTACKING
		;	Animation
		;		AnimationName = MUMntTroll_SKL.MUMntTroll_RUNA  ; Running with club
		;		AnimationMode = LOOP
		;		AnimationSpeedFactorRange = 0.77 0.77
		;	End
		;	Flags               = RANDOMSTART
		;	ParticleSysBone     = None InfantryDustTrails
		;	FXEvent	= Frame:5 FireWhenSkipped Name:FX_TrollRightFootStep
		;	FXEvent	= Frame:17 FireWhenSkipped Name:FX_TrollLeftFootStep
		;End

		AnimationState				= MOVING PANICKING
			Animation				= RUNM
				AnimationName		=  MUMntTroll_SKL.MUMntTroll_MFDA
				AnimationMode		= LOOP
			End
			Flags					= RANDOMSTART
		End

		;AnimationState = MOVING DAMAGED
		;	Animation
		;		AnimationName = MUMntTroll_SKL.MUMntTroll_WLKB ; Walking with club
		;		AnimationMode = LOOP
		;		AnimationSpeedFactorRange = 1.3 1.3
		;	End
		;	Flags               = RANDOMSTART
		;	ParticleSysBone     = None InfantryDustTrails
		;	FXEvent	= Frame:22 FireWhenSkipped Name:FX_TrollLeftFootStep
		;	FXEvent	= Frame:3 FireWhenSkipped Name:FX_TrollRightFootStep
		;End


		;AnimationState = MOVING
		;	Animation
		;		AnimationName = MUMntTroll_SKL.MUMntTroll_WLKB ; Walking with club 
		;		AnimationMode = LOOP
		;		AnimationSpeedFactorRange = 1.36 1.36
		;	End
		;	Flags               = RANDOMSTART
		;	ParticleSysBone     = None InfantryDustTrails
		;	FXEvent	= Frame:22 FireWhenSkipped Name:FX_TrollLeftFootStep
		;	FXEvent	= Frame:3 FireWhenSkipped Name:FX_TrollRightFootStep	
		;End

		AnimationState = MOVING
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_RUNA  ; Running with club
				AnimationMode = LOOP
				;AnimationSpeedFactorRange = 0.77 0.77
			End
			Flags               = RANDOMSTART
			ParticleSysBone     = None InfantryDustTrails
			FXEvent	= Frame:5 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:17 FireWhenSkipped Name:FX_TrollLeftFootStep
		End


		AnimationState = ENGAGED
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLA
				AnimationMode = LOOP
			End
		End


		AnimationState = DESTROYED_WEAPON
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_ATKA
				AnimationMode = ONCE
			End
		End

		; --------- Just built ------------

		AnimationState = JUST_BUILT
			Animation
				AnimationName = MUMntTroll_SKL.MUMntTroll_WLKC ; temp
				AnimationMode = ONCE
				AnimationBlendTime = 0
				AnimationSpeedFactorRange = 0.9 0.9			
			End
			FXEvent	= Frame:0 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:16 FireWhenSkipped Name:FX_TrollLeftFootStep
			FXEvent	= Frame:30 FireWhenSkipped Name:FX_TrollRightFootStep
			FXEvent	= Frame:44 FireWhenSkipped Name:FX_TrollLeftFootStep
		End	

		; --------- Click and Hit Reactions ------------

		AnimationState = HIT_REACTION HIT_LEVEL_1
			Animation = Hit_Level_1_a
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITC
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION HIT_LEVEL_2
			Animation = Hit_Level_2
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITB
				AnimationMode = ONCE
			End
		End

		AnimationState = HIT_REACTION HIT_LEVEL_3
			Animation = Hit_Level_3
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITA
				AnimationMode = ONCE
			End
		End

		AnimationState = REACT_1
			Animation = Click_React_1
				AnimationName = MUMntTroll_SKL.MUMntTroll_RCTA
				AnimationMode = ONCE
			End
		End

		AnimationState = REACT_2
			Animation = Click_React_2
				AnimationName = MUMntTroll_SKL.MUMntTroll_RCTB
				AnimationMode = ONCE
			End
		End

		AnimationState = REACT_3
			Animation = Click_React_3
				AnimationName = MUMntTroll_SKL.MUMntTroll_RCTC
				AnimationMode = ONCE
			End
		End

		AnimationState = REACT_4
			Animation = Click_React_4
				AnimationName = MUMntTroll_SKL.MUMntTroll_RCTD
				AnimationMode = ONCE
			End
		End

		AnimationState = REACT_5
			Animation = Click_React_5
				AnimationName = MUMntTroll_SKL.MUMntTroll_RCTE
				AnimationMode = ONCE
			End
		End

		AnimationState = USER_2
			Animation = ReactToTrollPoke ; The two comes from the special TrollBored weapon
				AnimationName = MUMntTroll_SKL.MUMntTroll_HITE
				AnimationMode = ONCE
			End
		End

		AnimationState = USER_3 
			Animation = ExpectAnotherPoke ; The three comes from the special TrollBored weapon, and lasts longer than 2
				AnimationName = MUMntTroll_SKL.MUMntTroll_IDLJ
				AnimationMode = LOOP
			End
		End

		;-----------------------------------
		;Emotion

		AnimationState = EMOTION_CELEBRATING
			Animation
				AnimationName	=	MUMntTroll_SKL.MUMntTroll_IDLF
				AnimationMode	=	LOOP
			End
		End
		
		AnimationState					= EMOTION_TAUNTING
			Animation
				AnimationName			= MUMntTroll_SKL.MUMntTroll_IDLA
				AnimationMode			= ONCE
				AnimationPriority		= 20
			End
			Animation					= Taunting3
				AnimationName			= MUMntTroll_SKL.MUMntTroll_IDLH
				AnimationMode			= ONCE
				AnimationPriority		= 10
			End
			Animation					= Taunting4
				AnimationName			= MUMntTroll_SKL.MUMntTroll_IDLE
				AnimationMode			= ONCE
				AnimationPriority		= 5
			End
		End

		ModelConditionState = USER_4 
			Model			= MUAtkTr2_SKN
		End 		
	End
End

END

;=================EXP TOWER=======================


Object DwarvenEreborTowerTowerExpansion

Scale = 0.8

ReplaceModule ModuleTag_Draw
  Draw = W3DScriptedModelDraw ModuleTag_DrawNew

		ExtraPublicBone	= Arrow_01
		ExtraPublicBone	= Arrow_02
		ExtraPublicBone	= Arrow_03
		ExtraPublicBone	= Arrow_04
		ExtraPublicBone	= Arrow_05
		ExtraPublicBone	= Arrow_06
		ExtraPublicBone	= Arrow_07
		ExtraPublicBone	= Arrow_08
		ExtraPublicBone	= Arrow_09
		ExtraPublicBone	= Arrow_10
		ExtraPublicBone	= Arrow_11
		ExtraPublicBone	= Arrow_12

    OkToChangeModelColor  = Yes
    UseStandardModelNames = Yes

    DefaultModelConditionState
      Model = DB_houses_05
	WeaponLaunchBone =   PRIMARY ARROW_	
    End
    
    ; ---------- destruction states

		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = DB_houses_05			
		End
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = DBFDoor_DRA
				AnimationName     = DB_houses_05SKL.DBFTower_ABLD
				AnimationMode     = MANUAL
			End
			Flags				  = START_FRAME_FIRST
			ParticleSysBone = NONE BuildingContructDustExp
			ParticleSysBone = NONE ExpDwarves
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End


    
    ModelConditionState  = DAMAGED
      Model         = DBhouse5_D1
      ParticleSysBone DUSTBONE01 FireBuildingSmall
      ParticleSysBone DUSTBONE02 FireBuildingSmall
      ParticleSysBone DUSTBONE03 FireBuildingSmall
      ParticleSysBone FireMedium01 FireBuildingMedium
      ParticleSysBone FireMedium02 FireBuildingMedium
      ParticleSysBone FireLarge01 FireBuildingLarge
      ParticleSysBone SmokeLarge01 SmokeBuildingLarge
    End
	AnimationState = DAMAGED
		EnteringStateFX	= FX_BuildingDamaged
	End
	
    ModelConditionState  = REALLYDAMAGED
      Model         = DBhouse5_D2
      ParticleSysBone DUSTBONE01 FireBuildingSmall
      ParticleSysBone DUSTBONE02 FireBuildingSmall
      ParticleSysBone DUSTBONE03 FireBuildingSmall
      ParticleSysBone FireMedium01 FireBuildingMedium
      ParticleSysBone FireMedium02 FireBuildingMedium
      ParticleSysBone FireLarge01 FireBuildingLarge
    End
    
    AnimationState = REALLYDAMAGED
  		Animation				=	RubbleAnimation
			AnimationName		=	 DBhouse5_D2.DBhouse5_D2
			AnimationMode		=	ONCE
		End
		EnteringStateFX	= FX_BuildingReallyDamaged
	End
    
    ModelConditionState  = RUBBLE
		Model         = DBhouse5_D3
	End
		
	AnimationState = RUBBLE
  		Animation				=	RubbleAnimation
			AnimationName		=	 DBhouse5_D3.DBhouse5_D3
			AnimationMode		=	ONCE
		End
		EnteringStateFX	= FX_StructureMediumCollapse
	End
End

	WeaponSet
		Conditions			= None
		Weapon				= PRIMARY RohanStructureBow  
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End


	WeaponSet
		Conditions			= PLAYER_UPGRADE
		Weapon				= PRIMARY HaradrimPalaceBow  
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
End


AddModule
	Behavior = GrantUpgradeCreate ModuleTag_FireArrowNew
         UpgradeToGrant = Upgrade_MordorHaradrimPalaceLevel3
     End
End


AddModule
	Behavior = CastleUpgrade ModuleTag_PassOutFlamingMunitionsUpgrade
		TriggeredBy	= Upgrade_GoodFortressFlamingMunitionsTrigger
		Upgrade		= Upgrade_GoodFortressFlamingMunitions
	End
End

AddModule
	Behavior = StatusBitsUpgrade ModuleTag_FakeOut2 ;// I need to react to the upgrade, so I can have it for when new construction asks me for all the upgrades
		TriggeredBy	= Upgrade_GoodFortressFlamingMunitions
	End
End

AddModule
	Behavior = WeaponSetUpgrade ModuleTag_triggerweaponsetupgrade
		TriggeredBy	= Upgrade_GoodFortressFlamingMunitionsTrigger
	End
End

ReplaceModule ModuleTag_05
	Body                      = StructureBody ModuleTag_05New
		MaxHealth               = 4000
		MaxHealthDamaged        = 2000
		MaxHealthReallyDamaged  = 1000
	End
End

END

CommandButton Command_ConstructDwarvenEreborTowerTowerExpansion
	Command          = FOUNDATION_CONSTRUCT
	Object           = DwarvenEreborTowerTowerExpansion
	TextLabel        = CONTROLBAR:ConstructDwarvenEreborTowerTowerExpansion
	ButtonImage      = BDFortress_AxeTower
	ButtonBorderType = BUILD 
	DescriptLabel    = CONTROLBAR:ToolTipConstructDwarvenEreborTowerTowerExpansion
	Radial           = Yes  
End 

CommandSet  DwarvenFortressExpansionPadCornerCommandSetNew
	1 = Command_ConstructWildBurrowsExpansion
	2 = Command_ConstructDwarvenHallExpansion
	3 = Command_ConstructDwarvenEreborTowerTowerExpansion
	4 = Command_ConstructWildSpiderHolesExpansion
	5 = Command_ConstructAngmarKennelExpansion
	6 = Command_ConstructMordorGateWatchersExpansion
	7 = Command_ConstructIsengardMineLauncherExpansion
	8 = Command_ConstructElvenFloodgateExpansion
End

Object DwarvenFortressExpansionPadCorner
CommandSet = DwarvenFortressExpansionPadCornerCommandSetNew
End

;================================

CommandButton Command_ConstructDwarvenBattleWagon
	Command				= UNIT_BUILD
	Object				= DwarvenBattleWagon
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructDwarvenBattleWagon
	ButtonImage			= BDForgeWorks_Battlewagon
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildDwarvenBattleWagonNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes    
End

CommandButton Command_ConstructDwarvenMenOfDaleHorde
	Command				= UNIT_BUILD
	Object				= DwarvenMenOfDaleHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructDwarvenMenOfDale
	ButtonImage			= BDArcheryRange_MenofDale
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildDwarvenMenOfDaleHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructGondorRangerHorde
	Command				= UNIT_BUILD
	Object				= GondorRangerHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructGondorRangerHorde
	ButtonImage			= BGArcheryRange_Rangers
	ButtonBorderType		= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildGondorRangerHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructGondorKnightHorde
	Command				= UNIT_BUILD
	Object				= GondorKnightHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructGondorKnightHorde
	ButtonImage			= BGStables_Knights
	ButtonBorderType    = BUILD 
	DescriptLabel       = CONTROLBAR:ToolTipBuildGondorKnightHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes      
End

CommandButton Command_ConstructGondorTowerShieldGuardHorde
	Command				= UNIT_BUILD
	Object				= GondorTowerShieldGuardHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructGondorShieldGuardHorde
	ButtonImage			= BGBarracs_Guards
	ButtonBorderType		= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildGondorTowerShieldGuardHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructElvenMirkwoodArcherHorde
	Command				= UNIT_BUILD
	Object				= ElvenMirkwoodArcherHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructElvenMirkwoodArcherHorde
	ButtonImage			= BEElvenBarracks_MirkwoodArcher
	ButtonBorderType		= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildElvenMirkwoodArcherHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructElvenRivendellLancers
	Command				= UNIT_BUILD
	Object				= ElvenRivendellLancerHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:BuildElvenRivendellLancers
	ButtonImage			= BEGreenPasture_RivendellLancer
	ButtonBorderType	= BUILD													
	DescriptLabel		= CONTROLBAR:ToolTipBuildElvenRivendellLancersNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes
End

CommandButton Command_ConstructIsengardBerserker
	Command				= UNIT_BUILD
	Object				= IsengardBeserker
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructIsengardBerserker
	ButtonImage			= BIBerserker
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildIsengardBerserkerNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes     
End

CommandButton Command_ConstructIsengardWargRiderHorde
	Command				= UNIT_BUILD
	Object				= IsengardWargRiderHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructIsengardWargRider
	ButtonImage			= BIWargPit_Riders
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildIsengardWargRiderNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes      
End

CommandButton Command_ConstructMordorCorsairsOfUmbarHorde
	Command				= UNIT_BUILD
	Object				= MordorCorsairsOfUmbarHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructMordorCorsairsOfUmbarHorde
	ButtonImage			= BMHaradrimPalace_Haradrim
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildMordorCorsairsOfUmbarHorde
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructMordorHaradrimArcherHorde
	Command				= UNIT_BUILD
	Object				= MordorHaradrimArcherHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructMordorHaradrimArcherHorde
	ButtonImage			= BMHaradrimPalace_Haradrim
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildMordorHaradrimArcherHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructMordorDrummerTroll
	Command				= UNIT_BUILD
	Object				= MordorDrummerTroll
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructMordorDrummerTrolls
	ButtonImage			= BMTrollCages_DrummerTroll
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipConstructMordorDrummerTrollsNew
	Radial				= Yes
	InPalantir	   		= 	Yes
	ShowProductionCount	= Yes     
End

CommandButton Command_ConstructMordorAttackTroll
	Command				= UNIT_BUILD
	Object				= MordorAttackTroll
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructMordorAttackTroll
	ButtonImage			= BMTrollCages_AttackTroll
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildMordorAttackTrollNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructWildMarauderHorde
	Command				= UNIT_BUILD
	Object				= WildMarauderHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructWildMarauderHorde
	ButtonImage			= BWFissure_Marauder
	ButtonBorderType		= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildWildMarauderHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructGoblinTroll
	Command				= UNIT_BUILD
	Object				= GoblinCaveTroll
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructGoblinCaveTroll
	ButtonImage			= BWFissure_CaveTroll
	ButtonBorderType		= BUILD											
	DescriptLabel			= CONTROLBAR:ToolTipBuildGoblinCaveTroll
	;NeededUpgrade			= Upgrade_WildFissureLevel2
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructWildMountainGiant
	Command			= UNIT_BUILD
	Object			= WildMountainGiant
	Options			= CANCELABLE
	TextLabel		= CONTROLBAR:ConstructWildMountainGiant
	ButtonImage		= BWFissure_Giant
	ButtonBorderType	= BUILD											
	DescriptLabel		= CONTROLBAR:ToolTipBuildWildMountainGiantNew
	Radial			= Yes
	InPalantir	   	= Yes
	ShowProductionCount	= Yes
End

CommandButton Command_ConstructWildSpiderRiderHorde
	Command				= UNIT_BUILD
	Object				= GoblinSpiderRiderHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructWildSpiderRiderHorde
	ButtonImage			= BWSpiderPit_SpiderRider
	ButtonBorderType    = BUILD 
	DescriptLabel       = CONTROLBAR:ToolTipBuildWildSpiderRiderHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes      
End

CommandButton Command_ConstructInnIsengardWildmanHorde        ; so they can be upgraded and they can level up
	Command				= UNIT_BUILD
	Object				= IsengardWildmanHorde  ;Inn
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructIsengardWildmanHorde
	ButtonImage			= BCInn_WildmenofDunland
	ButtonBorderType	= BUILD 
	DescriptLabel		= CONTROLBAR:ToolTipBuildIsengardWildmanHorde
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount	= Yes     
End

CommandButton Command_ConstructAngmarDarkRangerHorde
	Command				= UNIT_BUILD
	Object				= AngmarDarkRangerHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructAngmarDarkRangerHorde
	ButtonImage			= BMAngmarBarracks_DarkRanger
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildAngmarDarkRangerHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructAngmarDarkDunedainHorde
	Command				= UNIT_BUILD
	Object				= AngmarDarkDunedainHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructAngmarDarkDunedainHorde
	ButtonImage			= BMAngmarBarracks_BlackNumenorian
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildAngmarDarkDunedainHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructAngmarSnowTrollHorde
	Command				= UNIT_BUILD
	Object				= AngmarSnowTrollHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructAngmarSnowTrollHorde
	ButtonImage			= BMAngmarDen_SnowTroll
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildAngmarSnowTrollHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructAngmarHillTrollHorde
	Command				= UNIT_BUILD
	Object				= AngmarHillTrollHorde
	Options				=  CANCELABLE
	TextLabel			= CONTROLBAR:ConstructAngmarHillTrollHorde
	ButtonImage			= BMAngmarDen_HillTroll
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildAngmarHillTrollHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

CommandButton Command_ConstructAngmarNecromancerHorde
	Command				= UNIT_BUILD
	Object				= AngmarNecromancerHorde
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:ConstructAngmarNecromancerHorde
	ButtonImage			= BMAngmarHallofTwilight_Necromancer
	ButtonBorderType		= BUILD 
	DescriptLabel			= CONTROLBAR:ToolTipBuildAngmarNecromancerHordeNew
	Radial				= Yes
	InPalantir	   		= Yes
	ShowProductionCount		= Yes
End

;===========================
;;FIXING BUG WITH HARADRIM ARCHERS + adding them fire arrows


ExperienceLevel	EvilEliteLevel1
	TargetNames							=	EVIL_ELITE
	RequiredExperience					=	EXPERIENCE_REQUIRED_EVIL_ELITE_1
	ExperienceAward						=	EXPERIENCE_AWARD_EVIL_ELITE_1
	ExperienceAwardOwnGuysDie			= 	0
	ShowLevelUpTint						=	Yes	
	Rank								=	1
	LevelUpTintColor					=	R:255 G:255	B:255
	LevelUpTintPreColorTime				=	500	
	LevelUpTintPostColorTime			=	3000
	LevelUpTintSustainColorTime			=	500	
	EmotionType							=	CHEER
	SelectionDecal
		Texture							=	decal_I_level1
		Texture2						=	decal_evil_CO
		Style							=	SHADOW_MERGE_DECAL
		OpacityMin						=	80%
		OpacityMax						=	100%
		MinRadius						=	HORDE_DECAL_MIN_RADIUS
		MaxRadius						=	200	
		MaxSelectedUnits				=	40
	End	
END

ExperienceLevel	EvilEliteLevel2
	TargetNames							=	EVIL_ELITE
	RequiredExperience					=	EXPERIENCE_REQUIRED_EVIL_ELITE_2
	ExperienceAward						=	EXPERIENCE_AWARD_EVIL_ELITE_2
	AttributeModifiers					=	EvilEliteBonusRank2
	ExperienceAwardOwnGuysDie			= 	0
	LevelUpFx							=	FX:GenericLevelUp2FX	
	ShowLevelUpTint						=	Yes	
	Rank								=	2
        Upgrades                                                  = Upgrade_ObjectLevel2
	LevelUpTintColor					=	R:255 G:255	B:255
	LevelUpTintPreColorTime				=	500	
	LevelUpTintPostColorTime			=	3000
	LevelUpTintSustainColorTime			=	500	
	EmotionType							=	CHEER
	SelectionDecal
		Texture							=	decal_I_level2
		Texture2						=	decal_evil_CO
		Style							=	SHADOW_MERGE_DECAL
		OpacityMin						=	80%
		OpacityMax						=	100%
		MinRadius						=	HORDE_DECAL_MIN_RADIUS
		MaxRadius						=	200	
		MaxSelectedUnits				=	40

	End	
END

ExperienceLevel	EvilEliteLevel3
	TargetNames							=	EVIL_ELITE
	RequiredExperience					=	EXPERIENCE_REQUIRED_EVIL_ELITE_3
	ExperienceAward						=	EXPERIENCE_AWARD_EVIL_ELITE_3
	AttributeModifiers					=	EvilEliteBonusRank3
	ExperienceAwardOwnGuysDie			= 	0
	LevelUpFx							=	FX:GenericLevelUp3FX	
	ShowLevelUpTint						=	Yes	
	Rank								=	3
	LevelUpTintColor					=	R:255 G:255	B:255
	LevelUpTintPreColorTime				=	500	
	LevelUpTintPostColorTime			=	3000
	LevelUpTintSustainColorTime			=	500	
	EmotionType							=	CHEER
	SelectionDecal
		Texture							=	decal_I_level3
		Texture2						=	decal_evil_CO
		Style							=	SHADOW_MERGE_DECAL
		OpacityMin						=	80%
		OpacityMax						=	100%
		MinRadius						=	HORDE_DECAL_MIN_RADIUS
		MaxRadius						=	200	
		MaxSelectedUnits				=	40
	End	
END

ExperienceLevel	EvilEliteLevel4
	TargetNames							=	EVIL_ELITE
	RequiredExperience					=	EXPERIENCE_REQUIRED_EVIL_ELITE_4
	ExperienceAward						=	EXPERIENCE_AWARD_EVIL_ELITE_4
	AttributeModifiers					=	EvilEliteBonusRank4
	ExperienceAwardOwnGuysDie			= 	0
	LevelUpFx							=	FX:GenericLevelUp4FX	
	ShowLevelUpTint						=	Yes	
	Rank								=	4
	LevelUpTintColor					=	R:255 G:255	B:255
	LevelUpTintPreColorTime				=	500	
	LevelUpTintPostColorTime			=	3000
	LevelUpTintSustainColorTime			=	500	
	EmotionType							=	CHEER
	SelectionDecal
		Texture							=	decal_I_level4
		Texture2						=	decal_evil_CO
		Style							=	SHADOW_MERGE_DECAL
		OpacityMin						=	80%
		OpacityMax						=	100%

		MinRadius						=	HORDE_DECAL_MIN_RADIUS
		MaxRadius						=	200	
		MaxSelectedUnits				=	40
	End	
END

ExperienceLevel	EvilEliteLevel5
	TargetNames							=	EVIL_ELITE
	RequiredExperience					=	EXPERIENCE_REQUIRED_EVIL_ELITE_5
	ExperienceAward						=	EXPERIENCE_AWARD_EVIL_ELITE_5
	AttributeModifiers					=	EvilEliteBonusRank5
	ExperienceAwardOwnGuysDie			= 	0
	LevelUpFx							=	FX:GenericLevelUp4FX	
	ShowLevelUpTint						=	Yes	
	Rank								=	5
	LevelUpTintColor					=	R:255 G:255	B:255
	LevelUpTintPreColorTime				=	500	
	LevelUpTintPostColorTime			=	3000
	LevelUpTintSustainColorTime			=	500	
	EmotionType							=	CHEER
	SelectionDecal
		Texture							=	decal_I_level4
		Texture2						=	decal_evil_CO
		Style							=	SHADOW_MERGE_DECAL
		OpacityMin						=	80%
		OpacityMax						=	100%
		MinRadius						=	HORDE_DECAL_MIN_RADIUS
		MaxRadius						=	200	
		MaxSelectedUnits				=	40
	End	
END

SpecialPower SpecialAbilityHaradrimArcherBarbedArrow
	Enum			= SPECIAL_AT_VISIBLE_OBJECT
	ReloadTime		= 20000 ; 6s was too overpowered
; 	UnitSpecificSoundToUseAsInitiateIntendToDoVoice = VoiceInitiateBarbedArrowAttack
End

CommandButton Command_HaradrimArcherBarbedArrowAbility
	Command				= SPECIAL_POWER
	SpecialPower		= SpecialAbilityHaradrimArcherBarbedArrow
	Options				= NEED_TARGET_ENEMY_OBJECT NEED_TARGET_NEUTRAL_OBJECT OK_FOR_MULTI_SELECT OK_FOR_MULTI_EXECUTE ; ;
	ButtonImage			= UCCommon_BarbedArrows
	CursorName			= EvilAbilityObj
	InvalidCursorName	= GenericInvalid
	TextLabel			= CONTROLBAR:BarbedArrows
	DescriptLabel		= CONTROLBAR:ToolTipBarbedArrowsNew
	InPalantir			= Yes	
	ButtonBorderType    = ACTION
	AutoAbility			= Yes
End

CommandSet MordorHaradrimArcherHordeBarbedArrowAndFireArrowCommandSet
	1	= Command_ToggleStance
	2	= Command_ArcherBombard
	3	= Command_HaradrimArcherBarbedArrowAbility
        4       = Command_PurchaseUpgradeMordorFireArrows
	5	= Command_PurchaseUpgradeMordorBasicTraining
	6	= Command_PurchaseUpgradeMordorHeavyArmor
	12	= Command_CaptureBuilding
	13	= Command_AttackMove
	14	= Command_Stop
End

Object MordorHaradrimArcherHorde
	CommandSet = MordorHaradrimArcherHordeBarbedArrowAndFireArrowCommandSet
End

;-----------------MORDOR SECTION

CommandButton Command_PurchaseTechnologyMordorFireArrows
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyMordorFireArrows
	NeededUpgradeAny	= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyMordorFireArrows
	ButtonImage			= BMOrcPit_FlamingArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyMordorFireArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3TavernFireArrows
End

CommandButton Command_PurchaseTechnologyMordorForgedBlades
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyMordorForgedBlades
	NeededUpgradeAny	= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyMordorForgedBlades
	ButtonImage			= BIArmory_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyMordorForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2OrcPitForgedBlades
End

CommandButton Command_PurchaseTechnologyMordorHeavyArmor
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyMordorHeavyArmor
	NeededUpgradeAny	= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyMordorHeavyArmor
	ButtonImage			= BIArmory_HeavyArmor
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyMordorHeavyArmor
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2OrcPitForgedBlades
End

CommandButton Command_PurchaseTechnologyMordorBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
        NeededUpgradeAny = Yes
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 10
	CommandRangeCount		= 5
End

CommandButton Command_SelectRevivablesMordorFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_EvilHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 15
	CommandRangeCount		= 11
End

;---------------------ISENGARD SECTION

CommandButton Command_PurchaseTechnologyIsengardFireArrows
	Command				= PLAYER_UPGRADE
	Upgrade				= Upgrade_TechnologyIsengardFireArrows 
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:PurchaseTechnologyIsengardFireArrows
	ButtonImage			= BIArmory_FlamingArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyIsengardFireArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackIsengardFireArrowsTech
End

CommandButton Command_PurchaseTechnologyIsengardForgedBlades
	Command				= PLAYER_UPGRADE
	Upgrade				= Upgrade_TechnologyIsengardForgedBlades 
	Options				= CANCELABLE
	TextLabel			= CONTROLBAR:PurchaseTechnologyIsengardForgedBlades
	ButtonImage			= BIArmory_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyIsengardForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackIsengardForgedBladesTech
End

CommandButton Command_PurchaseTechnologyIsengardHeavyArmor
	Command				= PLAYER_UPGRADE
	Upgrade				= Upgrade_TechnologyIsengardHeavyArmor 
	Options				= CANCELABLE 
	TextLabel			= CONTROLBAR:PurchaseTechnologyIsengardHeavyArmor
	ButtonImage			= BIArmory_HeavyArmor
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyIsengardHeavyArmor
	Radial				= Yes
	InPalantir	   		= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackIsengardHeavyArmorTech
End

CommandButton Command_PurchaseTechnologyIsengardBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 9
	CommandRangeCount		= 5
End

CommandButton Command_SelectRevivablesIsengardFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_EvilHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 14
	CommandRangeCount		= 11
End

;------------------WILD (GOBLIN) SECTION

CommandButton Command_PurchaseTechnologyWildHeavyArmor
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE 
	Upgrade				= Upgrade_TechnologyWildHeavyArmor
	TextLabel			= CONTROLBAR:PurchaseTechnologyWildHeavyArmor
	ButtonImage			= BWTreasureTrove_ScavengedArmor
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseechnologyWildHeavyArmor
	Radial				= Yes
	InPalantir			= Yes
End

CommandButton Command_PurchaseTechnologyWildFireArrows
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyWildFireArrows
	TextLabel			= CONTROLBAR:PurchaseTechnologyWildFireArrows
	ButtonImage			= BMOrcPit_FlamingArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyWildFireArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3TreasureTrove
	
End

CommandButton Command_PurchaseTechnologyWildForgedBlades
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyWildForgedBlades
	TextLabel			= CONTROLBAR:PurchaseTechnologyWildForgedBlades
	ButtonImage			= BWTreasureTrove_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyWildForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2TreasureTrove
	
End

CommandButton Command_PurchaseTechnologyWildBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 11
	CommandRangeCount		= 5
End

CommandButton Command_SelectRevivablesWildFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_EvilHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 16
	CommandRangeCount		= 11
End

;-----------------------MEN SECTION

CommandButton Command_PurchaseTechnologyGondorForgedBlades
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE 
	Upgrade				= Upgrade_TechnologyGondorForgedBlades
	TextLabel			= CONTROLBAR:PurchaseTechnologyGondorForgedBlades
	ButtonImage			= BRArmory_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyGondorForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	; ;LacksPrerequisiteLabel		= TOOLTIP:LackLevel2BlackSmithForgedBlades
End

CommandButton Command_PurchaseTechnologyGondorHeavyArmor
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyGondorHeavyArmor
	TextLabel			= CONTROLBAR:PurchaseTechnologyGondorHeavyArmor
	ButtonImage			= BGBlacksmith_HeavyArmor
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyGondorHeavyArmor
	Radial				= Yes
	InPalantir	   		= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2BlackSmithForgedBlades ; ;TOOLTIP:LackLevel3BlacksmithHeavyArmor
End

CommandButton Command_PurchaseTechnologyGondorFireArrows
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyGondorFireArrows
	TextLabel			= CONTROLBAR:PurchaseTechnologyGondorFireArrows
	ButtonImage			= BGArcheryRange_FireArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyGondorFireArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackGondorFireArrowsTechnology
End

CommandButton Command_PurchaseTechnologyGondorBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 9
	CommandRangeCount		= 5
End

CommandButton Command_SelectRevivablesMenFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_GoodHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 14
	CommandRangeCount		= 11
End

;-----------------------ANGMAR SECTION

CommandButton Command_PurchaseTechnologyAngmarIceArrows
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE 
	Upgrade				= Upgrade_TechnologyAngmarIceArrows
	TextLabel			= CONTROLBAR:PurchaseTechnologyAngmarIceArrows
	ButtonImage			= BGForgeWorks_IceArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyAngmarIceArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackAngmarIceArrowsTechnology
End

CommandButton Command_PurchaseTechnologyAngmarDarkIronBlades
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyAngmarDarkIronBlades
	TextLabel			= CONTROLBAR:PurchaseTechnologyAngmarDarkIronBlades
	ButtonImage			= BGForgeWorks_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyAngmarDarkIronBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2ForgeWorks
End

CommandButton Command_PurchaseTechnologyAngmarDarkIronArmor
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE 
	Upgrade				= Upgrade_TechnologyAngmarDarkIronArmor
	TextLabel			= CONTROLBAR:PurchaseTechnologyAngmarDarkIronMail
	ButtonImage			= KUDarkIronMailUpgradeIcon
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyAngmarDarkIronMail
	Radial				= Yes
	InPalantir	   		= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3ForgeWorks
End

CommandButton Command_PurchaseTechnologyAngmarBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 9
	CommandRangeCount		= 5
End

CommandButton Command_SelectRevivablesAngmarFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_EvilHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 14
	CommandRangeCount		= 11
End

;---------------------------------DWARF SECTION

CommandButton Command_PurchaseTechnologyDwarvenFireArrows ;building
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyDwarvenFireArrows
	TextLabel			= CONTROLBAR:PurchaseTechnologyRohanFireArrows
	ButtonImage			= BGArcheryRange_FireArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyRohanFireArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3ArcheryRange ; ;
End

CommandButton Command_PurchaseTechnologyDwarvenForgedBlades
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE
	Upgrade				= Upgrade_TechnologyDwarvenForgedBlades
	TextLabel			= CONTROLBAR:PurchaseTechnologyDwarvenForgedBlades
	ButtonImage			= BDForgeWorks_ForgedBlades
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyDwarvenForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3ForgeWorks ; ;TOOLTIP:LackLevel2ForgeWorks
End

CommandButton Command_PurchaseTechnologyDwarvenMithrilMail
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyDwarvenMithrilMail
	TextLabel			= CONTROLBAR:PurchaseTechnologyDwarvenMithrilMail
	ButtonImage			= BDForgeWorks_MithrilMail
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyDwarvenMithrilMail
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3ForgeWorks
End

CommandButton Command_PurchaseTechnologyDwarvenBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 9
	CommandRangeCount		= 5
End
CommandButton Command_SelectRevivablesDwarvenFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_GoodHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 14
	CommandRangeCount		= 11
End

;------------------------------- ELVES SECTION 

CommandButton Command_PurchaseTechnologyElvenSilverthornArrows
	Command				= PLAYER_UPGRADE
	Options				=  CANCELABLE
	Upgrade				= Upgrade_TechnologyElvenSilverthornArrows
	TextLabel			= CONTROLBAR:PurchaseTechnologyElvenSilverthornArrows
	ButtonImage			= BEEregionForge_SilverthornArrows
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyElvenSilverthornArrows
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackSilverthornTechnology
End

CommandButton Command_PurchaseTechnologyElvenForgedBlades
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyElvenForgedBlades
	TextLabel			= CONTROLBAR:PurchaseTechnologyElvenForgedBlades
	ButtonImage			= BEEregionForge_ForgedBlades
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseTechnologyGondorForgedBlades
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2EregionForge
End

CommandButton Command_PurchaseTechnologyElvenHeavyArmor
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE 
	Upgrade				= Upgrade_TechnologyElvenHeavyArmor
	TextLabel			= CONTROLBAR:PurchaseTechnologyElvenHeavyArmor
	ButtonImage			= BEEregionForge_ElvenArmor
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseTechnologyElvenHeavyArmor
	Radial				= Yes
	InPalantir	   		= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel2BlacksmithHeavyArmor
End

CommandButton Command_PurchaseTechnologyElvenBasicTraining
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
        Upgrade                 = NONE
	Options				= CANCELABLE
	InPalantir	   		= No
	TextLabel               = CONTROLBAR:SelectUpgradesGenericKeep
	ButtonImage             = UCCommon_UpgradeStructureNew
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectUpgradesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 9
	CommandRangeCount		= 5
End
CommandButton Command_SelectRevivablesElvenFortress
	Command                 = PUSH_VISIBLE_COMMAND_RANGE
	TextLabel               = CONTROLBAR:SelectRevivablesGenericKeep
	Options				= CANCELABLE
	ButtonImage             = UCCommon_GoodHeroes
	ButtonBorderType        = SYSTEM 
	DescriptLabel           = CONTROLBAR:ToolTipSelectRevivablesGenericKeep
	Radial                  = Yes
	CommandRangeStart		= 14
	CommandRangeCount		= 11
End

;=========================================================================
;THIS BLOCK OF CODE FOR FREE BANNER CARRIERS
;=========================================================================


CommandButton Command_PurchaseUpgradeGondorBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_GondorBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeGondorBasicTraining
	ButtonImage			= BGBlacksmith_SilverTreeBanner
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeGondorBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackGondorBasicTraining
End

CommandButton Command_PurchaseUpgradeDwarvenBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_DwarvenBasicTraining 
	NeededUpgrade			= Upgrade_TechnologyDwarvenBasicTraining
	TextLabel			= CONTROLBAR:PurchaseUpgradeDwarvenBasicTraining
	ButtonImage			= BDHallofWarriors_BannerCarrier
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseUpgradeDwarvenTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackDwarvenBasicTraining
End

CommandButton Command_PurchaseUpgradeElvenBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_ElvenBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeElderRacesBasicTraining
	ButtonImage			= BEEregionForge_BannerCarrier
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeElderRacesBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackElderRacesBasicTraining
End

CommandButton Command_PurchaseUpgradeIsengardBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_IsengardBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeIsengardBasicTraining
	ButtonImage			= BIArmory_WhiteHandBanner
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeIsengardBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackIsengardBasicTraining
End

CommandButton Command_PurchaseUpgradeMordorBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_MordorBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeMordorBasicTraining
	ConflictingLabel	= CONTROLBAR:BatallionAreadyHasUpgrade
	ButtonImage			= BMOrcPit_RedEyeBanner
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeMordorBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackMordorBasicTraining
End

CommandButton Command_PurchaseUpgradeWildBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_WildBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeWildBasicTraining
	ButtonImage			= BWTreasureTrove_BannerCarrier
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeWildBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackWildBasicTraining
End

CommandButton Command_PurchaseUpgradeAngmarBasicTraining
	Command				= OBJECT_UPGRADE
	Options				= OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_AngmarBasicTraining 
	TextLabel			= CONTROLBAR:PurchaseUpgradeAngmarBasicTraining
	ButtonImage			= BG_SilverTreeBanner
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeAngmarBasicTraining
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackAngmarBasicTraining
End

;========================================================================= Catapult expansion upgrades

CommandButton Command_PurchaseTechnologyGondorFireStones
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyGondorFireStones 
	NeededUpgradeAny		= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyGondorFireStones
	ButtonImage			= BGWorkshop_FireStone
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseTechnologyGondorFireStones
	Radial				= Yes
	InPalantir			= Yes
End

CommandButton Command_PurchaseTechnologyDwarvenFlamingShot
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyDwarvenFlamingShot
	NeededUpgradeAny		= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyDwarvenFlamingShot
	ButtonImage			= BGWorkshop_FireStone
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseTechnologyDwarvenFlamingShotNew
	Radial				= Yes
	InPalantir			= Yes
End

CommandButton Command_PurchaseTechnologyAngmarIceShot
	Command				= PLAYER_UPGRADE
	Options				= CANCELABLE
	Upgrade				= Upgrade_TechnologyAngmarIceShot
	NeededUpgradeAny		= Yes
	TextLabel			= CONTROLBAR:PurchaseTechnologyAngmarIceShot
	ButtonImage			= KUIceShotIcon
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseTechnologyAngmarIceShot
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackLevel3DarkIronForge
End

CommandButton Command_PurchaseUpgradeGondorFireStones
	Command				= OBJECT_UPGRADE
	Options				= NEED_UPGRADE OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_GondorFireStones
	NeededUpgrade		= Upgrade_TechnologyGondorFireStones
	TextLabel			= CONTROLBAR:PurchaseUpgradeGondorFireStones
	ButtonImage			= BGWorkshop_FireStone
	ButtonBorderType	= UPGRADE
	DescriptLabel		= CONTROLBAR:ToolTipPurchaseUpgradeGondorFireStones
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackGondorFireStones
End

CommandButton Command_PurchaseUpgradeDwarvenFlamingShot	
	Command				= OBJECT_UPGRADE
	Options				= NEED_UPGRADE OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_DwarvenFlamingShot
	NeededUpgrade			= Upgrade_TechnologyDwarvenFlamingShot
	TextLabel			= CONTROLBAR:PurchaseUpgradeDwarvenFlamingShot
	ButtonImage			= BGWorkshop_FireStone
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseUpgradeDwarvenFlamingShot
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackDwarvenFlamingShot
End

CommandButton Command_PurchaseUpgradeAngmarIceShot	
	Command				= OBJECT_UPGRADE
	Options				= NEED_UPGRADE OK_FOR_MULTI_SELECT CANCELABLE
	Upgrade				= Upgrade_AngmarIceShot
	NeededUpgrade			= Upgrade_TechnologyAngmarIceShot
	TextLabel			= CONTROLBAR:PurchaseUpgradeAngmarIceShot
	ButtonImage			= KUIceShotIcon
	ButtonBorderType		= UPGRADE
	DescriptLabel			= CONTROLBAR:ToolTipPurchaseUpgradeAngmarIceShot
	Radial				= Yes
	InPalantir			= Yes
	LacksPrerequisiteLabel		= TOOLTIP:LackAngmarIceShot
End

;==========================================================================

CommandSet CommandSetKeepDwarves
InitialVisible = 9


  1 = Command_ConstructDwarvenGuardianHorde
  2 = Command_ConstructDwarvenPhalanxHorde
  3 = Command_ConstructDwarvenAxeThrowerHorde
  4 = Command_ConstructDwarvenMenOfDaleHorde
  5 = Command_ConstructDwarvenBattleWagon
  6     = Command_PurchaseTechnologyDwarvenBasicTraining
  7     = Command_SelectRevivablesDwarvenFortress

	10	= Command_PurchaseTechnologyDwarvenMithrilMail
	11	= Command_PurchaseTechnologyDwarvenForgedBlades
        12      = Command_PurchaseTechnologyDwarvenFireArrows
  	13 	= Command_PurchaseTechnologyDwarvenFlamingShot
        14      = Command_RadialBack

	15	= Command_RingHeroReviveSlot	
	16	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	17   = Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	18	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	19	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        25      = Command_RadialBack

End


CommandSet CommandSetKeepMen

InitialVisible = 9


  1	= Command_ConstructGondorFighterHorde
  2	= Command_ConstructGondorArcherHorde
  3	= Command_ConstructGondorTowerShieldGuardHorde
  4     = Command_ConstructGondorRangerHorde
  5     = Command_ConstructGondorKnightHorde
  6     = Command_PurchaseTechnologyGondorBasicTraining
  7     = Command_SelectRevivablesMenFortress

	10	= Command_PurchaseTechnologyGondorHeavyArmor
	11	= Command_PurchaseTechnologyGondorForgedBlades
        12      = Command_PurchaseTechnologyGondorFireArrows
  	13 	= Command_PurchaseTechnologyGondorFireStones
        14      = Command_RadialBack

	15	= Command_RingHeroReviveSlot	
	16	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	17  	= Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	18	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	19	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        25      = Command_RadialBack

End


CommandSet CommandSetKeepElves

InitialVisible = 9

  1 = Command_ConstructElvenLorienWarriorHorde
  2 = Command_ConstructElvenLorienArcherHorde
  3 = Command_ConstructElvenMithlondSentryHorde
  4 = Command_ConstructElvenMirkwoodArcherHorde
  5 = Command_ConstructElvenRivendellLancers
  6     = Command_PurchaseTechnologyElvenBasicTraining
  7     = Command_SelectRevivablesElvenFortress


	10	= Command_PurchaseTechnologyElvenHeavyArmor
	11	= Command_PurchaseTechnologyElvenForgedBlades
        12      = Command_PurchaseTechnologyElvenSilverthornArrows
  	13 	= Command_PurchaseTechnologyGondorFireStones
        14      = Command_RadialBack

	15	= Command_RingHeroReviveSlot	
	16	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	17  	= Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	18	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	19	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        25      = Command_RadialBack

End



CommandSet CommandSetKeepIsengard
	InitialVisible = 9


  1	= Command_ConstructIsengardFighterHorde
  2	= Command_ConstructIsengardUrukCrossbowHorde
  3	= Command_ConstructIsengardPikemanHorde
  4    = Command_ConstructIsengardBerserker
  5   = Command_ConstructIsengardWargRiderHorde
  6  = Command_PurchaseTechnologyIsengardBasicTraining
  7  = Command_SelectRevivablesIsengardFortress

	10	= Command_PurchaseTechnologyIsengardHeavyArmor
	11	= Command_PurchaseTechnologyIsengardForgedBlades
        12      = Command_PurchaseTechnologyIsengardFireArrows
        14      = Command_RadialBack

	15	= Command_RingHeroReviveSlot	
	16	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	17 	= Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	18	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	19	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        25      = Command_RadialBack

End

CommandSet CommandSetKeepMordor
	InitialVisible = 10
  1	= Command_ConstructEasterlingHorde
  2	= Command_ConstructMordorHaradrimArcherHorde
  3       = Command_ConstructMordorCorsairsOfUmbarHorde
  4       = Command_ConstructMordorDrummerTroll
  5       = Command_ConstructMordorAttackTroll
  6       = Command_ConstructIsengardWargRiderHorde
  7       = Command_PurchaseTechnologyMordorBasicTraining
  8       = Command_SelectRevivablesMordorFortress



	11	= Command_PurchaseTechnologyMordorHeavyArmor
	12	= Command_PurchaseTechnologyMordorForgedBlades
        13      = Command_PurchaseTechnologyMordorFireArrows
        15      = Command_RadialBack

	16	= Command_RingHeroReviveSlot	
	17	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	18   = Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	19	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	25	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        26      = Command_RadialBack

End


CommandSet CommandSetKeepWild
	InitialVisible = 11
	1	= Command_ConstructInnIsengardWildmanHorde ; 
        2       = Command_ConstructGoblinFighterHorde
        3       = Command_ConstructGoblinArcherHorde
        4       = Command_ConstructGoblinTroll
        5       = Command_ConstructWildMarauderHorde
        6       = Command_ConstructWildSpiderRiderHorde
	7	= Command_ConstructWildMountainGiant
  8       = Command_PurchaseTechnologyWildBasicTraining
  9       = Command_SelectRevivablesWildFortress

	12	= Command_PurchaseTechnologyWildHeavyArmor
	13	= Command_PurchaseTechnologyWildForgedBlades
        14      = Command_PurchaseTechnologyWildFireArrows
        16      = Command_RadialBack

	17	= Command_RingHeroReviveSlot	
	18	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	19   = Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	20	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	25	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	26	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        27      = Command_RadialBack

End


CommandSet CommandSetKeepAngmar
	InitialVisible = 9
 

 1	= Command_ConstructAngmarDarkRangerHorde
  2	= Command_ConstructAngmarHillTrollHorde
  3	= Command_ConstructAngmarSnowTrollHorde
  4    = Command_ConstructAngmarDarkDunedainHorde
  5   = Command_ConstructAngmarNecromancerHorde
  6  = Command_PurchaseTechnologyAngmarBasicTraining
  7  = Command_SelectRevivablesAngmarFortress

	10	= Command_PurchaseTechnologyAngmarDarkIronArmor
	11	= Command_PurchaseTechnologyAngmarDarkIronBlades
        12      = Command_PurchaseTechnologyAngmarIceArrows
	13	= Command_PurchaseTechnologyAngmarIceShot
        14      = Command_RadialBack

	15	= Command_RingHeroReviveSlot	
	16	= Command_CreateAHeroReviveSlot		// Note we also need an extra slot for the Create A Hero
	17   = Command_GenericReviveSlot1		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset! 
	18	= Command_GenericReviveSlot2		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	19	= Command_GenericReviveSlot3		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	20	= Command_GenericReviveSlot4		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	21	= Command_GenericReviveSlot5		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	22	= Command_GenericReviveSlot6		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	23	= Command_GenericReviveSlot7		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
	24	= Command_GenericReviveSlot8		;Revives any hero. Use Slot1-Slot8 and keep them UNIQUE within the same commandset!
        25      = Command_RadialBack

End



;=======================================THE COMMAND CENTER OF THE FORTRESS (THE KEEP)=================================

ModifierList MenFortressIvoryTowerBonusNEW
	Category = STRUCTURE
	Modifier = PRODUCTION 400%
	Duration = 0
End

ModifierList MenFortressBannersLeadership
	Category			= LEADERSHIP
	Modifier			= ARMOR 50%
	Modifier			= DAMAGE_MULT 200%
	Modifier			= RATE_OF_FIRE 120%
	Modifier			= SPEED 200%
	Duration			= 3000
	FX				= FX_GenericLeadership
	ReplaceInCategoryIfLongest	= Yes
	IgnoreIfAnticategoryActive	= Yes
End

Object MBMMTower

DisplayName = OBJECT:CivilianBattleTower

ThreatLevel = 15.0

KindOf = STRUCTURE IMMOBILE BASE_FOUNDATION CASTLE_CENTER CAN_CAST_REFLECTIONS CASTLE_KEEP COMMANDCENTER PRELOAD SELECTABLE SCORE FS_FACTORY AUTO_RALLYPOINT MP_COUNT_FOR_VICTORY ATTACK_NEEDS_LINE_OF_SIGHT CAN_ATTACK NEED_BASE_FOUNDATION MADE_OF_STONE

	ArmorSet                              ; so its strong vs units but weak vs trolls, battering rams etc
		Conditions        = None
		Armor             = FortressArmor
		DamageFX          = GateDamageFX
	End

    WeaponSet
        Conditions     = NONE
        Weapon                = PRIMARY HaradrimPalaceBow                  ; fortress upgraded arrow
	AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
    End

VisionRange = 2000
VoiceSelect = WorldIsengardFortress

AddModule
	Behavior = GrantUpgradeCreate ModuleTag_abcdefghijkl
         UpgradeToGrant = Upgrade_MordorHaradrimPalaceLevel3
     End
End

ReplaceModule ModuleTag_05
	Body				= ActiveBody ModuleTag_05_DumbassNew
		MaxHealth		= 40000.0
		MaxHealthDamaged	= 20000.0
		MaxHealthReallyDamaged  = 10000.0
	End
End

AddModule
	Behavior = AttributeModifierUpgrade ModuleTag_IvoryTowerBonus_NEW
		AttributeModifier	= MenFortressIvoryTowerBonusNEW
		TriggeredBy		= Upgrade_MordorHaradrimPalaceLevel3
		RequiresAllTriggers 	= Yes
	End
End

AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_BannerLeadership_NEW
		StartsActive	= Yes
		BonusName	= MenFortressBannersLeadership
		RefreshDelay	= 2000
		Range		= 300
		ObjectFilter	= GENERIC_BUFF_RECIPIENT_OBJECT_FILTER
	End
End

AddModule
    Behavior          = GettingBuiltBehavior ModuleTag_GettingBuiltBehavior      ; so it automatically repairs if not under attack
        WorkerName    = DwarvenWorkerNoSelect
        SpawnTimer    = 2000
    End
End

CommandSet = KeepCommandSet

ReplaceModule ModuleTag_CommandSetDwarven
	Behavior = CommandSetUpgrade ModuleTag_CommandSetDwarven_NEW
		TriggeredBy	= Upgrade_DwarfFaction
		CommandSet	= CommandSetKeepDwarves
	End
End

ReplaceModule ModuleTag_CommandSetMen
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMen_NEW
		TriggeredBy	= Upgrade_MenFaction
		CommandSet	= CommandSetKeepMen
	End
End

ReplaceModule ModuleTag_CommandSetElven
	Behavior = CommandSetUpgrade ModuleTag_CommandSetElven_NEW
		TriggeredBy	= Upgrade_ElfFaction
		CommandSet	= CommandSetKeepElves
	End
End

ReplaceModule ModuleTag_CommandSetIsengard
	Behavior = CommandSetUpgrade ModuleTag_CommandSetIsengard_NEW
		TriggeredBy	= Upgrade_IsengardFaction
		CommandSet	= CommandSetKeepIsengard
	End
End

ReplaceModule ModuleTag_CommandSetMordor
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMordor_NEW
		TriggeredBy	= Upgrade_MordorFaction
		CommandSet	= CommandSetKeepMordor
	End
End

ReplaceModule ModuleTag_CommandSetWild
	Behavior = CommandSetUpgrade ModuleTag_CommandSetWild_NEW
		TriggeredBy	= Upgrade_WildFaction
		CommandSet	= CommandSetKeepWild
	End
End

ReplaceModule ModuleTag_CommandSetAngmar
	Behavior = CommandSetUpgrade ModuleTag_CommandSetAngmar_NEW
		TriggeredBy	= Upgrade_AngmarFaction
		CommandSet	= CommandSetKeepAngmar
	End
End

; Scavenger doesn't work, so we added this
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_PillageAura
		StartsActive	= Yes										; If no, requires upgrade to turn on.
		BonusName	= LurtzPassiveOutlawLeadership
		RefreshDelay	= 2000
		Range		= 999999
		AllowSelf	= Yes
		ObjectFilter	= ALL
	End
End

End

;===Catapult===

Weapon DwarvenIronHillsCatapultOilBarrel  ;// BALANCE Catapult Weapon
	AttackRange				= DWARVEN_CATAPULT_OILBARREL_RANGE
	MinimumAttackRange			= DWARVEN_CATAPULT_ROCK_MINRANGE
	
	RangeBonusMinHeight	= 10
	RangeBonus		= 1
	RangeBonusPerFoot	= #MULTIPLY( DWARVEN_CATAPULT_OILBARREL_RANGE .01 )
	
	
	WeaponSpeed					= 100
	MinWeaponSpeed				= 80
	MaxWeaponSpeed				= 150
	ScaleWeaponSpeed			= Yes
	HitPercentage				= 100
	PreAttackType				= PER_SHOT
	;FireFX						= FX_DwarvenCatapultWeapon	;sound played by triggersound
	DamageType					= FLAME
	AcceptableAimDelta			= 180.0
	DelayBetweenShots			= DWARVEN_CATAPULT_ROCK_DELAYBETWEENSHOTS	;// time between shots, msec
	FXTrigger					= CATAPULT_ROCK
	PreAttackDelay				= DWARVEN_CATAPULT_ROCK_PREATTACKDELAY
	FiringDuration				= DWARVEN_CATAPULT_ROCK_FIRINGDURATION		;// Catapult firing animation takes 3.0 secs.
	RequireFollowThru			= Yes
	ShareTimers					= Yes ;// share timer with catapult heads to you can't fire both in quick succession
	NoVictimNeeded				= Yes ;// Need no target
	LeechRangeWeapon			= Yes
  
	ScatterRadiusVsInfantry			= 40.0  
	DisableScatterForTargetsOnWall	= Yes

	ProjectileNugget                    ;// A Nugget that creates an Object and sends it to the target with a Warhead
		ProjectileTemplateName = DwarvenIronHillsCatapultOilBarrelProjectile
		WarheadTemplateName = BattleWagonOilBarrelWarhead
	End

	ProjectileNugget                    ;// A Nugget that creates an Object and sends it to the target with a Warhead
		ProjectileTemplateName = DwarvenIronHillsCatapultOilBarrelProjectile2
		WarheadTemplateName = BattleWagonOilBarrelWarhead
		WeaponLaunchBoneSlotOverride = SECONDARY
	End
	
	ProjectileNugget													; This nugget is to create a revealing object, so fire
		AlwaysAttackHereOffset	= X:0 Y:0 Z:0							; it directly on top of us, and just use an empty warhead
		UseAlwaysAttackOffset	= Yes									; so we don't assert.
		ProjectileTemplateName  = ShroudRevealer_Bombard
		WarheadTemplateName     = ShipRevealBombardWarhead_Dummy
	End
End

CommandSet DwarvenCatapultCustom
	1 = Command_ToggleTrebAutoAcquire
	2 = Command_SpecialAbilityDwarvenIronHillsCatapultOilBarrels
	3 = Command_Bombard
	4 = Command_PurchaseUpgradeDwarvenFlamingShot
	14 = Command_Stop
End

CommandSet DwarvenCatapultCustomStopBombardNEW
	1 = Command_ToggleTrebAutoAcquire
	2 = Command_SpecialAbilityDwarvenIronHillsCatapultOilBarrels
	3 = Command_StopBombard
	4 = Command_PurchaseUpgradeDwarvenFlamingShot
	14 = Command_Stop
End

Object DwarvenCatapultFortress

AddModule
	Behavior = SpecialPowerModule ModuleTag_OilBarrelsStarterNEW
		SpecialPowerTemplate		= SpecialAbilityDwarvenIronHillsCatapultOilBarrels
		UpdateModuleStartsAttack	= Yes
		InitiateSound				= DwarfCatapultVoiceAttackBarrel
	End
End

AddModule
	Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_OilBarrelUpdateNEW
		SpecialPowerTemplate		= SpecialAbilityDwarvenIronHillsCatapultOilBarrels
		WhichSpecialWeapon			= 1
		UnpackTime					= 1000
		PreparationTime				= 0
		PackTime					= 500
		StartAbilityRange			= DWARVEN_CATAPULT_OILBARREL_RANGE
		SpecialWeapon				= DwarvenIronHillsCatapultOilBarrel
		TriggerSound				= OilBarrelLaunch
	End
End

CommandSet = DwarvenCatapultCustom

ReplaceModule MonitorConditionUpdateModuleTag
	Behavior = MonitorConditionUpdate MonitorConditionUpdateModuleTagNEW
		ModelConditionFlags = ATTACKING_POSITION
		ModelConditionCommandSet = DwarvenCatapultCustomStopBombardNEW
	End
End

	WeaponSet
		Conditions          = None
		Weapon              = PRIMARY		DwarvenIronHillsCatapultRock
		AutoChooseSources	= PRIMARY		FROM_PLAYER FROM_SCRIPT FROM_AI
	End
	WeaponSet
		Conditions          = PLAYER_UPGRADE
		Weapon              = PRIMARY		DwarvenIronHillsCatapultFlamingShot
		AutoChooseSources	= PRIMARY		FROM_PLAYER FROM_SCRIPT FROM_AI
	End	

ReplaceModule ModuleTag_FlamingRock
	Behavior = WeaponSetUpgrade ModuleTag_FlamingRockNEW
		TriggeredBy	= Upgrade_DwarvenFlamingShot
	End
End
End

CommandButton Command_SpecialAbilitySummonedDragonReposition
  Command                 	= SPECIAL_POWER 
  SpecialPower            	= SpecialAbilitySummonedDragonReposition
  Options                 	= NEED_TARGET_POS CONTEXTMODE_COMMAND
  TextLabel               	= CONTROLBAR:MumakilReposition
  ButtonImage             	= HSSummonedDragonReposition
  ButtonBorderType        	= ACTION 
  CursorName			= EvilAbilityObj  
  InvalidCursorName       	= GenericInvalid
  DescriptLabel           	= CONTROLBAR:ToolTipMumakilReposition
  InPalantir			= Yes
End

CommandSet MordorMumawyrm
	1	= Command_ToggleStance	
	2	= Command_ChargeAttack
	3 	= Command_SpecialAbilitySummonedDragonReposition
	4	= Command_PurchaseUpgradeMordorFireArrows
	5	= Command_PurchaseUpgradeMordorBasicTraining
	13	= Command_AttackMove
	14	= Command_Stop
	16  	= Command_SetStanceBattle
	17  	= Command_SetStanceAggressive
	18  	= Command_SetStanceHoldGround
End

Weapon SummonDragonBlowBack
	RadiusDamageAffects   = ENEMIES

	DamageNugget
		Damage			= SUMMONED_DRAGON_CRUSH_DAMAGE
		Radius			= 75.0
		DelayTime		= 500
		DamageType		= CRUSH
		DeathType		= CRUSHED
	End

	MetaImpactNugget
		DelayTime	  = 500
		ShockWaveAmount   = 50.0
		ShockWaveRadius   = 55.0
		ShockWaveTaperOff = 0.75
		ShockWaveZMult    = 1.20
	End
End

Object MordorMumakil
CommandSet = MordorMumawyrm
AddModule
	Behavior = SpecialPowerModule ModuleTag_TeleportStarter                      
		SpecialPowerTemplate		= SpecialAbilitySummonedDragonReposition
		UpdateModuleStartsAttack	= Yes
	End
End
AddModule
	Behavior = TeleportSpecialAbilityUpdate ModuleTag_TeleportUpdate   
		SpecialPowerTemplate    = SpecialAbilitySummonedDragonReposition
		UnpackTime              = 500
		PreparationTime		= 1
		PackTime                = 500
		ApproachRequiresLOS	= No
		BusyForDuration		= 1000			; don't accept any AI for this long... ai commands will be queued (should be at least PackTime)
		DestinationWeaponName	= SummonDragonBlowBack	; Fires at point of teleport to push people away and down.
	End
End
End

Object Crebain
RemoveModule ModuleTag_LifetimeUpdate
End

Object IsengardCastleBaseKeep
ReplaceModule ModuleTag_02
  Body              = ActiveBody ModuleTag_02_NEW
    MaxHealth       = 10000.0
  End
End
RemoveModule ModuleTag_04
AddModule
	Behavior = SlowDeathBehavior ModuleTag_SlowDeath
		Sound 			= INITIAL SauronTerribleFury
		DeathTypes		= ALL 
		SinkDelay		= 5000
		SinkRate		= 40.0     ; in Dist/Sec - fast!
		DestructionDelay	= 1800
        Weapon				= INITIAL RingHeroDeathShockwave
	End
End
End

Locomotor CrebainLocomotor
	Surfaces            = AIR
	TurnTime            = 500
	TurnTimeDamaged     = 500
	TurnThreshold       = 5
	TurnThresholdHS     = 30
	SlowTurnRadius		= 0.0 ;  From a standing starts, 30 foot radius.
	FastTurnRadius		= 50.0 ; Once the catapult gets moving, still uses a 30 foot radius to turn.	
	Acceleration		= 2000  ; Instant accelerate to full speed.
	Braking			= 100	; Slower deceleration
	PreferredHeight         = 50
	PreferredAttackHeight   = 25 ; attack height
	MinTurnSpeed        = 0%
	ZAxisBehavior       = SURFACE_RELATIVE_HEIGHT
	Appearance          = HOVER
	StickToGround       = Yes
	AirborneTargetingHeight = -1	;	Crebain are always airborne
End

Object CampOnly02
ReplaceModule ModuleTag_01
  Draw = W3DScriptedModelDraw ModuleTag_01_NEW
    DefaultModelConditionState
      Model = GPTownLamp4
	ParticleSysBone = glowBone TorchGlow
	ParticleSysBone = glowBone FireTorch
        ParticleSysBone = glowBone TreebeardFireSmall
        ParticleSysBone = glowBone TorchSmokeBlack
    End
  End
End
AddModule
	Draw = W3DLightDraw ModuleTag_02_NEW
		Ambient = R:0 G:0 B:0
		Diffuse = R:255 G:192 B:64
		Radius = 150
		Intensity = 3
		AttachToBoneInAnotherModule = glowBone
	End
End
End

NewEvaEvent UpgradeCorpseRainReady
End

NewEvaEvent UpgradeWellofSoulsReady
End

NewEvaEvent UpgradeSoulFreezeReady
End

NewEvaEvent UpgradeSpikedCollarReady
End

ModifierList WallBonus
	Category = STRUCTURE
	Modifier = ARMOR 20%		// Additive.  Sum of these are subtracted from all entries in Armor.ini
	Modifier = DAMAGE_MULT 110%	// Multiplicitive.  Damage multiplied by this, will compound in multiple bonuses
    	Modifier = RANGE 200% 		// Additive.
   	Modifier = EXPERIENCE 10%	// Multiplicitive.
	Modifier = RATE_OF_FIRE 110%	// Multiplicitive.
	Duration = 3000 // a little longer than the aura update
End

CommandSet Townhouse
	1 = Command_ExitGarrison
	2 = Command_ExitGarrison
End

Object DaleBuilding01
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:30.0 Y:-15.0 Z:0.0
		EntryOffset		= X:70.0 Y:-15.0 Z:0.0
		ExitOffset		= X:70.0 Y:-15.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object DaleBuilding02
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:-15.0 Y:0.0 Z:0.0
		EntryOffset		= X:55.0 Y:0.0 Z:0.0
		ExitOffset		= X:55.0 Y:0.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object DaleBuilding03
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:-5.0 Y:0.0 Z:0.0
		EntryOffset		= X:70.0 Y:0.0 Z:0.0
		ExitOffset		= X:70.0 Y:0.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object DaleBuilding04
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:15.0 Y:12.0 Z:0.0
		EntryOffset		= X:50.0 Y:13.0 Z:0.0
		ExitOffset		= X:50.0 Y:20.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object DaleBuilding07
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:40.0 Y:-3.0 Z:0.0
		EntryOffset		= X:70.0 Y:-3.0 Z:0.0
		ExitOffset		= X:70.0 Y:-3.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object DaleBuilding08
SelectPortrait = BPRGoldenHall
VoiceSelect = RohanBattleTowerSelect
CommandSet = Townhouse
AddModule
	Behavior = HordeGarrisonContain ModuleTag_hordeGarrison
 		ObjectStatusOfContained	= UNSELECTABLE CAN_ATTACK ENCLOSED
 		ContainMax              = 2
 		DamagePercentToUnits    = 0%
 		PassengerFilter		= GENERIC_FACTION_GARRISONABLE
 		AllowEnemiesInside      = No
 		AllowNeutralInside      = Yes
 		NumberOfExitPaths       = 1
 		PassengerBonePrefix     = PassengerBone:ARROW_ KindOf:INFANTRY
 		EntryPosition		= X:30.0 Y:6.0 Z:0.0
		EntryOffset		= X:70.0 Y:6.0 Z:0.0
		ExitOffset		= X:70.0 Y:6.0 Z:0.0
		EnterSound		= FootstepDirtA
		KillPassengersOnDeath	= No
		ShowPips		= No
	End
End
AddModule
	Behavior = AIUpdateInterface ModuleTag_SoWeCanUseWeapon
	AutoAcquireEnemiesWhenIdle = Yes
	MoodAttackCheckRate = 250
	AILuaEventsList = GarrisonableFunctions
	End
End
AddModule
	Behavior = AttributeModifierAuraUpdate ModuleTag_ContainedGetBonus
		StartsActive		= Yes
		BonusName		= WallBonus
		AffectContainedOnly 	= Yes
		RunWhileDead		= Yes
		RefreshDelay		= 2000	; 2 secs
	End
End
End

Object SpellBookAvalanche				; Adapted to play the panic loop for a limited time
SoundAmbient = CivGroupPanicLoop
ReplaceModule ModuleTag_03
	Behavior = DeletionUpdate ModuleTag_03_NEW
		MinLifetime = 20000   
		MaxLifetime = 20000   
	End
End
RemoveModule ModuleTag_FloodCentral
End

FXParticleSystem GaladAura
  System
    Priority = VERY_LOW_OR_ABOVE
    ParticleName = EXBlast.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 10 10
    BurstDelay = 2 2
    BurstCount = 1 1
    IsGroundAligned = Yes
  End
  Color = DefaultColor
    Color2 = R:108 G:108 B:108 5
    Color3 = R:0 G:0 B:0 100
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.25 0.3 5
    Alpha3 = 0.0 0 100
  End
  Update = DefaultUpdate
    SizeRate = 1 4
    SizeRateDamping = 0.88 0.99
    AngleZ = 0 7
    AngularRateZ = 0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.5 0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
    X = -1 1
    Y = -1 1
  End
  EmissionVolume = BoxEmissionVolume
  End
  Draw = DefaultDraw
  End
End

FXParticleSystem GaladAura02
  System
    Priority = MEDIUM_OR_ABOVE
    Shader = ALPHA
    ParticleName = EXCloud06HiRes.tga
    Lifetime = 100 100
    SortLevel = 1
    Size = 5 5
    BurstDelay = 1 1
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:115 G:115 B:115 0
    Color2 = R:100 G:100 B:100 5
    Color3 = R:77 G:77 B:77 150
  End
  Alpha = DefaultAlpha
    Alpha2 = 0.5 0.75 5
    Alpha3 = 0.0 0 150
  End
  Update = DefaultUpdate
    SizeRate = 2 2
    SizeRateDamping = 0.9 0.95
    AngleZ = 0 7
    AngularRateZ = -0.05 0.05
    AngularDamping = 1 1
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 0.5 0.5
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    EndPoint = X:0 Y:0 Z:-3
  End
  Draw = DefaultDraw
  End
End

Weapon BalrogSummoning	;used in the OCL that makes a Balrog.
  ;FireFX                = FX_GondorSwordHit
  RadiusDamageAffects	= ALLIES ENEMIES NOT_SIMILAR
  AttackRange           = 4.0

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = BALROG_SUMMONING_DAMAGE
    Radius        = 200.0
    DamageType    = MAGIC
    DamageFXType  = FLAME
    DeathType     = BURNED
    DamageScalar  = 0% NONE +MordorBalrog
    DamageScalar  = 0% NONE +SummonedDragon
    DamageScalar  = 0% NONE +SummonedDragonJH1
  End

  MetaImpactNugget                    ; A Nugget that throws things back with force
	KillObjectFilter  = INSTANT_DEATH_ON_METAIMPACT_OBJFILTER
    ShockWaveAmount   = 100
    ShockWaveRadius   = 200.0
    ShockWaveTaperOff = 0.9
    ShockWaveZMult    = 1.20
  End
End

ObjectCreationList OCL_HatchSummonedDragon
	CreateObject
		ObjectNames = Wyrm
		Count = 1
		Disposition = ABSOLUTE_ANGLE
		DispositionAngle = 270	
		UseJustBuiltFlag = Yes
		StartingBusyTime = 2300
		FadeIn = Yes
		FadeTime = 10000
		IgnoreCommandPointLimit = Yes
	End
End

ChildObject SummonedDragonEgg MordorBalrogEgg 	; For Wave 7 Balrogs (unlimited lifetime)
ReplaceModule ModuleTag_HatchProcess
	Behavior = SlowDeathBehavior ModuleTag_HatchProcess_NEW
		DestructionDelay	= 8000
		FX					= INITIAL FX_BalrogSummoningStart
		FX					= MIDPOINT FX_BalrogSummoningFinish			; Midpoint as we need to have a delay between the summon and explosion.
		OCL					= MIDPOINT OCL_HatchSummonedDragon
		Weapon				= MIDPOINT BalrogSummoning
	End
End
End

ChildObject Wyrm MordorBalrog 	; For Wave 7 Balrogs (unlimited lifetime)
ReplaceModule ModuleTag_02
  Body            = ActiveBody ModuleTag_02_NEW
    MaxHealth         = 15000
  End
End
RemoveModule ModuleTag_LifetimeUpdate
End

Weapon HobbitSword
	RadiusDamageAffects		= ENEMIES NEUTRALS ALLIES
	LeechRangeWeapon		= Yes
	CanFireWhileMoving		= No
	AttackRange			= 15
	MeleeWeapon			= Yes
	AcceptableAimDelta		= 60				; Just needs to sort of face in the general direction.
	FireFX				= FX_SauronMaceHit
	DelayBetweenShots		= 600				; time between shots, msec
	PreAttackDelay			= 2000				; 300 is mace swing delay time before contact with target.
	PreAttackType			= PER_SHOT			; Do the delay each time we attack
	FiringDuration			= 3800				; Duration of the mace swing
	DamageDealtAtSelfPosition = Yes				; A melee based AoE.  Arc radiates from me, not them

	; Crush damage.
	DamageNugget								; A basic Nugget that just does damage
		Damage			= 5000
		Radius			= 125.0
		DamageArc		= 72
		DelayTime		= 0
		DamageType		= SIEGE
		DamageFXType		= MAGIC
		DeathType		= NORMAL
	End

	; Magic damage.
	DamageNugget								; A basic Nugget that just does damage
		Damage			= 5000
		Radius			= 125.0
		DamageArc		= 72
		DelayTime		= 0
		DamageType		= MAGIC
		DamageFXType		= MAGIC
		DeathType		= NORMAL
	End

	; Push back
	MetaImpactNugget							; A Nugget that throws things back with force
		ShockWaveAmount		= 150
		ShockWaveRadius		= 130
		ShockWaveArc		= 72				; Should generally be equal to damage arc
		ShockWaveTaperOff	= 1.0
		ShockWaveSpeed		= 0.0
		ShockWaveZMult		= 1.6
	End
End

FXParticleSystem SaronRingSpark
  System
    Priority = ALWAYS_RENDER
    ParticleName = EXSparkle.tga
    Lifetime = 4 4
    SortLevel = 1
    Size = 15 15
    BurstCount = 1 1
  End
  Color = DefaultColor
    Color1 = R:226 G:23 B:23 0
    Color2 = R:226 G:203 B:93 2
    Color3 = R:0 G:0 B:0 4
  End
  Update = DefaultUpdate
    SizeRateDamping = 1 1
    AngleZ = 0 1
    AngularDamping = 0.8 0.9
    AngularDampingXY = 1 1
  End
  Physics = DefaultPhysics
    VelocityDamping = 1 1
  End
  EmissionVelocity = OrthoEmissionVelocity
  End
  EmissionVolume = LineEmissionVolume
    StartPoint = X:-2 Y:0 Z:0
    EndPoint = X:-2 Y:0 Z:0
  End
  Draw = DefaultDraw
  End
End

ChildObject MordorSauron_RingHero MordorSauron
ReplaceModule ModuleTag_01
	Draw = W3DScriptedModelDraw ModuleTag_01_NEW
		OkToChangeModelColor = Yes
		StaticModelLODMode = yes		; Will append M or L to the skin name depending on GameLOD
		DefaultModelConditionState
			Model = MUSauron_SKN
			ParticleSysBone = WEAPON SaronRingSpark FollowBone:Yes
		End

;;================== ANIMATIONS =================================================================

;;------------------ MOVING & DYING ---------------------------

;;======= DYING

	AnimationState						= DYING
		Animation						= DIEB
			AnimationName				= MUSauron_SKL.MUSauron_DIEB
			AnimationMode				= ONCE
		End
		
			
			ParticleSysBone = NONE UltraInitial01
			ParticleSysBone = NONE UltraInitial02
			ParticleSysBone = NONE UltraInitial03
		
		BeginScript
			CurDrawableShowSubObject("SHARD01")
			CurDrawableShowSubObject("SHARD02")
			CurDrawableShowSubObject("SHARD03")
			CurDrawableShowSubObject("SHARD04")
			CurDrawableShowSubObject("SHARD05")
			CurDrawableShowSubObject("SHARD06")
			CurDrawableShowSubObject("SHARD07")
			CurDrawableShowSubObject("SHARD08")
			CurDrawableShowSubObject("SHARD09")
			CurDrawableShowSubObject("SHARD10")
			CurDrawableShowSubObject("SHARD11")
			CurDrawableShowSubObject("SHARD12")
			CurDrawableShowSubObject("SHARD13")
			CurDrawableShowSubObject("SHARD14")
			CurDrawableShowSubObject("SHARD15")
			CurDrawableShowSubObject("SHARD16")
			CurDrawableShowSubObject("SHARD17")
			CurDrawableShowSubObject("SHARD18")
			CurDrawableShowSubObject("SHARD19")
			CurDrawableShowSubObject("SHARD20")
		EndScript
	End
		
	AnimationState						= PARALYZED
		Animation
			AnimationName				= MUSauron_SKL.MUSauron_IDLA
			AnimationMode				= LOOP
		End
	End

;;======= MOVING

    AnimationState						= MOVING FIRING_OR_PREATTACK_A
		StateName						= STATE_Moving
		Animation						= Moving
		    AnimationName				= MUSauron_SKL.MUSauron_WLKB
			AnimationMode				= LOOP
			Distance					= 190
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES
    End

	AnimationState						= MOVING TURN_RIGHT_HIGH_SPEED
		StateName						= STATE_Moving
		Animation						= Moving
		    AnimationName				= MUSauron_SKL.MUSauron_WLKA
			AnimationMode				= LOOP
			Distance					= 190
		End
		Animation						= Turning
			AnimationName				= MUSauron_SKL.MUSauron_TRNR
		    AnimationMode				= LOOP
			AnimationBlendTime			= 0
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES MAINTAIN_FRAME_ACROSS_STATES2
		BeginScript
			if CurDrawablePrevAnimationState() == "STATE_Turning" then return "Turning" else return "Moving" end
		EndScript
    End
    
    AnimationState						= MOVING TURN_LEFT_HIGH_SPEED
		StateName						= STATE_Moving
		Animation						= Moving
		    AnimationName				= MUSauron_SKL.MUSauron_WLKA
			AnimationMode				= LOOP
			Distance					= 190
		End
		Animation						= Turning
			AnimationName				= MUSauron_SKL.MUSauron_TRNL
			AnimationMode				= LOOP
			AnimationBlendTime			= 0
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES MAINTAIN_FRAME_ACROSS_STATES2
		BeginScript
			if CurDrawablePrevAnimationState() == "STATE_Turning" then return "Turning" else return "Moving" end
		EndScript
    End

	AnimationState						= TURN_LEFT
		StateName						= STATE_Turning
		Animation						= Turning
			AnimationName				= MUSauron_SKL.MUSauron_TRNL
			AnimationMode				= LOOP
			AnimationBlendTime			= 5
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES2
    End
    
    AnimationState						= TURN_RIGHT
		StateName						= STATE_Turning
		Animation						= Turning
			AnimationName				= MUSauron_SKL.MUSauron_TRNR
		    AnimationMode				= LOOP
		    AnimationBlendTime			= 5
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES2
   End

    AnimationState						= MOVING
		StateName						= STATE_Moving
		Animation						= Moving
		    AnimationName				= MUSauron_SKL.MUSauron_WLKA
			AnimationMode				= LOOP
			Distance					= 190
		End
		Flags							= MAINTAIN_FRAME_ACROSS_STATES
    End
 
 ;;------------------ ABILITIES  -------------------------------
 	
	AnimationState						= SPECIAL_WEAPON_ONE					; Fires of doom
		Animation
			AnimationName				= MUSauron_SKL.MUSauron_ATKD
			AnimationMode				= ONCE
		End
	End

 ;;------------------ ATTACKING  -------------------------------

	AnimationState						= FIRING_OR_PREATTACK_A
		StateName						= STATE_Ready
		Animation						= ATKC
			AnimationName				= MUSauron_SKL.MUSauron_ATKC
			AnimationMode				= ONCE
			UseWeaponTiming				= Yes
		End
	End

;;-------------------- HIT REACTIONS --------------------------

	AnimationState						= HIT_REACTION
		StateName						= STATE_Ready
		Animation
			AnimationName				= MUSauron_SKL.MUSauron_HITA
			AnimationMode				= ONCE
		End
	End
		
		AnimationState        = RAISING_FLAG
			Animation
				AnimationName     = MUSauron_SKL.MUSauron_ATKC
				AnimationMode     = ONCE
			End
			Animation
				AnimationName     = MUSauron_SKL.MUSauron_ATKD
				AnimationMode     = ONCE
			End
			Animation
				AnimationName     = MUSauron_SKL.MUSauron_ATKE
				AnimationMode     = ONCE
			End
			Flags					= RESTART_ANIM_WHEN_COMPLETE
		End

;;--------------- IDLE STATES ---------------------------------

	AnimationState						= SELECTED
		StateName						= Idle
		Animation						= IDLA
			AnimationName				= MUSauron_SKL.MUSauron_IDLA
			AnimationMode				= LOOP
		End
	End

	IdleAnimationState
		AllowRepeatInRandomPick			= Yes
		StateName						= Idle
		Animation						= IDLA
			AnimationName				= MUSauron_SKL.MUSauron_IDLA
			AnimationMode				= ONCE
			AnimationPriority			= 20
		End
		Animation						= IDLC
			AnimationName				= MUSauron_SKL.MUSauron_IDLC
			AnimationMode				= ONCE
			AnimationPriority			= 10
			AnimationBlendTime			= 5
			AnimationSpeedFactorRange	= 0.7 1.5
		End
		BeginScript
			Prevs = CurDrawablePrevAnimationState()
			Preva = CurDrawablePrevAnimation()
			if Prevs == "STATE_Moving"
			then
				CurDrawableSetTransitionAnimState("TRANS_SmoothToIdle")
			elseif Prevs == "STATE_Ready"
			then
				CurDrawableSetTransitionAnimState("TRANS_ReallySmoothToIdle")
			end
			if Preva == "IDLC"
			then
				CurDrawableSetTransitionAnimState("TRANS_ReallySmoothToIdle")
			end
		EndScript
	End
;;--------------------- TRANSITIONS ----------------------------------------------------

	TransitionState					= TRANS_SmoothToIdle
		Animation					= IDLA
			AnimationName			= MUSauron_SKL.MUSauron_IDLA
			AnimationMode			= ONCE
			AnimationBlendTime		= 5
		End
	End
	TransitionState					= TRANS_ReallySmoothToIdle
		Animation					= IDLA
			AnimationName			= MUSauron_SKL.MUSauron_IDLA
			AnimationMode			= ONCE
			AnimationBlendTime		= 10
		End
	End
End
End
	WeaponSet
		Conditions			= None 
		Weapon				= PRIMARY HobbitSword
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End
ReplaceModule ModuleTag_Body
	Body = ActiveBody ModuleTag_Body_BOSS
		MaxHealth = 120000
	End
End
AddModule
	Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
		LevelToGrant	= 10
		MPOnly		= No
	End
End
AddModule
	Behavior = SlowDeathBehavior ModuleTag_05_SHOCKWAVE
		DeathTypes			= ALL 
		SinkDelay			= 500
		SinkRate			= 1.00
		DestructionDelay		= 4000
        Sound					= INITIAL BalrogVanquished
        Weapon					= FINAL HobbitPunch
	End
End
Scale = 1.7
	LocomotorSet
		Locomotor = BasicSauronLocomotor
		Condition = SET_NORMAL 
		Speed     = 32
	End
	Geometry			= CYLINDER
	GeometryMajorRadius = 21
	GeometryHeight		= 60
	GeometryIsSmall		= Yes
	Shadow				= SHADOW_DECAL
	ShadowSizeX			= 40
	ShadowSizeY			= 40
	ShadowTexture		= ShadowI
End

;------------------------------------------------------------------------------
; This is the normal punch, not the AOE, rock, siege or tree
Weapon Sting  ; BALANCE CaveTroll Weapon Normal
  LeechRangeWeapon		= Yes
  RadiusDamageAffects = ENEMIES 
  AttackRange           = 6
  MeleeWeapon           = Yes
  DelayBetweenShots     = MORDOR_TROLL_PUNCH_DELAYBETWEENSHOTS
  FiringDuration        = MORDOR_TROLL_PUNCH_FIRINGDURATION
  PreAttackDelay        = MORDOR_TROLL_PUNCH_PREATTACKDELAY
  PreAttackType         = PER_SHOT ; Do the delay each time we attack a new target
  PreAttackFX          	= FX_TrollTreeSwing
  FireFX               	= FX_TrollPunchGeneric
  DamageDealtAtSelfPosition = Yes ; A melee based AoE.  Arc radiates from me, not them
  AcceptableAimDelta	= 0.0 ;;

  DamageNugget                        ; A basic Nugget that just does damage
    Damage        = 100
    Radius        = 75.0
    DamageArc      = 45
    DamageType    = SIEGE
    DamageFXType  = CLUBBING
    DeathType     = NORMAL
    DamageScalar   = 400% NONE +HERO
  End
  MetaImpactNugget                    ; A Nugget that throws things back with force
    ShockWaveAmount   = 10.0
    ShockWaveRadius   = 75.0
    ShockWaveTaperOff = 1.0
    ShockWaveArc      = 45
    ShockWaveZMult    = 1.20
    HeroResist		  = 0.90		; 90% resistance to heroes
  End
End

;------------------------------------------------------------------------------
; This is the building attack bash, not the AOE, rock, siege or tree
Weapon MordorWorkerAxe  ; BALANCE CaveTroll Weapon Normal
	LeechRangeWeapon	  = Yes
	AttackRange           = 18
	RadiusDamageAffects	  = ENEMIES 
	MeleeWeapon           = Yes
	FireFX                = FX_TrollBash
	DelayBetweenShots     = MORDOR_TROLL_SHOULDER_DELAYBETWEENSHOTS            ; time between shots, msec
	FiringDuration        = MORDOR_TROLL_SHOULDER_FIRINGDURATION
	PreAttackDelay        = MORDOR_TROLL_SHOULDER_PREATTACKDELAY
	PreAttackType         = PER_SHOT
	PreAttackFX           = FX_TrollTreeSwing
	AcceptableAimDelta	  = 45.0 

	DamageNugget                        ; A basic Nugget that just does damage
		Damage        = 800
		Radius        = 8.0
		DelayTime     = 0
		DamageType    = SIEGE
		DamageFXType  = CLUBBING
		DeathType     = NORMAL
	End

	DamageNugget								; A basic Nugget that just does damage
		Damage			= 200
		DamageScalar		= 300% NONE +HERO
		Radius			= 40.0					; matches impact nugget so it throws them back and hurts them
		DamageArc		= 90
		DamageType		= SIEGE
		DamageFXType		= CLUBBING
		DeathType		= NORMAL
	End

	MetaImpactNugget							; A Nugget that throws things back with force
		ShockWaveAmount   = 20.0
		ShockWaveRadius   = 40.0
		ShockWaveTaperOff = 0.75
		ShockWaveArc      = 90
		ShockWaveZMult    = 1.20
		HeroResist	  = 0.90					; 90% resistance to heroes
	End
End

ChildObject WildBatCloud MordorMountainTroll
	WeaponSet
		Conditions          	=  None
		Weapon             	=  PRIMARY		Sting
		Weapon              	=  SECONDARY		MordorWorkerAxe
		OnlyAgainst         	=  SECONDARY		STRUCTURE BLOCKING_GATE
		Weapon			=  TERTIARY		Sting
		OnlyInCondition		=  TERTIARY		MOVING
	End
	LocomotorSet
		Locomotor = TrollLocomotor
		Condition = SET_NORMAL
		Speed     = 87
	End
AddModule
	Body = DelayedDeathBody ModuleTag_02_New
		MaxHealth			= 50000
		MaxHealthDamaged		= 30000
		MaxHealthReallyDamaged		= 10000
		DoHealthCheck			= No			;// Don't want to get the delayed death behaviour when we die normally.
		DelayedDeathTime		= 5000
		CanRespawn			= No			;// Unit can't get revived.
	End
End
	Scale 			= 1.75
	BountyValue		= 360
	Geometry		= CYLINDER
	GeometryMajorRadius	= 40.0
	GeometryHeight		= 75.0
	GeometryIsSmall		= No
	Shadow			= SHADOW_VOLUME_NON_SELF_2	;// volumetric shadow that doesn't cast onto all objects using SHADOW_VOLUME_NON_SELF_2
End

Object MordorSauron
RemoveModule ModuleTag_AutoHeal
AddModule
	Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
		LevelToGrant	= 10
		MPOnly		= No
	End
End
End

Object ElvenGaladriel
AddModule
	Behavior = ExperienceLevelCreate ModuleTag_LevelBonus
		LevelToGrant	= 10
		MPOnly		= No
	End
End
AddModule
	Behavior = ModelConditionUpgrade ModulTag_RingHeroMC
		TriggeredBy			= Upgrade_ObjectLevel1
		AddConditionFlags		= USER_1
	End
End
AddModule
	Behavior = SpecialPowerModule ModuleTag_GaladrielTerribleFury
		SpecialPowerTemplate		= SpecialAbilityScreech
		UpdateModuleStartsAttack	= Yes
		SetModelCondition 		= ModelConditionState:USER_2
		SetModelConditionTime 		= 3.2
		DisableDuringAnimDuration 	= Yes
	End
End
AddModule
	Behavior = SpecialAbilityUpdate ModuleTag_GaladrielTerribleFuryUpdate  
		SpecialPowerTemplate		= SpecialAbilityScreech
		UnpackTime			= 1
		AwardXPForTriggering		= 0		
		TriggerSound			= GaladrielVoiceTerribleFury
		EffectRange			= 200
		UnpackTime			= 100
		PreparationTime			= 1
		PackTime			= 3000
	End
End
End

Object MordorGrond
ShockwaveResistance = 9999
ReplaceModule ModuleTag_04
	Body                  = ActiveBody ModuleTag_04_NEW
		CheerRadius 	  = EMOTION_CHEER_RADIUS
		MaxHealth         = 50000
		MaxHealthDamaged  = 10000
	End
End
End

Object MBMMWallC
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE UNATTACKABLE CHUNK_VENDOR WALK_ON_TOP_OF_WALL IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP NOT_AUTOACQUIRABLE DONT_HIDE_IF_FOGGED
RemoveModule MakeTheFreeTreb
AddModule
 	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes
		BonusName	= WallBonus
		RefreshDelay	= 2000
	End
End
End

Object MBMMWallCEnd
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE UNATTACKABLE CHUNK_VENDOR WALK_ON_TOP_OF_WALL IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP NOT_AUTOACQUIRABLE DONT_HIDE_IF_FOGGED
AddModule
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes
		BonusName	= WallBonus
		RefreshDelay	= 2000
	End
End
End

Object MBMMWallCEnd1
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE UNATTACKABLE CHUNK_VENDOR WALK_ON_TOP_OF_WALL IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP NOT_AUTOACQUIRABLE DONT_HIDE_IF_FOGGED
AddModule
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes
		BonusName	= WallBonus
		RefreshDelay	= 2000
	End
End
End

Object MordorCirithUngolWallD
	KindOf = PRELOAD STRUCTURE SELECTABLE IMMOBILE UNATTACKABLE CHUNK_VENDOR WALK_ON_TOP_OF_WALL IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP NOT_AUTOACQUIRABLE DONT_HIDE_IF_FOGGED
AddModule
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes
		BonusName	= WallBonus
		RefreshDelay	= 2000
	End
End
End

ChildObject AngmarTrollSlingMinasMorgul AngmarTrollSling
ReplaceModule ModuleTag_DRAW
Draw = W3DTruckDraw ModuleTag_DRAW_NEW

		WadingParticleSys = EntRipples
			
		OkToChangeModelColor = Yes
		
		StaticModelLODMode = Yes
			  
	DefaultModelConditionState
		Model               		= KUTSling_SKN
		WeaponLaunchBone    		= PRIMARY Projectile
		WeaponLaunchBone	  	= SECONDARY Projectile
	End
	IdleAnimationState
		StateName		= Stand
		Animation		
			AnimationName       	= KUTSling_SKL.KUTSling_IDLA
			AnimationMode       	= ONCE
			AnimationPriority   	=	100
		End
		Animation
			AnimationName       	= KUTSling_SKL.KUTSling_IDLB
			AnimationMode       	= ONCE
			AnimationPriority   	=	1
		End
		Animation
			AnimationName       	= KUTSling_SKL.KUTSling_IDLC
			AnimationMode       	= ONCE
			AnimationPriority   	=	100
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("AttnToIdle")  ;NOTE new transition goes here
			end
			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight"
			then 
				CurDrawableSetTransitionAnimState("MoveToIdle") 
			end
		EndScript
	End
    
	ModelConditionState 			= DYING
		Model               		= KUTS_DIE_SKN
		WeaponLaunchBone    		= PRIMARY Projectile
	End
    
	AnimationState      			= DYING
		Animation         		
			AnimationName   	= KUTS_DIE_SKL.KUTSling_DIEA
			AnimationMode   	= ONCE
		End
	End		
    
	AnimationState				= PARALYZED
		Animation			= Para_Front
			AnimationName		= KUTSling_SKL.KUTSling_ATNB
			AnimationMode		= LOOP
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight"
			then 
				CurDrawableSetTransitionAnimState("MoveToIdle") 
			end
			if Prev == "Stand" 
			then 
				CurDrawableSetTransitionAnimState("IdleToAttn")
			end
		EndScript
	End
		
	AnimationState  = COMING_OUT_OF_FACTORY
		StateName			= Being_Built
		Animation			= Being_Built
			AnimationName		= KUTSling_SKL.KUTSling_MOVA
			AnimationMode		= Loop
		End
	End   


   	AnimationState		= FIRING_OR_PREATTACK_A 
		StateName			= Attack
		Animation			= ATK
			AnimationName           = KUTSling_SKL.KUTSling_ATKA
			AnimationMode       	= ONCE
			UseWeaponTiming		= Yes
			AnimationBlendTime	= 20
			AnimationSpeedFactorRange = 2.3 2.3
		End
		FrameForPristineBonePositions = 42
;		ParticleSysBone     = Projectile FlamingRockStart FollowBone:Yes 
;		ParticleSysBone     = Projectile FlamingRockLenzflareStart FollowBone:Yes 
;		BeginScript

;			Prev = CurDrawablePrevAnimationState()
;			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight"
;			then 
;				CurDrawableSetTransitionAnimState("MoveToIdle") 
;			end
;			if Prev == "Stand" 
;			then 
;;				CurDrawableSetTransitionAnimState("IdleToAttn")
;			end
;			if Prev == "Attack" 
;			then 
;				CurDrawableAllowToContinue()
;			end
;		EndScript
	End


   
	AnimationState				= MOVING BACKING_UP WADING
		StateName			= BackingUp
		Animation			= BAKAW
			AnimationName           = KUTSling_SKL.KUTSling_BAKA
			AnimationMode       	= LOOP
		End
;		BeginScript
;			Prev = CurDrawablePrevAnimationState()
;			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight" or Prev == "Stand"
;			then 
;				CurDrawableSetTransitionAnimState ("TransToStand")
;			end
;		EndScript
	End

	AnimationState        			= TURN_LEFT WADING
		StateName			= TurningLeftW
		Animation 			= TRNLW
			AnimationName           = KUTSling_SKL.KUTSling_TRNL
			AnimationMode       	= LOOP
;			AnimationSpeedFactorRange = 1.5 1.5
;			AnimationBlendTime	= 15
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End

	AnimationState        			= TURN_RIGHT WADING
		StateName			= TurningRightW
		Animation 			= TRNRW
			AnimationName           = KUTSling_SKL.KUTSling_TRNR
;			AnimationSpeedFactorRange = 1.5 1.5
			AnimationMode       	= LOOP
;			AnimationBlendTime	= 15
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End
    
	AnimationState				= MOVING WADING
		StateName			= MoveW
		Animation			= MOVAW
		    	AnimationName		= KUTSling_SKL.KUTSling_MOVA
	        	AnimationMode		= LOOP
;			AnimationSpeedFactorRange	= 2.0 2.0           ; get those legs pumping!
			AnimationBlendTime	= 15
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End

	AnimationState				= MOVING BACKING_UP
		StateName			= BackingUp
		Animation			= BAKA
			AnimationName           = KUTSling_SKL.KUTSling_BAKA
			AnimationMode       	= LOOP
;			AnimationSpeedFactorRange = 2.0 2.0           ; get those legs pumping!
		End
;		BeginScript
;			Prev = CurDrawablePrevAnimationState()
;			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight"  or Prev == "Stand"
;			then 
;				CurDrawableSetTransitionAnimState ("TransToStand")
;			end
;		EndScript
	End

	AnimationState        			= TURN_LEFT 
		StateName			= TurningLeft
		Animation 			= TRNL
			AnimationName           = KUTSling_SKL.KUTSling_TRNL
			AnimationMode       	= LOOP
;			AnimationSpeedFactorRange = 1.5 1.5
			AnimationBlendTime	= 5
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End

	AnimationState        			= TURN_RIGHT 
		StateName			= TurningRight
		Animation 			= TRNR
			AnimationName           = KUTSling_SKL.KUTSling_TRNR
;			AnimationSpeedFactorRange = 1.5 1.5
			AnimationMode       	= LOOP
			AnimationBlendTime	= 5
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End
    
	AnimationState				= MOVING
		StateName			= Move
		Animation			= MOVA
		    	AnimationName		= KUTSling_SKL.KUTSling_MOVA
	       		AnimationMode			= LOOP
	       		Distance		= 30
;			AnimationSpeedFactorRange = 2.0 2.0           ; get those legs pumping!
			AnimationBlendTime	= 5
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Attack" or Prev == "Selected"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  ;NOTE new transition goes here
			end
			if Prev == "Stand"  
			then 
				CurDrawableSetTransitionAnimState ("IdleToMove")  
			end
		EndScript
	End


	AnimationState        = SELECTED
		StateName           = Selected
		Animation           = ATNB
			AnimationName     = KUTSling_SKL.KUTSling_ATNB
			AnimationMode     = LOOP
		End
		
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "Move" or Prev == "TurningLeft" or Prev == "TurningRight"
			then 
				CurDrawableSetTransitionAnimState("MoveToIdle") 
			end
			if Prev == "Stand" 
			then 
				CurDrawableSetTransitionAnimState("IdleToAttn")
			end
		EndScript
		
	End

    ; --------- Click and Hit Reactions ------------	
		
		TransitionState = IdleToMove
			StateName			= IdleToMove
			Animation = TransToMove
				AnimationName = KUTSling_SKL.KUTSling_MOVB
				AnimationMode = ONCE
;				AnimationSpeedFactorRange = 0.25 0.25
				AnimationBlendTime	=	5
			End
		End

		TransitionState = MoveToIdle
			StateName			= MoveToIdle
			Animation = MoveToIdle
				AnimationName = KUTSling_SKL.KUTSling_MOVC
				AnimationMode = ONCE
				AnimationBlendTime	=	5
			End
		End

		TransitionState = IdleToAttn
			StateName			= IdleToAttn
			Animation = IdleToAttn
				AnimationName = KUTSling_SKL.KUTSling_ATNA
				AnimationMode = ONCE
;				AnimationSpeedFactorRange = 0.25 0.25
				AnimationBlendTime	=	5
			End
		End

		TransitionState = AttnToIdle
			StateName			= AttnToIdle
			Animation = AttnToIdle
				AnimationName = KUTSling_SKL.KUTSling_ATNC
				AnimationMode = ONCE
				AnimationBlendTime	=	5
			End
		End

		


    TrackMarks = EXTireTrack2_Temp.tga
    TrackMarksLeftBone = WheelL02
    TrackMarksRightBone = WheelR02


    ; These parameters are only used if the model has a separate suspension,
    ; and the locomotor has HasSuspension = Yes.
;    LeftFrontTireBone           = WheelL01
;    RightFrontTireBone          = WheelR01
;    LeftRearTireBone            = WheelL02
;    RightRearTireBone           = WheelR02
;    TireRotationMultiplier      = 0.2   ; this * speed = rotation.
;    PowerslideRotationAddition  = 2.5   ; This speed is added to the rotation speed when powersliding.


    ParticlesAttachedToAnimatedBones = Yes

 End
End
Scale = 0.85
	VoiceAttack					= TrollVoiceAttack
	VoiceCombineWithHorde				= DrummerTrollCreatedRoar
	VoiceCreated					= TrebuchetCreated
	VoiceGuard					= NoSound
	VoiceMove					= NoSound
	VoiceMoveToCamp					= NoSound
	VoiceMoveWhileAttacking				= NoSound
	VoicePriority					= 13
	VoiceSelect					= AttackTrollVoiceSelectMS
	VoiceSelectBattle 				= AttackTrollVoiceSelectMS

	VoiceEnterStateAttack				= NoSound
	VoiceEnterStateMove				= NoSound
	VoiceEnterStateMoveToCamp			= NoSound
	VoiceEnterStateMoveWhileAttacking		= NoSound
	
	SoundImpact					= ImpactHorse
	SoundMoveLoop					= NoSound
	SoundMoveStart					= NoSound
	SoundOnDamaged					= UnitDamageWoodLight
	SoundOnReallyDamaged				= UnitDamageWoodHeavy
	SoundAmbientReallyDamaged			= UnitDamageFireSmallLoop

	UnitSpecificSounds
		VoiceEnterUnitElvenTransportShip	= NoSound
		VoiceGarrison				= NoSound
		VoiceInitiateCaptureBuilding		= NoSound
	End
	// No command points for this as it's free.
	CommandPoints		= 0
	ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS

	LocomotorSet
		Locomotor = FloatingCatapultLocomotor
		Condition = SET_NORMAL
		Speed     = 0
	End
End